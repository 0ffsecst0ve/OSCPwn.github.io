<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>notes</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="HacktheBox--Linux_Boxes--tartarsauce.html">tartarsauce</a></p>

<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--nmap.html">nmap</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--http.html">http</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--http--gobuster.html">gobuster</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--http--gobuster--gobuster_-webservices.html">gobuster /webservices</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--http--robots.txt.html">robots.txt</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--http--robots.txt--monstra-3.0.4.html">monstra-3.0.4</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--monstra_login_(rabbit_hole).html">monstra login (rabbit hole)</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--monstra_login_(rabbit_hole)--default_credentials.html">default credentials</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--monstra_login_(rabbit_hole)--searchsploit_monstra.html">searchsploit monstra</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--monstra_login_(rabbit_hole)--searchsploit_monstra--43348.txt.html">43348.txt</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--monstra_login_(rabbit_hole)--searchsploit_monstra--cmd.php.html">cmd.php</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold.html">initial foothold</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--wpscan.html">wpscan</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--wpscan--interesting_finds.html">interesting finds</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle.html">searchsploit gwolle</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle--php_reverse_shell.html">php reverse shell </a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle--webserver.html">webserver</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle--netcat_listener.html">netcat listener</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle--visit_exposed_link.html">visit exposed link</a></li>
<ol>
<li><a href="nux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle--visit_exposed_link--import_python_shell,_import_tab_autocomplete_and_xterm.html">import python shell, import tab autocomplete and xterm</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--initial_foothold--searchsploit_gwolle--visit_exposed_link--user.html">user</a></li>
</ol>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_Onuma.html">privesc to Onuma</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_Onuma--GTFO_bin_for_tar_privesc_to_onuma.html">GTFO bin for tar privesc to onuma</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_Onuma--GTFO_bin_for_tar_privesc_to_onuma--user.html">user</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root.html">privesc to root</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum.html">linEnum</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report.html">report</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--system.html">system</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--USER-GROUP.html">USER/GROUP</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--environmental.html">environmental</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--jobs-tasks.html">jobs/tasks</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--networking.html">networking</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--services.html">services</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--software.html">software</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--report--interesting_files.html">interesting files</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--linEnum--interesting_finds.html">interesting finds</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--procmon.sh.html">procmon.sh</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--backuperer.html">backuperer</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--backuperer--notes.html">notes</a></li>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--setuid.c.html">setuid.c</a></li>
<ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--setuid.c--apt_search_gcc-multilib.html">apt search gcc-multilib</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--setuid.c--upload_tar_with_malicious_c_code_w-_sticky_bit_preset_to_tartarsauce.html">upload tar with malicious c code w/ sticky bit preset to tartarsauce</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--privesc_to_root--setuid.c--backuperer_in_action.html">backuperer in action</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--user-root.html">user/root</a></li>
<li><a href="HacktheBox--Linux_Boxes--tartarsauce--lessons_learned.html">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>notes</u></b></h1><span style="color:#24ff00;">Let’s breakdown what the script is doing. First, the following variables are being initialized in the script.</span><br /><br /><img src="images/946-1.png" alt="images/946-1.png" /><br /><br /><span style="color:#24ff00;">Then the script performs the following actions:</span><br />1. Recursively deletes the files/directories: /var/tmp/.* and /var/tmp/check.<br />2. Creates a gzip file of the directory /var/www/html and saves it in the file /var/tmp/.[random-sha1-value].<br />3. Sleeps for 30 seconds.<br />4. Creates the directory /var/tmp/check.<br />5. Changes to the directory /var/tmp/check and extract the gzip /var/tmp/.[random-sha1-value].<br />6. If the files in /var/www/html are different from the files in the backup it created /var/tmp/check/var/www/html, then report error. Otherwise, move file /var/tmp/.[random-sha1-value] to /var/backups/onuma-wwww-dev.bak and remove everything in the check directory and any files that start with the character “.”. Those would be the backup .[random-sha1-value] files it created.<br /><br />The exploit for this is not very intuitive so bear with me as I try to explain it. When the backup is being created, the script sleeps 30 seconds before it executes the rest of the commands. We can use these 30 seconds to replace the backup tar file that the script created with our own malicious file.<br /><br />After the 30 seconds pass, it will create a directory called “check” and decompress our malicious backup tar file there. Then it will go through the integrity check and fail, thereby giving us 5 minutes before the next scheduled task is run, to run our setuid binary and escalate privileges. Once the 5 minutes are up, the backuperer program is run again and our files get deleted.</div></div>
</body></html>